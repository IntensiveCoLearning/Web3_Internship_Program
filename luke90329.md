---
timezone: UTC+8
---

# Luke Hsu

**GitHub ID:** luke90329

**Telegram:** @luke90329

## Self-introduction

我是一名研究生，目前正在研究與智慧合約安全審計有關的主題。

## Notes

<!-- Content_START -->

# 2025-08-29
<!-- DAILY_CHECKIN_2025-08-29_START -->
今天應該是這期實習計畫的最後一次打卡了，前面好像都是認認真真的技術筆記，沒有留什麼心裡話哈哈哈。

就像我在畢業典禮上分享的一樣，非常感謝 ETHPanda, LXDAO 以及各種金主爸爸們，讓我有機會可以參與到這麼豐富又紮實的訓練計畫之中，我目前是一名研究生，在研究智能合約弱點相關的議題，但過去都是和教授討論或是跑跑台北這邊相關的區塊鏈活動，比較沒有找到一群人一起聊聊 Web3 或是技術等等的議題，透過這個計畫讓我認識了許多有趣的人，也是到今天才知道原來這些小夥伴們個個身懷十八般武藝，挺會整活，希望之後有機會可以參與遠航計畫，到上海和小夥伴們還有各位老師們面基！
<!-- DAILY_CHECKIN_2025-08-29_END -->


# 2025-08-28
<!-- DAILY_CHECKIN_2025-08-28_START -->
在研究 V4 時，感覺整個 DeFi 的邏輯又往前進了一大步。不得不說，V4 不只是性能提升，還增加了許多可以讓開發者發揮創意的功能，可以進一步擴大生態系：

## Singleton + Flash Accounting

-   **Singleton 合約設計**：V3 是每個交易對各自一個合約，舉凡 Pool 建立、Multi‑hop 都要跑很多合約 call，很吃 gas；而V4 則把所有池子統一存在一個 PoolManager 裡，建立池子、交易流程都變得更順更便宜。
    
-   **Flash Accounting**：以前 swap 完交易、再扣 balance，每個中間步驟都要寫鏈上狀態。V4 則是把所有變動暫存起來，最後結算一次，省 gas 也更有效率。
    

## Hooks

V4 引入 Hooks，讓開發者可以在 swap、add/remove 流動性前後裝進自定義邏輯，宛如 AMM 的插件系統，開發者可以做到：

-   做限價單 (limit order)
    
-   套入 price oracle、動態調費 (dynamic fees)
    
-   **自動調整流動性**
    
-   設計新的交易曲線，甚至跳脫原本集中流動性模型。
    

換句話說，V4 不只是讓 LP 提供流動性，同時還可以定義「這個池子行為是什麼」，非常自由。

## 調費更多元、效能更好

-   **原生支援 ETH**：不需要 wrap/unwrap 的 WETH，也省了一筆操作費用、節省不少 gas 。
    
-   **動態手續費**：不像 V3 固定 0.05 / 0.3 / 1%，V4 可以調整成任意頻率、任意模式（swap、每區塊、每日、甚至更長）。
    

## 訂閱者機制

V4 新加入 **Subscribers** 機制，允許你設定一個訂閱合約，當每次 LP position 變動時，它都會收到通知，這讓 staking、liquidity mining 可以不必轉移 NFT（ERC‑721），更加安全更高效 。

## V4 vs V3

| 特性 | V3 | V4 |
| --- | --- | --- |
| 資本效率 | 高（集中流動性） | 同樣高，但成本更低 |
| gas 成本 | 高，需部署 Pool 合約 | 低，採 Singleton + Flash Accounting |
| 自定義能力 | 無 | Hooks + Dynamic Fee + Subscriber 超自由 |
| ETH 支援 | 必須 wrap | 原生支援 |
| 複雜度 | 普通 | 比較高，需要懂 Hook 邏輯 |

## 心得 + 小觀察

如果說 V2 是「人人會用的自動販賣機」、V3 是「高效率版 AMM」，那 V4 就是「可編程的 AMM 工具箱」。

1.  **V4 已經不是單純 AMM**，它更像 AMM + 插件市場，讓任何人都可以打造獨特交易模式。
    
2.  對開發者來說，是個超級 toolbox；對 LP 而言，如果你懂策略設計，那收益＋彈性都來了。
    
3.  但 Hooks 太自由，攻擊面也變多了，需特別注意安全性、審計、測試。
    
4.  V4 已經火速部署到好幾個鏈（像 Ethereum、Polygon、Arbitrum、Base…等），看起來生態正在快速起飛。
    
5.  雖然 V4 最多 gas 省 99% 的 headline 聽起來很猛，但實際上還是要配合路由最佳化、hook 輔助、合約優化才能真正省下來。
<!-- DAILY_CHECKIN_2025-08-28_END -->


# 2025-08-27
<!-- DAILY_CHECKIN_2025-08-27_START -->
繼前面看完 Uniswap V2 後，我也花時間研究了下 V3，他給我的感覺是它在設計上更聰明、更彈性，但同時對 LP 的要求也更高；以下是一些筆記跟心得，分享給有興趣的人～

## 最大的亮點：集中流動性

在 V2 裡，LP 把資金放進去，其實是**全價位範圍**都能被交易用到。這代表如果 ETH 從 1 美元漲到 10000 美元，LP 的流動性理論上都在「支撐」這整個價格區間。

而 V3 改變了這個邏輯，讓 LP 可以指定**我只想在某個價格範圍內提供流動性**。  
舉例：假設我覺得 ETH/USDC 會在 2000～3000 美金之間震盪，我就只把流動性集中在這個範圍。

-   好處：資金利用效率更高，賺到的手續費也會比 V2 多好幾倍。
    
-   壞處：一旦價格超出範圍，我的資金就變成「單邊持有」，不會再賺到手續費。
    

我覺得這個設計很像「做市商自己設定止盈止損區間」，比 V2 靈活很多，但同時 LP 需要更多判斷力。

## 不同手續費等級

V2 時期，手續費就是固定 0.3%。  
V3 提供了不同的 Fee Tier：0.05%、0.3%、1%。

-   穩定幣對（像 USDC/DAI）通常用 0.05%，因為幾乎不會大幅波動，滑點低。
    
-   較高風險的對（像 ETH/某小幣）可能會用 1%，補償 LP 的風險。
    

這樣的設計讓 LP 可以自己選擇風險報酬比，感覺更市場化。

## LP 的挑戰

V2 的 LP 很「被動」，放著就行。  
V3 的 LP 幾乎變成「主動投資人」：

-   要判斷價格區間
    
-   要隨時調整流動性 (Rebalance)
    
-   可能面臨 Gas 成本過高的問題
    

我覺得這是 V3 最不新手友善的地方，如果只是想被動賺手續費，V3 反而不如 V2；但如果願意花心思研究策略，那 V3 的優勢非常明顯。

## 感想

學完 V3，我最大的感覺是：

-   它已經不只是 AMM 了，而更像是「AMM + 主動管理策略的混合」。
    
-   LP 在 V3 扮演的角色比較像傳統金融裡的做市商，需要懂行情，才能玩得好。
    
-   對交易者來說，V3 基本上就是更低滑點、更便宜的體驗。
<!-- DAILY_CHECKIN_2025-08-27_END -->


# 2025-08-26
<!-- DAILY_CHECKIN_2025-08-26_START -->
之前只是在用 DEX 的角度體驗 Uniswap，對它背後的機制其實沒有那麼深入，這次看完一些文件、實際跑合約跟數學模型後，剛好趁機會整理一下心得。

* * *

## 1\. 定價公式與恆定乘積模型

Uniswap V2 最核心的概念還是 **x \* y = k** 的恆定乘積公式。

-   x = token0 的數量
    
-   y = token1 的數量
    
-   k = 常數
    

只要有人進行 swap，池子裡的 token 數量會變動，但 k 會被維持不變（扣除手續費）。  
一開始我覺得這個模型好像太簡單了，但實際想一想，這就是為什麼它能完全自動化，完全不需要訂單簿(order book)。

* * *

## 2\. 流動性提供者 (LP) 的角色

LP 其實就是把兩種 token 按比例存進去，拿到 LP Token 當憑證。

-   優點：可以收取交易手續費 (0.3%)，如果交易量大，收益也會大。
    
-   缺點：會遇到 **無常損失 (Impermanent Loss)**。這個部分一開始真的有點抽象，後來看了一些 Example 才比較理解：  
    假設 ETH 價格上漲，你單純持有 ETH 的收益會比放在池子裡高，因為池子裡會自動幫你把一部分 ETH 換成對應的穩定幣。
    

所以說當 LP 不是單純「躺著賺手續費」，而是必須考慮到幣價波動的風險。

* * *

## 3\. V2 的特色：支援 ERC20/ERC20 池

跟 V1 相比，V2 允許直接建立 **任意 ERC20/ERC20 的池子**，不用再強制一邊是 ETH。  
這對 DeFi 生態影響很大，因為這意味著專案方可以直接建立 USDC/DAI、WBTC/ETH 這種交易對，不用透過 ETH 當中介，降低了額外的滑點。
<!-- DAILY_CHECKIN_2025-08-26_END -->


# 2025-08-25
<!-- DAILY_CHECKIN_2025-08-25_START -->
今天看了一下關於Defi質押相關的一些文章並做了一些小總結：

在標準的 PoS 質押中，用戶質押 ETH 來保障以太坊主網的安全。而再質押的核心思想是：**讓已經質押的 ETH (或其流動性質押代幣，如 stETH) 能夠「一魚多吃」，同時為其他需要安全保障的系統提供服務，並賺取額外收益。**

這些需要安全保障的系統被稱為主動驗證服務 (AVS)，它們可以是預言機、數據可用性層、跨鏈橋、共享排序器等各種中間件。以往，這些系統需要自己發行代幣並建立一套經濟安全模型，啟動成本很高。

而 EigenLayer 創造了一個「安全租賃市場」：

-   **AVS (需求方)**：可以租用以太坊驗證者提供的經濟安全，而無需自己從零搭建。
    
-   **再質押者 (供給方)**：可以將其質押資本的安全性"出租"給多個 AVS，從而獲得多重收益，但這也表示，如果他們在任何一個 AVS 上作惡，其在主網質押的 ETH 都將面臨被罰沒的風險。
    

再質押極大地提高了資本效率，並為 Web3 中間件的創新提供了一個共享安全的底層，被譽為「區塊鏈信任層」，但同時也產生了一些新的風險：

1.  風險疊加：再質押者同時承擔著以太坊主網和多個 AVS 的罰沒風險，任何一個 AVS 的合約漏洞或惡意罰沒條件都可能威脅到底層的 ETH 資產。
    
2.  中心化風險：如果大量 AVS 都依賴於同一批大型驗證者，可能會導致系統性的風險集中。 理解並管理這些疊加的風險，將是再質押生態能否健康發展的關鍵所在。
<!-- DAILY_CHECKIN_2025-08-25_END -->


# 2025-08-23
<!-- DAILY_CHECKIN_2025-08-23_START -->
今天都在準備黑客松的內容，就分享一下我目前的構想：

我目前的構想是做一個自動化合約審計的專案，使用者可以透過前端提交合約程式碼，程式根據行數計價，然後付款到智慧合約，創建一個case，隨後後端會使用如靜態工具或LLM-based的工具進行審計，並在審計完成後返回結果，並將智慧合約中的case status轉換為complete，而若在15分鐘內沒有產出審計結果，則使用者可以透過合約內的功能進行退款。
<!-- DAILY_CHECKIN_2025-08-23_END -->


# 2025-08-22
<!-- DAILY_CHECKIN_2025-08-22_START -->
這幾天和教授 Meeting，剛好聊到了 DID (Decentralized Identity, DID) 相關的 Paper，覺得也很有趣，跟大家分享一下：


在傳統 Web2 的世界，我們的數位身份分散在各個平台手中 (Google, Facebook, Apple)，由這些公司掌控和驗證。而 DID 的目標是創建一個由用戶自己擁有和控制、可跨平台互通的身份系統。

### DID 核心組成

* DID (Decentralized Identifiers)：一個全球唯一的標識符，類似於你的身分證號碼，但它不與任何中心化機構綁定。

* VC (Verifiable Credentials)：可驗證的憑證。這是一種由發行方（如大學、政府）簽發的數位聲明（如學位證書、駕照），用戶可以選擇性地向驗證方（如求職公司、銀行）出示，以證明自己的某項資格，而無需透露所有個人資訊。

* DID Wallet：用戶用來管理自己的 DID、儲存 VC 並控制個人數據的錢包。

### 鏈上聲譽
DID 還有一個重要的成員叫做鏈上聲譽，我們的鏈上活動（如參與治理投票、償還 DeFi 借款、持有特定 NFT）共同構成了一個無法偽造的行為履歷，項目如 POAP (Proof of Attendance Protocol) 和 Galaxy 正在將這些鏈上足跡轉化為可視化的「徽章」或「積分」，初步構建了 Web3 的聲譽系統。

一個成熟的 DID 和鏈上聲譽系統，可解鎖許多目前難以實現的應用場景。如信用借貸，DeFi 協議可以根據用戶的鏈上還款紀錄來提供抵押率更低的貸款；或是"抗女巫攻擊"的空投，項目方可以向真正活躍的社群貢獻者而非機器人地址發放獎勵。
<!-- DAILY_CHECKIN_2025-08-22_END -->

# 2025-08-21

這幾天在研究套利的手法，發現有個概念很有趣 : MEV (Maximal Extractable Value)，最大可提取價值
MEV 是指區塊生產者（驗證者/礦工）在一個區塊中，通過對交易進行排序、插入或審查，所能獲得的超出標準區塊獎勵和 Gas 費的額外利潤。

## MEV 角色
* 用戶 (Users)：發起交易。

* 搜尋者 (Searchers)：運行複雜的演算法，在公開的 Mempool 中尋找 MEV 機會（如套利、清算）。

* 打包者 (Builders)：將搜尋者的交易包與普通用戶的交易組合起來，構建出利潤最大化的區塊。

* 提議者 (Proposers)：即區塊鏈的驗證者，他們從眾多打包者中選擇出價最高的區塊，將其上鏈並獲得賄賂。

## 常見 MEV 策略

* 套利 (Arbitrage)：利用同種資產在不同 DEX 上的價差進行買賣獲利。

* 三明治攻擊 (Sandwich Attack)：當監測到一筆大額買單時，搶先在其之前買入，等其交易推高價格後再立即賣出，將用戶夾在中間獲利。

* 清算 (Liquidations)：在借貸協議中，搶先清算瀕臨爆倉的抵押不足倉位以獲取獎勵。

# 2025-08-19

今天研究了以太坊歷史上最重要的升級，將以太坊的共識機制從依賴算力的「工作量證明 (PoW)」轉向了依賴質押資本的「權益證明 (PoS)」。

## 升級影響

1. 能源效率：最顯著的改變是網路能耗降低了約 99.95%，解決了 PoW 長期以來備受詬病的環保問題。

2. 安全模型的轉變：網路安全不再由礦工的物理算力保障，而是由驗證者 (Validators) 質押的 ETH 來維護。任何作惡行為都將導致其質押的 ETH 被罰沒，攻擊成本從消耗電力轉變為直接的經濟懲罰。

3. ETH 代幣經濟學的重塑：

    * 發行量銳減：PoS 的新幣發行率遠低於 PoW 時期，大幅減少了市場上的拋壓。

    * 通縮潛力：結合 EIP-1559 的交易手續費銷毀機制，當網路活動頻繁時，ETH 的銷毀量可能超過新發行量，使其成為一種通縮資產。

    * 資產屬性轉變：ETH 從一個主要用於支付 Gas Fee 的「商品」，轉變為可以透過質押產生收益的「生息資產」或「數位債券」。

而 PoS 雖然在能源和經濟模型上帶來了巨大優勢，但也引發了關於「中心化趨勢」的問題；由於運行驗證者節點有一定的技術和資金門檻 (32 ETH)，許多散戶選擇透過 Lido、Rocket Pool 等流動性質押協議或中心化交易所參與 Staking，這導致了質押權益的高度集中；而這種經濟上的中心化，長期來看是否會對以太坊的去中心化精神與抗審查能力構成新的威脅？

# 2025-08-18

今天研究了一下 NFT (Non-Fungible Token)，NFT 的核心其實是一個在鏈上獨一無二的代幣 ID，這個 ID 指向一份元數據 (Metadata)，也就是描述這個 NFT 的資訊（如名稱、屬性、圖片連結等）。

NFT 的實現依賴兩種主要的代幣標準：

1. ERC-721：這是最經典的 NFT 標準，它確保了每個代幣都是獨一無二的，一個蘿蔔一個坑，非常適合代表藝術品、收藏品等單一資產。

2. ERC-1155：由 Enjin 提出，被稱為「多代幣標準」，它允許在單一合約中同時管理多種類型的資產，可以是同質化的（如遊戲金幣，ID 為 A 的代幣有 1000 個），也可以是非同質化的（如傳說級武器，ID 為 B 的代幣只有 1 個），大幅提高了資產發行和交易的效率，特別適合遊戲和元宇宙場景。

而 metadata 的儲存方式也很重要：

* 鏈上儲存 (On-Chain)：將所有元數據直接寫入區塊鏈。極度安全、永久，但成本也極其高昂，只有少數項目採用。

* 鏈下儲存 (Off-Chain)：在鏈上只儲存一個指向元數據的 URI 連結。常見的儲存點包括：

    * 中心化伺服器：風險最高，若伺服器關閉或網址失效，NFT 就會直接化為烏有。

    * IPFS/Arweave：去中心化儲存網路，透過內容尋址而非位置尋址，確保了數據的持久性和抗審查性，是目前的主流方案。

一個 NFT 的長期價值幾乎等同於其元數據的安全性與可訪問性，而我們在一個號稱「永恆」的區塊鏈上，交易一個可能指向「非永恆」數據的代幣；所以這提醒我們在評估一個 NFT 項目時，除了藝術性與社群，也必須審視其技術實現，特別是元數據的去中心化儲存方案。

# 2025-08-17

參與實習計畫到現在也兩個多禮拜了，其中一直聽到各種 DAO 的大佬分享，但回過頭來發現自己對 DAO 還是不太清楚這是甚麼(X，於是就做了一下筆記XD

DAO (Decentralized Autonomous Organization) 是一個由智能合約規則來運行的組織，它由其成員共同擁有和管理，通常包括：
* 共享金庫 (Treasury)：組織的資金被鎖在智能合約中，任何動用都必須經過成員投票批准，無法被單一實體控制。

* 治理代幣 (Governance Token)：成員持有代幣來代表其在組織中的所有權和投票權，而通常來說，持有的代幣越多，投票"權重"越大。

* 提案與投票系統：任何成員都可以發起提案（例如申請一筆資金來給周末團建活動發個獎金 (?)），所有代幣持有者都可以對提案進行投票。投票結果由智能合約自動執行。

DAO 的應用非常廣泛，從管理 DeFi 協議的參數、共同投資數位資產，到資助公共產品和組織線上社群，它為大規模的鏈上協作提供了一個去信任的框架。

DAO 描繪了一個美好的去中心化治理藍圖，但在實踐中仍面臨諸多挑戰，例如"投票冷漠"導致參與率低下；財閥統治 (Plutocracy) 讓持有大量代幣的巨鯨能主導決策；以及純鏈上投票對於處理日常營運事務的效率低下問題。這些挑戰表明，理想的去中心化治理並非「一幣一票」這麼簡單，未來或許會看到更多混合式模型，如基於聲譽的投票、委託投票或子 DAO 結構的出現，來平衡效率與去中心化程度。

# 2025-08-16

今天研究了 Uniswap V2 的核心：自動化做市商 (Automated Market Maker, AMM)。

傳統金融市場如股票交易所依賴訂單簿 (Order Book)模型，買家和賣家掛出特定價格的買賣單，由專業的做市商提供流動性來撮合成交。這個模式在去中心化的環境中效率低下且成本高昂。

而 AMM 則是一種革命性的創新；它不使用訂單簿，而是依賴流動性池 (Liquidity Pool)，任何人都可以將兩種或多種代幣按特定比例存入池中，成為流動性提供者。交易者則直接與流動性池進行兌換。

代幣的價格由池中資產的比例，透過一個固定的數學公式自動決定。最經典的就是 Uniswap V2 使用的「恆定乘積公式」：x×y=k。其中 x 和 y 是池中兩種代幣的數量，k 是一個常數。交易會改變 x 和 y 的數量，但必須保持其乘積 k 不變（在不考慮手續費的情況下），從而動態調整出新的價格。

AMM 為普通人提供了成為「做市商」並賺取交易手續費的機會，但也伴隨著一個獨特的風險 — 無常損失 (Impermanent Loss)。當池中代幣的市場價格發生劇烈波動時，LP 在撤出流動性時，其資產的總價值可能會低於「如果當初只是單純持有這些代幣」時的價值。而這種潛在的虧損正是 LP 提供流動性所承擔的風險與其手續費收入之間的博弈。

# 2025-08-15

智能合約本身是一個封閉且確定的系統，無法主動獲取區塊鏈以外的真實世界數據（比如歐元對美元的匯率、氣溫等）。這種內外隔離的特性，就是所謂的 The Oracle Problem。
但許多高價值的應用（如：去中心化借貸、衍生品、保險）都極度依賴這些外部數據。為了解決這個問題，預言機 (Oracle) 就出現了，它是一個可信賴的數據源，負責將鏈下數據安全、可靠地餵送給鏈上智能合約使用。

但這也帶來了新的挑戰，如果 Oracle 本身是中心化的，那它就成了整個系統的單點故障和信任瓶頸，違背了區塊鏈去中心化的初衷。因此，有一個解決方案就是「去中心化預言機 」，例如最業界滿有名的 Chainlink。它透過聚合多個獨立節點的數據、設置質押與懲罰機制，來確保數據的準確性與抗操縱性。

雖然去中心化預言機解決了單點信任問題，但我們信任的鏈條從「單一實體」變成了一個節點網絡的經濟共識。這就引出了一個更深層次的問題：數據的「根信任」在哪裡？如果提供給 Oracle network 的源頭數據（例如交易所的 API）本身就被污染或操縱了，那不管 Oracle 再怎麼去中心化，也只是忠實地把錯誤的數據傳遞上鏈，所以說 Web3 的信任邊界，並不僅僅存在於鏈上。

# 2025-08-14

最近除了研究智能合約安全審計相關議題，也因為在以太坊中文周會上聽到和擴容有關的技術內容，覺得滿有趣的，就研究了一下並做個整理。

以太坊等 Layer 1 公鏈為了追求去中心化與安全性，犧牲了部分的可擴展性，導致交易速度慢（TPS 低） 且 Gas Fee 高昂。為了解決這個區塊鏈的不可能三角，L2擴容方案應運而生。

## Layer 2

Layer 2 的核心思想是將大量的交易計算與執行移到鏈下 (off-chain) 處理，再將最終的交易結果或證明打包壓縮，提交回 Layer 1 進行結算與確保安全。 這樣既能繼承 Layer 1 的安全性，又能大幅提升處理效率、降低用戶成本。

而目前主流的 L2 方案主要分為兩大類：

1. Optimistic Rollups：如 Arbitrum, Optimism 等，它假設所有鏈下交易都是有效的，並提供一個「爭議期」。任何人若發現無效交易，可在此期間提交 Fraud Proof 來挑戰並獲得獎勵。

2. ZK-Rollups：如 zkSync, StarkNet，它利用 zk proof，為每一批鏈下交易生成一個 Validity Proof。Layer 1 只需驗證這個證明，就能確信所有交易皆為有效，無需爭議期。

# 2025-08-13

過去幾天都在研究弱點/漏洞，但也學習到了一件事：僅靠人工審查程式碼難以發現所有漏洞，將自動化工具與最佳實踐融合進開發流程，是現今智能合約開發的必要環節。

## 核心工具

1. 靜態分析：如 Slither 等工具，能在不執行程式碼的情況下，掃描其是否符合已知的漏洞模式。它可以被整合進 CI/CD 流程，在每次提交時自動檢查，是第一道防線。

2. 動態分析與模糊測試：如 Foundry Fuzzing 或 Echidna 等工具，通過生成大量隨機輸入來測試合約，探索邊界條件和非預期狀態，能有效發現邏輯錯誤和數學漏洞。

3. 標準化函式庫：OpenZeppelin 提供了經過社群廣泛審計和實戰檢驗的合約組件（e.g. ERC20, AccessControl, ReentrancyGuard...etc），在開發時優先使用這些標準組件而非自己重新發明輪子，可以顯著減少低級錯誤。

自動化工具和標準函式庫極大地提高了開發的安全，但過度依賴它們也可能會讓開發者忽略了對協議自身複雜業務邏輯的審查。真正的安全源於"工具輔助下的嚴謹思維"與"持續學習"這兩件事，而非將安全責任完全外包給工具。工具抓的是「已知的未知」，而業務邏輯的漏洞往往是「未知的未知」。

# 2025-08-12

今天研究了近年各大 Web3審計報告中，影響最嚴重的弱點 Access Control：

根據 OWASP 發布的 2025 年智能合約十大安全風險 (OWASP Smart Contract Top 10)，存取控制 (Access Control)相關的漏洞是出現頻率最高的類別，凸顯了其在實務中的重要性。而存取控制簡單來說就是決定了「誰能做什麼」，不當的權限設計會讓合約門戶洞開，形同虛設。

## 常見漏洞與實踐

1. 未受保護的函式 (Unprotected Functions)：將只有管理員能呼叫的函式（如 selfdestruct, withdrawFees）暴露給所有人，是致命的低級錯誤。使用 onlyOwner 等 modifier 是基本操作。

2. tx.origin 驗證：tx.origin 指向交易的"最初發起者"，而非"直接呼叫者 (msg.sender)"；若使用 tx.origin 進行授權，合約將容易受到釣魚攻擊；一個惡意合約可以誘導用戶與其互動，再由它去呼叫目標合約，此時 tx.origin 是無辜的用戶，攻擊便可得逞。永遠優先使用 msg.sender 進行驗證。

3. 中心化風險：單一 owner 地址存在單點故障風險（如私鑰洩漏）。對於重要的協議，應考慮使用多簽錢包 或去中心化治理 (DAO) 來分散和制衡特權。

除了技術層面的多簽錢包，高權限操作的安全性也應考量治理層面的制衡。例如引入時間鎖機制，讓所有權限變更或重大操作都必須經過一段時間的公示期後才能生效，為社群提供審查和反應的時間，是防範惡意或錯誤操作的有效緩衝。

# 2025-08-11

昨天不小心偷懶了一天，今天繼續研究智能合約中經典的弱點：整數溢位 (Overflow or Underflow)。

整數溢位是 CS 的老問題了，幾乎每個程式語言都有這樣的弱點，但在智能合約中常常與資產相關，因此風險極高。

## 問題本質
在 Solidity 中，每個整數類型 (e.g. uint8, uint256)都有其固定的儲存範圍。

* Overflow: 當一個數值達到其類型上限時，再增加就會變為該類型的最小值（e.g. uint8 的 255 + 1 = 0）。

* Underflow: 當一個數值為 0 時，再減去 1 就會「翻轉」為該類型的最大值。

在代幣合約或任何記帳邏輯中，這類漏洞可能被用來無中生有地鑄造大量代幣，或繞過支付驗證。

## 解決方法
1. Solidity 0.8.0+: Solc 0.8.0 版本起，Solc 預設會對所有算術運算進行溢位檢查，若發生溢位則交易會被revert。

2. SafeMath 函式庫：在 Solc 0.8.0 之前的版本，普遍使用 OpenZeppelin 的 SafeMath Library 來對加減乘除進行安全的封裝。

3. unchecked{}: Solc 0.8.0+ 版本中，開發者可以明確使用 unchecked { ... } 來包覆程式碼，以節省 Gas 並表示此處的運算已確認不會溢位。

Solc 0.8.0+ 的內建保護機制大大提高了安全性，但也引發了關於效能與安全取捨的新思考；在極度追求 Gas efficiency 的場景，開發者可能會選擇使用 unchecked，但這就需要開發者必須對自己的數學邏輯有百分之百的把握，於是責任從「語言/框架」再次回到了「開發者」身上。

# 2025-08-09

今天在研究智能合約弱點資料集，看到了造成 The DAO事件的重入攻擊(Reentrancy)弱點，覺得很有趣就研究了一下。

## 攻擊原理
此漏洞發生於合約的狀態變更順序不當。當合約 A 呼叫外部合約 B 時，若在更新自身狀態（如：扣減餘額）之前就發送以太幣或進行外部呼叫，惡意的合約 B 就能夠利用這個時間差，"重入"合約 A 的函式，重複執行提款等操作，直到榨乾合約資產。

## 防禦方法
若要防止這類弱點，在開發時需要遵循"檢查-生效-互動" (Checks-Effects-Interactions)的開發模式：
1. Checks: 驗證所有前提條件，如餘額是否足夠。
2. Effects: 立即更新所有內部狀態變數，如更新餘額變數。
3. Interactions: 最後才與外部合約進行互動，如發送以太幣。

此外，使用 Re-entrancy Guard 也是一種常見且有效的防禦機制。

Checks-Effects-Interactions 看似簡單，但在複雜的 DeFi 協議中，函式間的呼叫鏈可能非常深。一個函式看似遵循了原則，但它呼叫的另一個內部函式可能又包含了外部呼叫，導致非預期的重入風險。

# 2025-08-08

我這幾天都在幫一間公司進行智能合約安全相關的教育訓練，有一些感悟：

不同於傳統的後端程式碼可以隨時修改、部署、打補丁，區塊鏈上的智能合約一旦部署，大部分情況下是不可變的，所以這代表如果合約中存在一個漏洞，那就如同在銀行的金庫設計圖上留下了一個後門，而且這個金庫還無法輕易更換或修理。

這個 Code is Law 的特性既是 Web3 世界的魅力，也是它的風險所在。任何人都可以看到鍊上合約的程式碼與交易紀錄，透明度極高，但也代表著駭客可以輕鬆的研究你的漏洞；而一旦漏洞被利用，損失的可能就是真金白銀，而且幾乎無法追回。

這就是為什麼智能合約的每一行程式碼都必須經過深思熟慮與嚴格審計。

# 2025-08-07

今日參與了Web3的法律知識分享會，讓我了解到，在做項目的時候，除了技術面和商業面，其實在監管和法律方面也會有許多需要注意的地方，還有包含出入金、KYC相關的財金法律知識。

# 2025-08-06

今天詳讀了SlowMist的文件，了解了許多智能合約相關的弱點和Defi攻擊事件和手法，對於我正在撰寫的論文有很大的幫助。

# 2025-08-05

今天參與了關於反釣魚的分享會，學習到了很多在Web3生態中的反釣魚觀念，受益良多，尤其是有些詐騙GAS的手法都和web2的不太一樣，很新奇！

# 2025-08-04

今天參與了以太坊中文周會，了解到很多最即時的幣圈相關的資訊以及以太坊近期的技術著重點，對於這個日新月異的圈子來說，有這樣一個週會我覺得是非常好的，畢竟可能隨時都有新的風口出現。


# 2025.07.30


<!-- Content_END -->
